import{r as t,j as e,a as i}from"./app-Dich8IgY.js";import{u as O,C as x}from"./index.esm-D9-e8T1U.js";import{u as U}from"./AuthProvider-ZtwJBpf8.js";function K({onClose:_,onSuccess:N}){const{hierarchyLevel:c}=U(),{control:u,handleSubmit:w,formState:{errors:l,isValid:S},reset:C}=O({mode:"onChange",defaultValues:{name:"",company_id:"",hierarchy_level:""}}),[o,j]=t.useState(1),[P,E]=t.useState([]),[k,M]=t.useState([]),[R,L]=t.useState([]),[p,A]=t.useState([]),[F,q]=t.useState(""),[z,f]=t.useState(""),[b,g]=t.useState(!1),h=t.useRef(null),H=t.useRef(null);t.useRef(null),t.useEffect(()=>{const s=async()=>{try{const r=await i.get("/admin/companies");E(r.data)}catch(r){console.error("Error al cargar las empresas",r)}},a=async()=>{try{const d=(await i.get("/api/hierarchylevels")).data.filter(m=>c!==null&&(c===0||m.level>c));M(d)}catch(r){console.error("Error al cargar los niveles jerárquicos",r)}},n=async()=>{try{const r=await i.get("/api/permissions");L(r.data)}catch{f("Error al cargar los permisos disponibles.")}};s(),a(),n()},[c]);const v={Empresas:["can_create_companies","can_delete_companies","can_update_companies"],Puestos:["can_create_positions","can_update_positions","can_delete_positions"],Usuarios:["can_create_users","can_delete_users","can_update_users","can_view_company_users","can_view_all_users"],"Gestión de Archivos y Carpetas":["can_view_file_explorer","can_open_files","can_upload_files_and_folders","can_create_folders","can_download_files_and_folders","can_copy_files","can_move_files","can_rename_files_and_folders","can_delete_files_and_folders"]},G=Object.keys(v).map(s=>({category:s,permissions:R.filter(a=>v[s].includes(a.name))})),V=s=>{A(a=>a.includes(s)?a.filter(n=>n!==s):[...a,s])},$=async s=>{var a,n,r,d;g(!0);try{const y=(await i.post("/admin/positions",s)).data.id;y&&p.length>0&&await i.post("/api/positionpermissions",{position_id:y,permissions:p}),q("El puesto ha sido registrado exitosamente."),C(),(a=h.current)==null||a.showModal()}catch(m){f(((r=(n=m.response)==null?void 0:n.data)==null?void 0:r.message)||"Hubo un error al registrar el puesto."),(d=H.current)==null||d.showModal()}finally{g(!1)}},B=()=>{var s;(s=h.current)==null||s.close(),N(),_()};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"modal-box",children:[e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${o>=1?"step-primary":""}`,children:"Información Básica"}),e.jsx("li",{className:`step ${o===2?"step-primary":""}`,children:"Asignar Permisos"})]}),e.jsxs("form",{onSubmit:w($),children:[o===1&&e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Registro de Nuevo Puesto"}),e.jsx("div",{children:e.jsxs("label",{className:"input__data__entry mt-4",htmlFor:"company_id",children:[e.jsx(x,{name:"company_id",control:u,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,id:"company_id",className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),P.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),l.company_id&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l.company_id.message})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{htmlFor:"hierarchy_level",children:[e.jsx(x,{name:"hierarchy_level",control:u,rules:{required:"El nivel jerárquico es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,id:"hierarchy_level",className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Seleccione un nivel jerárquico"}),k.map(a=>e.jsx("option",{value:a.level,children:a.name},a.level))]})}),l.hierarchy_level&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l.hierarchy_level.message})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"input__data__entry",htmlFor:"name",children:[e.jsx(x,{name:"name",control:u,rules:{required:"El nombre del puesto es obligatorio",minLength:{value:3,message:"El nombre debe tener al menos 3 caracteres"}},render:({field:s})=>e.jsx("input",{...s,placeholder:"Nombre del puesto",id:"name",className:"input input-bordered w-full"})}),l.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l.name.message})]})}),e.jsxs("div",{className:"mt-6 flex items-center",children:[e.jsx("button",{type:"button",className:"btn-warning-mod mx-2",onClick:_,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn-accept mx-2",onClick:()=>j(2),disabled:!S,children:"Siguiente"})]})]}),o===2&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-3 text-xl text-center font-bold",children:"Asignar Permisos"}),e.jsx("div",{className:"overflow-y-auto max-h-80",children:G.map(({category:s,permissions:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(n=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:p.includes(n.id),onChange:()=>V(n.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:n.description})]},n.id))})]},s))}),e.jsxs("div",{className:"mt-6 flex",children:[e.jsx("button",{type:"button",className:"btn-warning-mod mx-2",onClick:()=>j(1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn-accept mx-2",disabled:b,children:b?e.jsx("span",{className:"loading loading-spinner"}):"Guardar"})]})]})]}),e.jsx("dialog",{ref:h,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-center",children:"Éxito"}),e.jsx("p",{className:"py-4 text-center text-green-600",children:F}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:B,children:"Aceptar"})})]})})]})})}export{K as default};
