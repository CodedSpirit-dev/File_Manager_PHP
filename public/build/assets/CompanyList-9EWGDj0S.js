import{r as t,a as g,j as e,Y as T}from"./app-Mvh8hZwc.js";import Y from"./EditCompany-Cv19D2B3.js";import q from"./CreateCompany-Aacfepm-.js";import{deleteCompany as z}from"./companyApi-BVPRPLZT.js";import{u as B}from"./AuthProvider-00zunbU_.js";import"./index.esm-CA09NKUL.js";const W=()=>{const{hasPermission:a}=B(),[C,y]=t.useState([]),[E,m]=t.useState(!0),[p,S]=t.useState(null),[h,_]=t.useState(null),[w,b]=t.useState(!1),[v,x]=t.useState(!1),[F,f]=t.useState(null),[G,D]=t.useState(null),i=t.useRef(null),[l,j]=t.useState(null),[k,A]=t.useState(0),[L,M]=t.useState(0),[u,N]=t.useState(null),[n,c]=t.useState(null);t.useEffect(()=>{d()},[]);const d=async()=>{m(!0);try{const s=await g.get("admin/companies");y(s.data),m(!1)}catch{S("Error al cargar los datos"),m(!1)}},O=s=>{N(s.id),_(s),b(!0),N(null)},P=async s=>{var o;c(s.id);try{const r=await g.get(`admin/companies/${s.id}/counts`);A(r.data.positions_count),M(r.data.employees_count),j(s),(o=i.current)==null||o.showModal()}catch{f("Error al obtener datos de la empresa.")}finally{c(null)}},R=async()=>{var s,o,r;if(l){c(l.id);try{await z(l.id),D("Compañía eliminada exitosamente."),d()}catch(I){f(((o=(s=I.response)==null?void 0:s.data)==null?void 0:o.message)||"Error al eliminar la empresa.")}finally{(r=i.current)==null||r.close(),j(null),c(null)}}},$=()=>{d(),x(!1)};return E?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):p?e.jsx("div",{className:"text-center text-error",children:p}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx(T,{title:"Empresas"}),e.jsx("h2",{className:"text-center mb-2",children:"LISTA DE EMPRESAS"}),a("can_create_companies")&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx("button",{onClick:()=>x(!0),className:"btn btn-success",children:"Agregar nueva empresa"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-center w-fit",children:"Nombre de la Empresa"}),e.jsx("th",{className:"px-4 py-2 text-center w-fit",children:"Cantidad de Puestos"}),e.jsx("th",{className:"px-4 py-2 text-center w-fit",children:"Cantidad de Empleados"}),a("can_update_companies")||a("can_delete_companies")?e.jsx("th",{className:"px-4 py-2 text-center w-fit",children:"Acciones"}):null]})}),e.jsx("tbody",{children:C.map(s=>e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content truncate max-w-fit",children:s.name}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content text-center max-w-fit",children:s.positions_count??0}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content text-center max-w-fit",children:s.employees_count??0}),a("can_update_companies")||a("can_delete_companies")?e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content text-center max-w-fit",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[a("can_update_companies")&&e.jsx("button",{onClick:()=>O(s),className:`btn btn-primary btn-sm ${u===s.id?"loading":""}`,disabled:u===s.id,children:u===s.id?"":"Editar"}),a("can_delete_companies")&&e.jsx("button",{onClick:()=>P(s),className:`btn btn-error btn-sm text-base-100 ${n===s.id?"loading":""}`,disabled:n===s.id,children:n===s.id?"":"Eliminar"})]})}):null]},s.id))})]}),e.jsx("dialog",{ref:i,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsxs("h4",{className:"font-bold text-center",children:["¿Estás seguro de eliminar ",l==null?void 0:l.name," de la base de datos?"]}),e.jsxs("p",{className:"text-justify",children:["Se eliminarán ",e.jsx("b",{children:k})," puestos y ",e.jsx("b",{children:L})," empleados deberán ser reasignados a nuevas empresas y puestos."]}),e.jsx("p",{className:"text-justify",children:"Esta operación borrará todos los archivos relacionados a la empresa y no se podrán recuperar."}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{className:"btn-cancel",onClick:()=>{var s;return(s=i.current)==null?void 0:s.close()},disabled:!!n,children:"No, cancelar"}),e.jsx("button",{onClick:()=>R(),className:`btn-accept ${n?"loading":""}`,disabled:!!n,children:n?"":"Sí, eliminar"})]})]})}),v&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsx(q,{onClose:()=>x(!1),onSuccess:$})}),w&&h&&e.jsx(Y,{company:h,onClose:s=>{b(!1),s&&d()}})]})]})};export{W as default};
