import{r as s,a as l,j as e,Y as T}from"./app-KvMYWGY9.js";import U from"./EditEmployee-DMMKpxrH.js";import P from"./CreateEmployee-CPK_n_qf.js";import"./index.esm-l5tDe8d-.js";const B=()=>{const[v,D]=s.useState([]),[m,M]=s.useState([]),[b,O]=s.useState([]),[A,x]=s.useState(!0),[j,g]=s.useState(null),[N,F]=s.useState(null),[y,u]=s.useState(!1),[p,h]=s.useState(!1),[f,E]=s.useState(null);s.useRef(null);const c=s.useRef(null),[o,S]=s.useState(null),[i,_]=s.useState(!1),[C,k]=s.useState(null),L=t=>{k(t.id);const a=m.find($=>$.id===t.position_id),n=a?a.company_id:null,r={...t,company_id:n};F(r),u(!0),k(null)};s.useEffect(()=>{d()},[]);const d=()=>{x(!0),l.all([l.get("admin/employees"),l.get("api/positions"),l.get("admin/companies")]).then(l.spread((t,a,n)=>{D(t.data),M(a.data),O(n.data),x(!1)})).catch(t=>{console.error("Error al cargar los datos",t),g("Error al cargar los datos"),x(!1)})},w=t=>{var a;S(t),(a=c.current)==null||a.showModal()},I=()=>{o&&(_(!0),l.delete(`admin/employees/${o.id}`).then(()=>{var t;E("¡Usuario eliminado con éxito!"),d(),(t=c.current)==null||t.close()}).catch(t=>{console.error("Error al eliminar el usuario",t),g("Ocurrió un error al eliminar el usuario.")}).finally(()=>{_(!1),S(null)}))},R=()=>{E(null)};return A?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):j?e.jsx("div",{className:"text-center text-error",children:j}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx(T,{title:"Usuarios"}),e.jsx("h2",{className:"text-center",children:"LISTA DE USUARIOS"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>h(!0),className:"btn btn-success",children:"Agregar usuario"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Número Telefónico"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Fecha de Registro"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Último Inicio de Sesión"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Puesto"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:v.map(t=>{const a=m.find(r=>r.id===t.position_id),n=a?b.find(r=>r.id===a.company_id):null;return e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:[t.first_name," ",t.last_name_1]}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:t.phone_number||"No disponible"}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:new Date(t.registered_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:t.last_login_at?new Date(t.last_login_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"No registrado"}),e.jsxs("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:[a==null?void 0:a.name,e.jsx("br",{}),n&&e.jsx("span",{className:"mt-1 inline-block bg-secondary text-secondary-content text-xs px-2 py-1 rounded",children:n.name})]}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>L(t),className:"btn btn-primary btn-sm",disabled:C===t.id,children:C===t.id?e.jsx("span",{className:"loading loading-spinner"}):"Editar"}),e.jsx("button",{onClick:()=>w(t),className:"btn btn-error btn-sm text-base-100",children:"Eliminar"})]})})]},t.id)})})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"edit-employee-modal",className:"modal-toggle",checked:y,readOnly:!0}),e.jsx("label",{htmlFor:"edit-employee-modal",className:`modal cursor-pointer ${y?"modal-open":""}`,children:e.jsx("label",{className:"modal-box relative",htmlFor:"",children:e.jsx(U,{employee:N,positions:m,companies:b,onClose:()=>u(!1),onSuccess:()=>{u(!1),d()}})})})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"add-employee-modal",className:"modal-toggle",checked:p,readOnly:!0}),e.jsx("label",{htmlFor:"add-employee-modal",className:`modal cursor-pointer ${p?"modal-open":""}`,children:e.jsx("label",{className:"modal-box relative",htmlFor:"",children:e.jsx(P,{onSuccess:()=>{d(),h(!1)},onClose:()=>h(!1)})})})]}),e.jsx("dialog",{ref:c,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsx("h4",{className:"font-bold text-center",children:o?`¿Estás seguro de eliminar a ${o.first_name} ${o.last_name_1} de la base de datos?`:"¿Estás seguro de eliminar este usuario de la base de datos?"}),e.jsx("p",{className:"text-justify mt-4",children:"Esta operación no se puede deshacer."}),e.jsxs("div",{className:"modal-action justify-center mt-6",children:[e.jsx("button",{type:"button",className:"btn btn-warning",onClick:()=>{var t;return(t=c.current)==null?void 0:t.close()},disabled:i,children:"No, cancelar"}),e.jsx("button",{type:"button",onClick:I,className:`btn btn-error ${i?"loading":""}`,disabled:i,children:i?"Eliminando...":"Sí, eliminar"})]})]})}),f&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center text-lg",children:"Acción Exitosa"}),e.jsx("p",{className:"text-center py-4 text-green-500",children:f}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:R,children:"Aceptar"})})]})})]})]})};export{B as default};
