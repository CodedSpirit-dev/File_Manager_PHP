import{r as t,b as N,j as e}from"./app-BerAXu6O.js";import q from"./EditCompany-FnR3-2d0.js";import z from"./CreateCompany-DLrKQONQ.js";import{deleteCompany as B}from"./companyApi-DCvltCbX.js";import"./index.esm-BiFVnHlm.js";const T=()=>{const[g,y]=t.useState([]),[C,c]=t.useState(!0),[u,E]=t.useState(null),[p,S]=t.useState(null),[v,b]=t.useState(!1),[k,m]=t.useState(!1),[F,h]=t.useState(null),[G,D]=t.useState(null),o=t.useRef(null),[l,f]=t.useState(null),[w,L]=t.useState(0),[M,O]=t.useState(0),[x,j]=t.useState(null),[a,i]=t.useState(null);t.useEffect(()=>{d()},[]);const d=async()=>{c(!0);try{const s=await N.get("admin/companies");y(s.data),c(!1)}catch{E("Error al cargar los datos"),c(!1)}},$=s=>{j(s.id),S(s),b(!0),j(null)},R=async s=>{var r;i(s.id);try{const n=await N.get(`admin/companies/${s.id}/counts`);L(n.data.positions_count),O(n.data.employees_count),f(s),(r=o.current)==null||r.showModal()}catch{h("Error al obtener datos de la empresa.")}finally{i(null)}},_=async()=>{var s,r,n;if(l){i(l.id);try{await B(l.id),D("Compañía eliminada exitosamente."),d()}catch(P){h(((r=(s=P.response)==null?void 0:s.data)==null?void 0:r.message)||"Error al eliminar la empresa.")}finally{(n=o.current)==null||n.close(),f(null),i(null)}}},A=()=>{d(),m(!1)};return C?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):u?e.jsx("div",{className:"text-center text-error",children:u}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-primary",children:"Lista de Empresas"}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx("button",{onClick:()=>m(!0),className:"btn btn-success",children:"Agregar nueva empresa"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nombre de la Empresa"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Cantidad de Empleados"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:g.map(s=>e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:s.name}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:s.employees_count??0}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>$(s),className:`btn btn-primary btn-sm ${x===s.id?"loading":""}`,disabled:x===s.id,children:x===s.id?"":"Editar"}),e.jsx("button",{onClick:()=>R(s),className:`btn btn-error btn-sm text-base-100 ${a===s.id?"loading":""}`,disabled:a===s.id,children:a===s.id?"":"Eliminar"})]})})]},s.id))})]}),e.jsx("dialog",{ref:o,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsxs("h4",{className:"font-bold text-center",children:["¿Estás seguro de eliminar ",l==null?void 0:l.name," de la base de datos?"]}),e.jsxs("p",{className:"text-justify",children:["Se eliminarán ",e.jsx("b",{children:w})," puestos y ",e.jsx("b",{children:M})," empleados deberán ser reasignados a nuevas empresas y puestos."]}),e.jsx("p",{className:"text-justify",children:"Esta operación borrará todos los archivos relacionados a la empresa y no se podrán recuperar."}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{className:"btn-cancel",onClick:()=>{var s;return(s=o.current)==null?void 0:s.close()},disabled:!!a,children:"No, cancelar"}),e.jsx("button",{onClick:()=>_(),className:`btn-accept ${a?"loading":""}`,disabled:!!a,children:a?"":"Sí, eliminar"})]})]})}),k&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsx(z,{onClose:()=>m(!1),onSuccess:A})}),v&&p&&e.jsx(q,{company:p,onClose:s=>{b(!1),s&&d()}})]})]})};export{T as default};
