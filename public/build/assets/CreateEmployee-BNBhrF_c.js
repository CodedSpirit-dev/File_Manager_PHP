import{r as l,b as p,j as e}from"./app-C0SJH87f.js";import{u as G,C as t}from"./index.esm-C2efHDSm.js";function H(){const{control:n,handleSubmit:v,setValue:x,watch:d,getValues:_,formState:{errors:o,isValid:j},reset:b}=G({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",password:"",password_confirmation:"",company_id:"",position_id:"",enable_permissions:!1,selected_permissions:[]}}),[N,C]=l.useState([]),[w,S]=l.useState([]),[P,k]=l.useState([]),[F,A]=l.useState([]),[q,h]=l.useState(!1),[z,u]=l.useState(!1),[i,m]=l.useState(1),L=2,r=d(),f=d("password"),g=d("password_confirmation"),V=d("enable_permissions");l.useEffect(()=>{p.get("api/positions").then(s=>C(s.data)).catch(s=>console.error("Error al cargar los puestos",s)),p.get("api/permissions").then(s=>k(s.data)).catch(s=>console.error("Error al cargar los permisos",s)),p.get("admin/companies").then(s=>S(s.data)).catch(s=>console.error("Error al cargar las empresas",s))},[]);const y=d("company_id");l.useEffect(()=>{const s=N.filter(a=>a.company_id===Number(y));A(s),x("position_id","")},[y,N,x]);const Z=s=>{const a=_("selected_permissions");a.includes(s)?x("selected_permissions",a.filter(c=>c!==s)):x("selected_permissions",[...a,s])},R=s=>{i<L?m(i+1):p.post("/admin/employees/store",s).then(a=>{const c=a.data.id;s.enable_permissions?p.post("/api/userpermissions",{employee_id:c,permissions:s.selected_permissions}).then(()=>{h(!0),b(),m(1)}).catch(D=>{console.error("Error al asignar permisos",D),u(!0)}):(h(!0),b(),m(1))}).catch(a=>{console.error("Error al registrar el empleado",a),u(!0)})},E={Empresas:["can_create_companies","can_delete_companies","can_update_companies"],Puestos:["can_create_positions","can_update_positions","can_delete_positions"],Empleados:["can_create_employees","can_delete_employees","can_update_employees","can_view_company_employees","can_view_all_employees"],"Gestión de Archivos y Carpetas":["can_view_file_explorer","can_open_files","can_upload_files_and_folders","can_create_folders","can_download_files_and_folders","can_copy_files","can_move_files","can_rename_files_and_folders","can_delete_files_and_folders"]},$=Object.keys(E).map(s=>({category:s,permissions:P.filter(a=>E[s].includes(a.name))}));return e.jsxs("div",{className:"container__25",children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Registro de nuevos empleados"}),e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${i>=1?"step-primary":""}`,children:"Datos del empleado"}),e.jsx("li",{className:`step ${i===2?"step-primary":""}`,children:"Permisos"})]}),e.jsxs("form",{onSubmit:v(R),children:[i===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre(s)"}),e.jsx(t,{name:"first_name",control:n,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})})]}),r.first_name&&e.jsxs(e.Fragment,{children:[r.first_name.length<3&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe tener menos de 3 caracteres"}),r.first_name.length>50&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe exceder los 50 caracteres"}),r.first_name.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Primer apellido"}),e.jsx(t,{name:"last_name_1",control:n,rules:{required:"El primer apellido es obligatorio"},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})})]}),r.last_name_1&&e.jsxs(e.Fragment,{children:[r.last_name_1.length<3&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener menos de 3 caracteres"}),r.last_name_1.length>50&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe exceder los 50 caracteres"}),r.last_name_1.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener espacios"}),r.last_name_1.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El primer apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Segundo apellido"}),e.jsx(t,{name:"last_name_2",control:n,render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})})]}),r.last_name_2&&e.jsxs(e.Fragment,{children:[r.last_name_2.length<3&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener menos de 3 caracteres"}),r.last_name_2.length>50&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe exceder los 50 caracteres"}),r.last_name_2.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener espacios"}),r.last_name_2.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre de usuario (CURP)"}),e.jsx(t,{name:"username",control:n,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:18,message:"El nombre de usuario no debe exceder los 18 caracteres"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre de usuario (CURP)"})}),o.username&&e.jsx("p",{className:"text-red-600",children:o.username.message})]}),r.username&&e.jsxs(e.Fragment,{children:[r.username.length<3&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe tener menos de 3 caracteres"}),r.username.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe tener espacios"}),r.username.length>18&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe exceder los 18 caracteres"}),r.username.match(/[^a-zA-Z0-9]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario solo puede contener letras y números"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Empresa"}),e.jsx(t,{name:"company_id",control:n,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),o.company_id&&e.jsx("p",{className:"text-red-600",children:o.company_id.message})]}),r.company_id&&e.jsx(e.Fragment,{children:r.company_id===""&&e.jsx("p",{className:"text-red-600",children:"La empresa es obligatoria"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Puesto"}),e.jsx(t,{name:"position_id",control:n,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:d("company_id")==="",children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),F.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),o.position_id&&e.jsx("p",{className:"text-red-600",children:o.position_id.message})]}),r.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Contraseña"}),e.jsx(t,{name:"password",control:n,rules:{required:"La contraseña es obligatoria"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña"})}),o.password&&e.jsx("p",{className:"text-red-600",children:o.password.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Confirmar contraseña"}),e.jsx(t,{name:"password_confirmation",control:n,rules:{required:"Debe confirmar la contraseña",validate:s=>s===_("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})})]}),f&&g&&f!==g&&e.jsx("p",{className:"text-red-600",children:"Las contraseñas no coinciden"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"button",className:"btn btn-block",onClick:()=>m(i+1),disabled:!j,children:"Siguiente"})}),!j&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]}),i===2&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4",children:e.jsxs("label",{htmlFor:"enable_permissions",className:"flex items-center",children:[e.jsx(t,{name:"enable_permissions",control:n,defaultValue:!1,render:({field:s})=>e.jsx("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:s.value,onChange:a=>s.onChange(a.target.checked),id:"enable_permissions"})}),e.jsx("span",{className:"ml-2",children:"Habilitar permisos"})]})}),V&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"mb-3 text-xl text-center font-bold",children:"Permisos"}),$.map(({category:s,permissions:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(c=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:_("selected_permissions").includes(c.id),onChange:()=>Z(c.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:c.description})]},c.id))})]},s))]}),e.jsxs("div",{className:"mt-4 flex justify-center",children:[e.jsx("button",{type:"button",className:"btn size-2/4 mr-1",onClick:()=>m(i-1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn size-2/4 ml-1",children:"Guardar"})]})]})]}),q&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"¡Empleado registrado con éxito!"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{h(!1),m(1)},children:"Cerrar"})})]})}),z&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Error al registrar el empleado"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!1),children:"Cerrar"})})]})})]})}export{H as default};
