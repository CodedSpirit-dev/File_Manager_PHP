import{r as t,a as r,j as e}from"./app-5APUolP4.js";import{u as z,C as m}from"./index.esm-DeB698kE.js";function K({onClose:u,onSuccess:w}){const{control:c,handleSubmit:C,formState:{errors:l,isValid:E},reset:P}=z({mode:"onChange",defaultValues:{name:"",company_id:"",hierarchy_level:""}}),[i,p]=t.useState(1),[M,R]=t.useState([]),[k,F]=t.useState([]),[q,A]=t.useState([]),[o,L]=t.useState([]),[G,H]=t.useState(""),[D,h]=t.useState(""),[x,_]=t.useState(!1),d=t.useRef(null),V=t.useRef(null),j=t.useRef(null);t.useEffect(()=>{r.get("/admin/companies").then(s=>R(s.data)).catch(s=>console.error("Error al cargar las empresas",s)),r.get("/api/hierarchylevels").then(s=>F(s.data)).catch(s=>console.error("Error al cargar los niveles jerárquicos",s)),r.get("/api/permissions").then(s=>A(s.data)).catch(()=>h("Error al cargar los permisos disponibles."))},[]);const b={Empresas:["can_create_companies","can_delete_companies","can_update_companies"],Puestos:["can_create_positions","can_update_positions","can_delete_positions"],Usuarios:["can_create_users","can_delete_users","can_update_users","can_view_company_users","can_view_all_users"],"Gestión de Archivos y Carpetas":["can_view_file_explorer","can_open_files","can_upload_files_and_folders","can_create_folders","can_download_files_and_folders","can_copy_files","can_move_files","can_rename_files_and_folders","can_delete_files_and_folders"]},$=Object.keys(b).map(s=>({category:s,permissions:q.filter(a=>b[s].includes(a.name))})),B=s=>{L(a=>a.includes(s)?a.filter(n=>n!==s):[...a,s])},O=async s=>{var a,n,f,g,N,v;_(!0);try{const S=(await r.post("/admin/positions",s)).data.id;S&&o.length>0&&await r.post("/api/positionpermissions",{position_id:S,permissions:o}),H("El puesto ha sido registrado exitosamente."),P(),(a=j.current)==null||a.close(),(n=d.current)==null||n.showModal()}catch(y){(f=j.current)==null||f.close(),h(((N=(g=y.response)==null?void 0:g.data)==null?void 0:N.message)||"Hubo un error al registrar el puesto."),(v=V.current)==null||v.showModal()}finally{_(!1)}},U=()=>{var s;(s=d.current)==null||s.close(),w(),u()};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"modal-box",children:[e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${i>=1?"step-primary":""}`,children:"Información Básica"}),e.jsx("li",{className:`step ${i===2?"step-primary":""}`,children:"Asignar Permisos"})]}),e.jsxs("form",{onSubmit:C(O),children:[i===1&&e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Registro de Nuevo Puesto"}),e.jsx("div",{children:e.jsxs("label",{className:"input__data__entry mt-4",htmlFor:"company_id",children:[e.jsx(m,{name:"company_id",control:c,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,id:"company_id",className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),M.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),l.company_id&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l.company_id.message})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"input__data__entry",htmlFor:"hierarchy_level",children:[e.jsx(m,{name:"hierarchy_level",control:c,rules:{required:"El nivel jerárquico es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,id:"hierarchy_level",className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Seleccione un nivel jerárquico"}),k.map(a=>e.jsx("option",{value:a.level,children:a.name},a.level))]})}),l.hierarchy_level&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l.hierarchy_level.message})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"input__data__entry",htmlFor:"name",children:[e.jsx(m,{name:"name",control:c,rules:{required:"El nombre del puesto es obligatorio",minLength:{value:3,message:"El nombre debe tener al menos 3 caracteres"}},render:({field:s})=>e.jsx("input",{...s,placeholder:"Nombre del puesto",id:"name",className:"input input-bordered w-full"})}),l.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l.name.message})]})}),e.jsxs("div",{className:"mt-6 flex items-center",children:[e.jsx("button",{type:"button",className:"btn-warning-mod mx-2",onClick:u,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn-accept mx-2",onClick:()=>p(2),disabled:!E,children:"Siguiente"})]})]}),i===2&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-3 text-xl text-center font-bold",children:"Asignar Permisos"}),e.jsx("div",{className:"overflow-y-auto max-h-80",children:$.map(({category:s,permissions:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(n=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:o.includes(n.id),onChange:()=>B(n.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:n.description})]},n.id))})]},s))}),e.jsxs("div",{className:"mt-6 flex",children:[e.jsx("button",{type:"button",className:"btn-warning-mod mx-2",onClick:()=>p(1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn-accept mx-2",disabled:x,children:x?e.jsx("span",{className:"loading loading-spinner"}):"Guardar"})]})]})]}),e.jsx("dialog",{ref:d,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-center",children:"Éxito"}),e.jsx("p",{className:"py-4 text-center text-green-600",children:G}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:U,children:"Aceptar"})})]})})]})})}export{K as default};
