import{r as t,b as h,j as e}from"./app-1oKc2Cmq.js";import{u as V,C as n}from"./index.esm-COIu_2hA.js";const A=({employee:i,positions:_,companies:N,onClose:f})=>{const{control:l,handleSubmit:g,setValue:m,watch:p,getValues:j,formState:{errors:r}}=V({mode:"onChange",defaultValues:{first_name:i.first_name,last_name_1:i.last_name_1,last_name_2:i.last_name_2||"",username:i.username,position_id:i.position_id,company_id:i.company_id,password:"",password_confirmation:"",enable_permissions:!1,selected_permissions:[]}}),[v,y]=t.useState([]),[E,C]=t.useState([]),[o,c]=t.useState(1),[S,x]=t.useState(!1),[k,u]=t.useState(!1),b=p("company_id"),P=p("enable_permissions");t.useEffect(()=>{h.get("/api/permissions").then(s=>y(s.data)).catch(s=>console.error("Error al cargar los permisos",s))},[]),t.useEffect(()=>{const s=_.filter(a=>a.company_id===Number(b));C(s),m("position_id",0)},[b,_]);const w=s=>{const a=j("selected_permissions");a.includes(s)?m("selected_permissions",a.filter(d=>d!==s)):m("selected_permissions",[...a,s])},z=s=>{if(o<2)c(o+1);else{const a={...s,position_id:s.position_id,company_id:s.company_id};h.patch(`/admin/employees/${i.id}`,a).then(d=>{const q=d.data.id;s.enable_permissions?h.post("/api/userpermissions",{employee_id:q,permissions:s.selected_permissions}).then(()=>{x(!0),c(1)}).catch(F=>{console.error("Error al asignar permisos",F),u(!0)}):(x(!0),c(1))}).catch(d=>{console.error("Error al actualizar el empleado",d),u(!0)})}};return e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Editar Empleado"}),e.jsxs("form",{onSubmit:g(z),children:[o===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre(s)"}),e.jsx(n,{name:"first_name",control:l,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})}),r.first_name&&e.jsx("p",{className:"text-red-600",children:r.first_name.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Primer apellido"}),e.jsx(n,{name:"last_name_1",control:l,rules:{required:"El primer apellido es obligatorio"},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})}),r.last_name_1&&e.jsx("p",{className:"text-red-600",children:r.last_name_1.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Segundo apellido"}),e.jsx(n,{name:"last_name_2",control:l,render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre de usuario (CURP)"}),e.jsx(n,{name:"username",control:l,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:18,message:"El nombre de usuario no debe exceder los 18 caracteres"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre de usuario (CURP)"})}),r.username&&e.jsx("p",{className:"text-red-600",children:r.username.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Empresa"}),e.jsx(n,{name:"company_id",control:l,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),N.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),r.company_id&&e.jsx("p",{className:"text-red-600",children:r.company_id.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Puesto"}),e.jsx(n,{name:"position_id",control:l,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:p("company_id")===null,children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),E.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),r.position_id&&e.jsx("p",{className:"text-red-600",children:r.position_id.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Contraseña (opcional)"}),e.jsx(n,{name:"password",control:l,render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña (dejar vacío si no desea cambiar)"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Confirmar contraseña (opcional)"}),e.jsx(n,{name:"password_confirmation",control:l,render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})})]}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{type:"button",className:"btn",onClick:()=>c(o+1),children:"Siguiente"})})]}),o===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"enable_permissions",children:"Habilitar permisos"}),e.jsx(n,{name:"enable_permissions",control:l,defaultValue:!1,render:({field:s})=>e.jsx("input",{type:"checkbox",className:"ml-2 checkbox checkbox-primary",checked:s.value,onChange:a=>s.onChange(a.target.checked)})})]}),P&&e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"mb-3 text-xl text-center font-black block",children:"Permisos"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:v.map(s=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:j("selected_permissions").includes(s.id),onChange:()=>w(s.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:s.permission_description})]},s.id))})]}),e.jsxs("div",{className:"mt-4 flex justify-center",children:[e.jsx("button",{type:"button",className:"btn size-2/4 mr-1",onClick:()=>c(o-1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn size-2/4 ml-1",children:"Guardar"})]})]})]}),S&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"¡Empleado actualizado con éxito!"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{x(!1),f()},children:"Cerrar"})})]})}),k&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Error al actualizar el empleado"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!1),children:"Cerrar"})})]})})]})})};export{A as default};
