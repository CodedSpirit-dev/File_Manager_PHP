import{q as Se,r as o,j as s}from"./app-DZROxu_n.js";import{F as Me,B as Ie,a as Re,b as Te,c as ke,d as De,e as Oe,f as Ae,g as Pe,h as Ue,i as Le,j as Ve,k as He,l as $e,m as ze,n as Je,o as qe,p as Ge,q as Xe,r as Ke,s as We,t as Qe,u as Ye,v as Ze,w as _e,x as es,y as ss,z as rs,A as ts,C as as,D as os,E as ns,G as ls,H as is,I as cs,J as ps,K as ds,L as us,M as ms,N as fs,O as xs,P as hs,Q as ys,R as js,S as vs,T as Fs,U as bs,V as ws,W as Cs,X as gs}from"./Toolbar-BnRvI0R9.js";import N from"./Modal-DVWlYwr5.js";import Es from"./FileViewer-CXf1MxWY.js";import{G as Z}from"./index-Ds-d5GIs.js";import{getFilesTree as Bs,createFolder as Ns,uploadDirectory as Ss,uploadFile as Ms,downloadFile as Is,downloadFolder as Rs,deleteFile as Ts,deleteFolder as ks,copyFile as Ds,moveFile as Os,renameFile as As}from"./fileManagerApi-CTbtxvMu.js";import Ps from"./Breadcrumb-DyTy73b1.js";function Us(f){return Z({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(f)}function Ls(f){return Z({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(f)}const Ks=()=>{var X;const{auth:f}=Se().props,_=((X=f.user)==null?void 0:X.permissions)||[],[n,m]=o.useState(null),[p,S]=o.useState([]),[c,L]=o.useState("public"),[V,ee]=o.useState([]),[se,F]=o.useState(!1),[M,H]=o.useState(""),[$,z]=o.useState(!1),[b,re]=o.useState(null),[x,I]=o.useState(!1),[R,T]=o.useState(null),[h,k]=o.useState(!1),[D,O]=o.useState(null),[te,A]=o.useState(!1),[ae,oe]=o.useState(""),[ne,le]=o.useState(""),[Vs,ie]=o.useState("success"),[y,w]=o.useState(!1),[C,g]=o.useState(""),[P,E]=o.useState(""),[j,U]=o.useState(!0);o.useEffect(()=>{d(),m(null)},[]),o.useEffect(()=>{ce(V,c),m(null)},[c,V]);const d=async()=>{try{const r={name:"public",path:"public",type:"folder",children:await Bs()};ee([r])}catch(e){console.error("Error fetching files tree:",e),t("Error","Error al obtener el árbol de archivos.","error")}},ce=(e,r)=>{var K,W;const a=r.split("/").filter(Boolean);let l={children:e};for(const v of a){const Q=(K=l.children)==null?void 0:K.find(Y=>Y.name===v&&Y.type==="folder");if(Q)l=Q;else{console.error("Ruta no encontrada en el árbol:",r),S([]);return}}let u=1;const i=((W=l.children)==null?void 0:W.map(v=>({id:u++,name:v.name,type:v.type,date:new Date,path:v.path})))||[];S(i)},pe=e=>{L(e)},de=e=>{var a;switch((a=e.split(".").pop())==null?void 0:a.toLowerCase()){case"aac":return s.jsx(gs,{});case"ai":return s.jsx(Cs,{});case"bmp":return s.jsx(ws,{});case"cs":return s.jsx(bs,{});case"css":return s.jsx(Fs,{});case"csv":return s.jsx(vs,{});case"doc":return s.jsx(js,{});case"docx":return s.jsx(ys,{});case"exe":return s.jsx(hs,{});case"gif":return s.jsx(xs,{});case"heic":return s.jsx(fs,{});case"html":return s.jsx(ms,{});case"java":return s.jsx(us,{});case"jpg":return s.jsx(ds,{});case"js":return s.jsx(ps,{});case"json":return s.jsx(cs,{});case"jsx":return s.jsx(is,{});case"key":return s.jsx(ls,{});case"m4p":return s.jsx(ns,{});case"md":return s.jsx(os,{});case"mdx":return s.jsx(as,{});case"mov":return s.jsx(ts,{});case"mp3":return s.jsx(rs,{});case"mp4":return s.jsx(ss,{});case"otf":return s.jsx(es,{});case"pdf":return s.jsx(_e,{});case"php":return s.jsx(Ze,{});case"png":return s.jsx(Ye,{});case"ppt":return s.jsx(Qe,{});case"pptx":return s.jsx(We,{});case"psd":return s.jsx(Ke,{});case"py":return s.jsx(Xe,{});case"raw":return s.jsx(Ge,{});case"rb":return s.jsx(qe,{});case"sass":return s.jsx(Je,{});case"scss":return s.jsx(ze,{});case"sh":return s.jsx($e,{});case"sql":return s.jsx(He,{});case"svg":return s.jsx(Ve,{});case"tiff":return s.jsx(Le,{});case"tsx":return s.jsx(Ue,{});case"ttf":return s.jsx(Pe,{});case"txt":return s.jsx(Ae,{});case"wav":return s.jsx(Oe,{});case"woff":return s.jsx(De,{});case"xls":return s.jsx(ke,{});case"xlsx":return s.jsx(Te,{});case"xml":return s.jsx(Re,{});case"yml":return s.jsx(Ie,{});default:return s.jsx(Us,{})}},ue=e=>_.includes(e),me=e=>{m(r=>r===e?null:e)},fe=e=>{var r;if(e.type==="folder")L(e.path);else{const a=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();a==="pdf"||a==="docx"||a==="xlsx"?(re({url:`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(c)}`,type:a}),z(!0)):t("Error","Tipo de archivo no soportado para visualización.","error")}},t=(e,r,a)=>{oe(e),le(r),ie(a),A(!0)},xe=()=>{F(!0)},he=async()=>{if(M.trim()===""){t("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const e=await Ns(M,c);t("Éxito","Carpeta creada exitosamente.","success"),d(),H(""),F(!1)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para crear carpetas.","error"):t("Error","Error al crear la carpeta.","error"),console.error(e)}},ye=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const r=await Ss(e.files,c);t("Éxito","Carpeta subida exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para subir carpetas.","error"):t("Error","Error al subir la carpeta.","error"),console.error(r)}},e.click()},je=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const r=await Ms(e.files[0],c);t("Éxito","Archivo subido exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para subir archivos.","error"):t("Error","Error al subir el archivo.","error"),console.error(r)}},e.click()},ve=async()=>{var e,r;if(n){const a=p.find(l=>l.name===n);if(a){if(a.type==="file")try{const l=await Is(a.name,c),u=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=u,i.setAttribute("download",a.name),document.body.appendChild(i),i.click(),(e=i.parentNode)==null||e.removeChild(i),t("Éxito","Archivo descargado exitosamente.","success")}catch(l){l.response&&l.response.status===403?t("Error","No tienes permiso para descargar archivos.","error"):t("Error","Error al descargar el archivo.","error"),console.error(l)}else if(a.type==="folder")try{const l=await Rs(a.name,c),u=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=u,i.setAttribute("download",`${a.name}.zip`),document.body.appendChild(i),i.click(),(r=i.parentNode)==null||r.removeChild(i),t("Éxito","Carpeta descargada exitosamente.","success")}catch(l){l.response&&l.response.status===403?t("Error","No tienes permiso para descargar carpetas.","error"):t("Error","Error al descargar la carpeta.","error"),console.error(l)}}}else t("Error","Por favor, selecciona un elemento para descargar.","error")},Fe=async()=>{if(n&&window.confirm(`¿Estás seguro de que deseas eliminar "${n}"?`))try{const r=p.find(a=>a.name===n);if(r){let a;r.type==="file"?a=await Ts(r.name,c):r.type==="folder"&&(a=await ks(r.name,c)),t("Éxito",a.message||"Elemento eliminado exitosamente.","success"),d(),m(null)}}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para eliminar este elemento.","error"):t("Error","Error al eliminar el elemento.","error"),console.error(r)}},be=async()=>{if(n){const e=p.find(r=>r.name===n);e&&e.type==="file"?(T({filename:e.name,path:c}),I(!0)):t("Error","Solo se pueden copiar archivos.","error")}},we=async()=>{if(R)try{const e=await Ds(R.filename,R.path,c);t("Éxito","Archivo copiado exitosamente.","success"),d(),I(!1),T(null)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para copiar archivos.","error"):t("Error","Error al copiar el archivo.","error"),console.error(e)}},J=()=>{I(!1),T(null)},Ce=async()=>{if(n){const e=p.find(r=>r.name===n);e&&e.type==="file"?(O({filename:e.name,path:c}),k(!0)):t("Error","Solo se pueden mover archivos.","error")}},ge=async()=>{if(D)try{const e=await Os(D.filename,D.path,c);t("Éxito","Archivo movido exitosamente.","success"),d(),k(!1),O(null),m(null)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para mover archivos.","error"):t("Error","Error al mover el archivo.","error"),console.error(e)}},q=()=>{k(!1),O(null)},Ee=()=>{if(n){const e=p.find(r=>r.name===n);if(e){const[r,a]=e.type==="file"?[n.slice(0,n.lastIndexOf("."))||n,n.slice(n.lastIndexOf(".")+1)]:[n,""];g(r),E(a),U(e.type==="file"),w(!0)}}},Be=async e=>{if(e.preventDefault(),C.trim()===""){t("Error","El nombre del elemento no puede estar vacío.","error");return}if(j&&P.trim()===""){t("Error","La extensión del archivo no puede estar vacía.","error");return}const r=j?`${C}.${P}`:C;try{if(n!=null){const a=await As(n,r,c)}t("Éxito","Elemento renombrado exitosamente.","success"),d(),m(null),w(!1),g(""),E(""),U(!0)}catch(a){a.response&&a.response.status===403?t("Error","No tienes permiso para renombrar este elemento.","error"):t("Error","Error al renombrar el elemento.","error"),console.error(a)}},G=()=>{w(!1),g(""),E(""),U(!0)},Ne=({criteria:e,order:r})=>{const a=[...p].sort((l,u)=>{let i=0;return e==="name"?i=l.name.localeCompare(u.name):e==="date"&&(i=new Date(l.date).getTime()-new Date(u.date).getTime()),r==="asc"?i:-i});S(a)},B=o.useCallback(e=>{e.key==="Escape"&&(x&&J(),h&&q(),y&&G())},[x,h,y]);return o.useEffect(()=>(x||h||y?window.addEventListener("keydown",B):window.removeEventListener("keydown",B),()=>{window.removeEventListener("keydown",B)}),[x,h,y,B]),s.jsxs(s.Fragment,{children:[s.jsx(Ps,{currentPath:c,onNavigateTo:pe}),s.jsxs("div",{className:"file-manager bg-white",children:[s.jsx(Me,{onCreateFolder:xe,onUploadFolder:ye,onUploadFile:je,onDownloadFile:ve,onDelete:Fe,onCopy:be,onRename:Ee,onMove:Ce,onSort:Ne,isItemSelected:n!==null,hasPermission:ue,onCopyHere:we,onCancelCopy:J,isCopying:x,onMoveHere:ge,onCancelMove:q,isMoving:h}),s.jsxs(N,{isOpen:se,title:"Crear Nueva Carpeta",onClose:()=>F(!1),children:[s.jsx("input",{type:"text",value:M,onChange:e=>H(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>F(!1),children:"Cancelar"}),s.jsx("button",{className:"btn btn-primary",onClick:he,children:"Crear"})]})]}),$&&b&&b.type&&s.jsxs(N,{isOpen:$,title:`Visualizando: ${n}`,onClose:()=>z(!1),children:[s.jsx("div",{className:"flex justify-between items-center mb-4"}),s.jsx("div",{className:"h-96 overflow-auto",children:s.jsx(Es,{fileUrl:b.url,fileType:b.type})})]}),s.jsx(N,{isOpen:y,title:`Renombrar ${j?"Archivo":"Carpeta"}`,onClose:()=>w(!1),children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),Be(e)},children:[s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsxs("span",{className:"label-text",children:["Nombre ",j?"de archivo":"de carpeta"]})}),s.jsx("input",{type:"text",value:C,onChange:e=>g(e.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]}),j&&s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsx("span",{className:"label-text",children:"Extensión del archivo"})}),s.jsx("input",{type:"text",value:P,onChange:e=>E(e.target.value),className:"input input-bordered w-full",placeholder:"Extensión (ej: txt, pdf)"})]})]}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:G,children:"Cancelar"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),s.jsx("div",{className:"p-4",children:p.length===0?s.jsx("p",{children:"No hay archivos o carpetas disponibles."}):s.jsx("ul",{className:"grid grid-cols-4 gap-4",children:p.map(e=>s.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${n===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>me(e.name),onDoubleClick:()=>fe(e),children:[s.jsx("span",{className:"text-4xl",children:e.type==="folder"?s.jsx(Ls,{}):de(e.name)}),s.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]}),s.jsxs(N,{isOpen:te,title:ae,onClose:()=>A(!1),children:[s.jsx("p",{children:ne}),s.jsx("div",{className:"flex justify-end mt-4",children:s.jsx("button",{className:"btn",onClick:()=>A(!1),children:"Aceptar"})})]})]})};export{Ks as default};
