import{q as G,r as s,b as g,j as a}from"./app-B7hObJoY.js";import{G as N,F as q}from"./Toolbar-iJliH3xg.js";import v from"./Modal-BVSEObfU.js";import J from"./FileViewer-DfMYvLME.js";import{createFolder as K,uploadDirectory as Q,deleteFile as W,deleteFolder as X,updateFolder as Y}from"./api-qNV_Hekx.js";function Z(p){return N({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(p)}function _(p){return N({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(p)}const oe=()=>{var j;const{auth:p}=G().props,D=((j=p.user)==null?void 0:j.permissions)||[],[l,h]=s.useState(null),[c,w]=s.useState([]),[o,x]=s.useState("public"),[E,u]=s.useState(!1),[y,b]=s.useState(""),[F,C]=s.useState(!1),[m,I]=s.useState(null);s.useEffect(()=>{d()},[o]);const d=async()=>{try{const e=await g.get("/filemanager/files",{params:{path:o}});w(S(e.data.directories,e.data.files))}catch(e){console.error("Error fetching files:",e),alert("Error fetching files.")}},k=()=>{const e=o.split("/");e.length>1&&(e.pop(),x(e.join("/")))},S=(e,t)=>{let n=1;const i=e.map(f=>({id:n++,name:f.split("/").pop()||f,type:"folder",date:new Date})),r=t.map(f=>({id:n++,name:f.split("/").pop()||f,type:"file",date:new Date}));return[...i,...r]},T=e=>D.includes(e),V=e=>{h(t=>t===e?null:e)},P=e=>{var t;if(e.type==="folder")x(`${o}/${e.name}`);else{const n=(t=e.name.split(".").pop())==null?void 0:t.toLowerCase();["pdf","docx","xlsx"].includes(n||"")?(I({url:`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(o)}`,name:e.name,filePath:o,fileType:n}),C(!0)):alert("El tipo de archivo no es compatible para visualizaciÃ³n.")}},$=()=>{u(!0)},M=async()=>{if(y.trim()===""){alert("Folder name cannot be empty.");return}try{const e=await K(y,o);alert(e.message),d(),b(""),u(!1)}catch(e){alert("Error creating folder."),console.error(e)}},R=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const t=await Q(e.files,o);alert(t.message),d()}catch(t){alert("Error uploading folder."),console.error(t)}},e.click()},U=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const t=new FormData;t.append("file",e.files[0]),t.append("path",o);const n=await g.post("/filemanager/files/upload",t);alert(n.data.message),d()}catch(t){alert("Error uploading file."),console.error(t)}},e.click()},A=async()=>{var e;if(l){const t=c.find(n=>n.name===l);if(t&&t.type==="file")try{const n=await g.get("/filemanager/files/download",{params:{filename:l,path:o},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([n.data])),r=document.createElement("a");r.href=i,r.setAttribute("download",l),document.body.appendChild(r),r.click(),(e=r.parentNode)==null||e.removeChild(r)}catch(n){alert("Error downloading file."),console.error(n)}else alert("Please select a file to download.")}},O=async()=>{if(l&&window.confirm(`Are you sure you want to delete "${l}"?`))try{const t=c.find(n=>n.name===l);if(t){let n;t.type==="file"?n=await W(l,o):t.type==="folder"&&(n=await X(l,o)),alert(n.message),d(),h(null)}}catch(t){alert("Error deleting item."),console.error(t)}},z=async()=>{l&&alert("Copy functionality not implemented yet.")},B=async()=>{l&&alert("Move functionality not implemented yet.")},H=async()=>{if(l){const e=prompt(`Enter the new name for "${l}":`);if(e&&e.trim()!=="")try{const t=c.find(n=>n.name===l);if(t){let n;if(t.type==="folder")n=await Y(t.name,e,o);else{alert("Renaming files is not implemented yet.");return}alert(n.message),d(),h(null)}}catch(t){alert("Error renaming item."),console.error(t)}}},L=e=>{const t=[...c].sort((n,i)=>e==="date"?new Date(n.date).getTime()-new Date(i.date).getTime():n.name.localeCompare(i.name));w(t)};return a.jsxs("div",{className:"file-manager bg-white",children:[a.jsxs("div",{className:"flex items-center p-4 bg-gray-100 shadow",children:[a.jsx("button",{className:`btn btn-secondary mr-2 ${o==="public"?"btn-disabled":""}`,onClick:k,disabled:o==="public",children:"Back"}),a.jsxs("span",{className:"text-lg font-semibold",children:["Path: /",o]})]}),a.jsx(q,{onCreateFolder:$,onUploadFolder:R,onUploadFile:U,onDownloadFile:A,onDelete:O,onSort:L,isItemSelected:l!==null,hasPermission:T,onCopy:z,onMove:B,onRename:H}),a.jsxs(v,{isOpen:E,title:"Create New Folder",onClose:()=>u(!1),children:[a.jsx("input",{type:"text",value:y,onChange:e=>b(e.target.value),placeholder:"Folder name",className:"input input-bordered w-full"}),a.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[a.jsx("button",{className:"btn btn-secondary",onClick:()=>u(!1),children:"Cancel"}),a.jsx("button",{className:"btn btn-primary",onClick:M,children:"Create"})]})]}),F&&m&&a.jsx(v,{isOpen:F,title:`Visualizando: ${m.name}`,onClose:()=>C(!1),children:a.jsx(J,{fileName:m.name,fileType:m.fileType,filePath:m.filePath})}),a.jsx("div",{className:"p-4",children:c.length===0?a.jsx("p",{children:"No files or folders available."}):a.jsx("ul",{className:"grid grid-cols-4 gap-4",children:c.map(e=>a.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${l===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>V(e.name),onDoubleClick:()=>P(e),children:[a.jsx("span",{className:"text-4xl",children:e.type==="folder"?a.jsx(_,{}):a.jsx(Z,{})}),a.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]})};export{oe as default};
