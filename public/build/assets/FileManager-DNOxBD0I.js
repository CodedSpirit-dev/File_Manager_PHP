import{q as Fe,r as l,j as e}from"./app-DZ3GSyaz.js";import{F as we,B as ge,a as Ce,b as Ne,c as Ee,d as Be,e as Se,f as Me,g as ke,h as Ie,i as Te,j as De,k as Re,l as Ae,m as Oe,n as Pe,o as $e,p as Ue,q as Le,r as Ve,s as He,t as ze,u as qe,v as Je,w as Ge,x as Xe,y as Ke,z as We,A as Qe,C as Ye,D as Ze,E as _e,G as es,H as ss,I as rs,J as ts,K as as,L as os,M as ns,N as ls,O as is,P as cs,Q as ps,R as ds,S as ms,T as us,U as xs,V as fs,W as hs,X as ys}from"./Toolbar-BBAVOtbE.js";import J from"./Modal-FIjcHgO5.js";import js from"./FileViewer-_JQifLnl.js";import{G}from"./index-DJiDpnRq.js";import{getFiles as vs,createFolder as bs,uploadDirectory as Fs,uploadFile as ws,downloadFile as gs,downloadFolder as Cs,deleteFile as Ns,deleteFolder as Es,copyFile as Bs,moveFile as Ss,renameFile as Ms}from"./fileManagerApi-BBtu6ZHR.js";import ks from"./Breadcrumb-D_bWreHn.js";function Is(x){return G({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(x)}function Ts(x){return G({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(x)}const Vs=()=>{var q;const{auth:x}=Fe().props,X=((q=x.user)==null?void 0:q.permissions)||[],[o,f]=l.useState(null),[p,O]=l.useState([]),[i,P]=l.useState("public"),[K,v]=l.useState(!1),[E,$]=l.useState(""),[U,L]=l.useState(!1),[b,W]=l.useState(null),[h,B]=l.useState(!1),[S,M]=l.useState(null),[y,k]=l.useState(!1),[I,T]=l.useState(null),[V,D]=l.useState(!1),[Q,Y]=l.useState(""),[Z,_]=l.useState(""),[Ds,ee]=l.useState("success"),[u,j]=l.useState(!1),[F,w]=l.useState(""),[R,g]=l.useState(""),[C,A]=l.useState(null);l.useEffect(()=>{d(),f(null)},[i]);const d=async()=>{try{const s=await vs(i);O(te(s.directories,s.files))}catch(s){console.error("Error fetching files:",s),t("Error","Error al obtener los archivos.","error")}},se=s=>{P(s)},re=s=>{var a;switch((a=s.split(".").pop())==null?void 0:a.toLowerCase()){case"aac":return e.jsx(ys,{});case"ai":return e.jsx(hs,{});case"bmp":return e.jsx(fs,{});case"cs":return e.jsx(xs,{});case"css":return e.jsx(us,{});case"csv":return e.jsx(ms,{});case"doc":return e.jsx(ds,{});case"docx":return e.jsx(ps,{});case"exe":return e.jsx(cs,{});case"gif":return e.jsx(is,{});case"heic":return e.jsx(ls,{});case"html":return e.jsx(ns,{});case"java":return e.jsx(os,{});case"jpg":return e.jsx(as,{});case"js":return e.jsx(ts,{});case"json":return e.jsx(rs,{});case"jsx":return e.jsx(ss,{});case"key":return e.jsx(es,{});case"m4p":return e.jsx(_e,{});case"md":return e.jsx(Ze,{});case"mdx":return e.jsx(Ye,{});case"mov":return e.jsx(Qe,{});case"mp3":return e.jsx(We,{});case"mp4":return e.jsx(Ke,{});case"otf":return e.jsx(Xe,{});case"pdf":return e.jsx(Ge,{});case"php":return e.jsx(Je,{});case"png":return e.jsx(qe,{});case"ppt":return e.jsx(ze,{});case"pptx":return e.jsx(He,{});case"psd":return e.jsx(Ve,{});case"py":return e.jsx(Le,{});case"raw":return e.jsx(Ue,{});case"rb":return e.jsx($e,{});case"sass":return e.jsx(Pe,{});case"scss":return e.jsx(Oe,{});case"sh":return e.jsx(Ae,{});case"sql":return e.jsx(Re,{});case"svg":return e.jsx(De,{});case"tiff":return e.jsx(Te,{});case"tsx":return e.jsx(Ie,{});case"ttf":return e.jsx(ke,{});case"txt":return e.jsx(Me,{});case"wav":return e.jsx(Se,{});case"woff":return e.jsx(Be,{});case"xls":return e.jsx(Ee,{});case"xlsx":return e.jsx(Ne,{});case"xml":return e.jsx(Ce,{});case"yml":return e.jsx(ge,{});default:return e.jsx(Is,{})}},te=(s,r)=>{let a=1;const c=s.map(n=>({id:a++,name:n.split("/").pop()||n,type:"folder",date:new Date})),m=r.map(n=>({id:a++,name:n.split("/").pop()||n,type:"file",date:new Date}));return[...c,...m]},ae=s=>X.includes(s),oe=s=>{f(r=>r===s?null:s)},ne=s=>{var r;if(s.type==="folder")P(`${i}/${s.name}`);else{const a=(r=s.name.split(".").pop())==null?void 0:r.toLowerCase();a==="pdf"||a==="docx"||a==="xlsx"?(W({url:`/filemanager/files/view?filename=${encodeURIComponent(s.name)}&path=${encodeURIComponent(i)}`,type:a}),L(!0)):t("Error","Tipo de archivo no soportado para visualización.","error")}},t=(s,r,a)=>{Y(s),_(r),ee(a),D(!0)},le=()=>{v(!0)},ie=async()=>{if(E.trim()===""){t("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const s=await bs(E,i);t("Éxito","Carpeta creada exitosamente.","success"),d(),$(""),v(!1)}catch(s){s.response&&s.response.status===403?t("Error","No tienes permiso para crear carpetas.","error"):t("Error","Error al crear la carpeta.","error"),console.error(s)}},ce=async()=>{const s=document.createElement("input");s.type="file",s.webkitdirectory=!0,s.onchange=async()=>{if(s.files&&s.files.length>0)try{const r=await Fs(s.files,i);t("Éxito","Carpeta subida exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para subir carpetas.","error"):t("Error","Error al subir la carpeta.","error"),console.error(r)}},s.click()},pe=async()=>{const s=document.createElement("input");s.type="file",s.onchange=async()=>{if(s.files&&s.files[0])try{const r=await ws(s.files[0],i);t("Éxito","Archivo subido exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para subir archivos.","error"):t("Error","Error al subir el archivo.","error"),console.error(r)}},s.click()},de=async()=>{var s,r;if(o){const a=p.find(c=>c.name===o);if(a)try{if(a.type==="file"){const c=await gs(o,i),m=window.URL.createObjectURL(new Blob([c])),n=document.createElement("a");n.href=m,n.setAttribute("download",o),document.body.appendChild(n),n.click(),(s=n.parentNode)==null||s.removeChild(n),t("Éxito","Archivo descargado exitosamente.","success")}else if(a.type==="folder"){const c=await Cs(o,i),m=window.URL.createObjectURL(new Blob([c])),n=document.createElement("a");n.href=m,n.setAttribute("download",`${o}.zip`),document.body.appendChild(n),n.click(),(r=n.parentNode)==null||r.removeChild(n),t("Éxito","Carpeta descargada exitosamente.","success")}}catch(c){c.response&&c.response.status===403?t("Error",`No tienes permiso para descargar ${a.type}.`,"error"):t("Error",`Error al descargar el ${a.type}.`,"error"),console.error(c)}else t("Error","El elemento seleccionado no existe.","error")}else t("Error","Por favor, selecciona un elemento para descargar.","error")},me=async()=>{if(o&&window.confirm(`¿Estás seguro de que deseas eliminar "${o}"?`))try{const r=p.find(a=>a.name===o);if(r){let a;r.type==="file"?a=await Ns(o,i):r.type==="folder"&&(a=await Es(o,i)),t("Éxito",a.message,"success"),d(),f(null)}}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para eliminar este elemento.","error"):t("Error","Error al eliminar el elemento.","error"),console.error(r)}},ue=async()=>{if(o){const s=p.find(r=>r.name===o);s&&s.type==="file"?(M({filename:o,path:i}),B(!0)):t("Error","Solo se pueden copiar archivos.","error")}},xe=async()=>{if(S)try{const s=await Bs(S.filename,S.path,i);t("Éxito","Archivo copiado exitosamente.","success"),d(),B(!1),M(null)}catch(s){s.response&&s.response.status===403?t("Error","No tienes permiso para copiar archivos.","error"):t("Error","Error al copiar el archivo.","error"),console.error(s)}},H=()=>{B(!1),M(null)},fe=async()=>{if(o){const s=p.find(r=>r.name===o);s&&s.type==="file"?(T({filename:o,path:i}),k(!0)):t("Error","Solo se pueden mover archivos.","error")}},he=async()=>{if(I)try{const s=await Ss(I.filename,I.path,i);t("Éxito","Archivo movido exitosamente.","success"),d(),k(!1),T(null),f(null)}catch(s){s.response&&s.response.status===403?t("Error","No tienes permiso para mover archivos.","error"):t("Error","Error al mover el archivo.","error"),console.error(s)}},z=()=>{k(!1),T(null)},ye=()=>{if(o){const s=p.find(r=>r.name===o);if(s){const[r,a]=o.split(".").length>1?[o.slice(0,o.lastIndexOf(".")),o.slice(o.lastIndexOf(".")+1)]:[o,""];w(r),g(a),A(s.type),j(!0)}}},je=async s=>{if(s.preventDefault(),F.trim()===""){t("Error","El nombre de archivo no puede estar vacío.","error");return}if(C==="file"&&R.trim()===""){t("Error","La extensión del archivo no puede estar vacía.","error");return}let r=F;C==="file"&&(r=`${F}.${R}`);try{const a=await Ms(o,r,i);t("Éxito","Archivo renombrado exitosamente.","success"),d(),f(null),j(!1),w(""),g(""),A(null)}catch(a){a.response&&a.response.status===403?t("Error","No tienes permiso para renombrar este archivo.","error"):t("Error","Error al renombrar el archivo.","error"),console.error(a)}},ve=()=>{j(!1),w(""),g(""),A(null)},be=({criteria:s,order:r})=>{const a=[...p].sort((c,m)=>{let n=0;return s==="name"?n=c.name.localeCompare(m.name):s==="date"&&(n=new Date(c.date).getTime()-new Date(m.date).getTime()),r==="asc"?n:-n});O(a)},N=l.useCallback(s=>{s.key==="Escape"&&(h&&H(),y&&z(),u&&ve())},[h,y,u]);return l.useEffect(()=>(h||y||u?window.addEventListener("keydown",N):window.removeEventListener("keydown",N),()=>{window.removeEventListener("keydown",N)}),[h,y,u,N]),e.jsxs(e.Fragment,{children:[e.jsx(ks,{currentPath:i,onNavigateTo:se}),e.jsxs("div",{className:"file-manager bg-white",children:[e.jsx(we,{onCreateFolder:le,onUploadFolder:ce,onUploadFile:pe,onDownloadFile:de,onDelete:me,onCopy:ue,onRename:ye,onMove:fe,onSort:be,isItemSelected:o!==null,hasPermission:ae,onCopyHere:xe,onCancelCopy:H,isCopying:h,onMoveHere:he,onCancelMove:z,isMoving:y}),e.jsxs(J,{isOpen:K,title:"Crear Nueva Carpeta",onClose:()=>v(!1),children:[e.jsx("input",{type:"text",value:E,onChange:s=>$(s.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:ie,children:"Crear"})]})]}),U&&b&&b.type&&e.jsxs(J,{isOpen:U,title:`Visualizando: ${o}`,onClose:()=>L(!1),children:[e.jsx("div",{className:"flex justify-between items-center mb-4"}),e.jsx("div",{className:"h-96 overflow-auto",children:e.jsx(js,{fileUrl:b.url,fileType:b.type})})]}),e.jsx("dialog",{id:"rename-modal",className:`modal ${u?"modal-open":""}`,open:u,children:e.jsxs("div",{className:"modal-box",children:[e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:()=>j(!1),children:"✕"})}),e.jsx("h3",{className:"text-lg font-bold",children:"Cambiar Nombre"}),C==="file"&&e.jsx("p",{className:"py-2 text-red-500",children:"Cuidado con cambiar la extensión del archivo ya que podría dejar de funcionar."}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Nombre"})}),e.jsx("input",{type:"text",value:F,onChange:s=>w(s.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]}),C==="file"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Extensión del archivo"})}),e.jsx("input",{type:"text",value:R,onChange:s=>g(s.target.value),className:"input input-bordered w-full",placeholder:"Extensión del archivo"})]})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(!1),children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:je,children:"Renombrar"})]})]})}),e.jsx("div",{className:"p-4",children:p.length===0?e.jsx("p",{children:"No hay archivos o carpetas disponibles."}):e.jsx("ul",{className:"grid grid-cols-4 gap-4",children:p.map(s=>e.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${o===s.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>oe(s.name),onDoubleClick:()=>ne(s),children:[e.jsx("span",{className:"text-4xl",children:s.type==="folder"?e.jsx(Ts,{}):re(s.name)}),e.jsx("span",{className:"mt-2 text-center truncate w-full",children:s.name})]},s.id))})})]}),e.jsx("dialog",{id:"status-modal",className:`modal ${V?"modal-open":""}`,open:V,children:e.jsxs("div",{className:"modal-box",children:[e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:()=>D(!1),children:"✕"})}),e.jsx("h3",{className:"text-lg font-bold",children:Q}),e.jsx("p",{className:"py-4",children:Z}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn",onClick:()=>D(!1),children:"Aceptar"})})]})})]})};export{Vs as default};
