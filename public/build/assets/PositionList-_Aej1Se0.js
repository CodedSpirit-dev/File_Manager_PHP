import{r as t,j as e}from"./app-CaPX-28s.js";import R from"./CreatePosition-W_98ZmSs.js";import{getPositions as _,getPositionCounts as $,deletePosition as q}from"./positionApi-D-6ZvByo.js";import z from"./EditPosition-C_rM0Fpa.js";import"./index.esm-B8nDuB3b.js";const J=()=>{const[y,g]=t.useState([]),[E,i]=t.useState(!0),[u,C]=t.useState(null),[h,S]=t.useState(null),[v,b]=t.useState(!1),[P,m]=t.useState(!1),[j,x]=t.useState(null),[p,f]=t.useState(null),[k,D]=t.useState(0),o=t.useRef(null),[a,N]=t.useState(null),[r,c]=t.useState(null);t.useEffect(()=>{d()},[]);const d=async()=>{i(!0);try{const s=await _();g(s),i(!1)}catch{C("Error al cargar los datos de posiciones"),i(!1)}},w=s=>{S(s),b(!0)},L=async s=>{var l;c(s.id);try{const n=await $(s.id);D(n.employees_count),N(s),(l=o.current)==null||l.showModal()}catch{x("Error al obtener datos de la posición.")}finally{c(null)}},M=async()=>{var s,l,n;if(a){c(a.id);try{await q(a.id),f("Puesto eliminado exitosamente."),d()}catch(A){x(((l=(s=A.response)==null?void 0:s.data)==null?void 0:l.message)||"Error al eliminar el puesto.")}finally{(n=o.current)==null||n.close(),N(null),c(null)}}},O=()=>{d(),m(!1)};return E?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):u?e.jsx("div",{className:"text-center text-error",children:u}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-primary",children:"Lista de Puestos"}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx("button",{onClick:()=>m(!0),className:"btn btn-success",children:"Agregar nuevo puesto"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nombre del Puesto"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Empresa"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Cantidad de Empleados"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:y.map(s=>e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:s.name}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:s.company_name||"N/A"}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:s.employees_count??0}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>w(s),className:"btn btn-primary btn-sm",children:"Editar"}),e.jsx("button",{onClick:()=>L(s),className:"btn btn-error btn-sm text-base-100",children:"Eliminar"})]})})]},s.id))})]}),e.jsx("dialog",{ref:o,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsxs("h4",{className:"font-bold text-center",children:["¿Estás seguro de eliminar el puesto ",e.jsx("b",{children:a==null?void 0:a.name})," de la base de datos?"]}),e.jsxs("p",{className:"text-justify mt-2",children:["Se eliminarán ",e.jsx("b",{children:k})," empleados asociados a este puesto. Estos empleados deberán ser reasignados a nuevas empresas y puestos."]}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{var s;return(s=o.current)==null?void 0:s.close()},disabled:!!r,children:"No, cancelar"}),e.jsx("button",{type:"button",onClick:M,className:`btn btn-error ${r?"loading":""}`,disabled:!!r,children:r?"Eliminando...":"Sí, eliminar"})]})]})}),P&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsx(R,{onClose:()=>m(!1),onSuccess:O})}),v&&h&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsx(z,{position:h,onClose:s=>{b(!1),s&&d()}})}),p&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center",children:"Éxito"}),e.jsx("p",{className:"text-center text-green-600",children:p}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{className:"btn btn-success",onClick:()=>f(null),children:"Cerrar"})})]})}),j&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h4",{className:"font-bold text-center",children:"Error al Eliminar Puesto"}),e.jsx("p",{className:"text-center text-red-600",children:j}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{className:"btn btn-error",onClick:()=>x(null),children:"Cerrar"})})]})})]})]})};export{J as default};
