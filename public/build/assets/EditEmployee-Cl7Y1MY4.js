import{r as d,j as e,a as q}from"./app-B4k0VI8F.js";import{u as z,C as i}from"./index.esm-D7Pjkkwa.js";const M=({employee:n,positions:m,companies:y,onClose:E,onSuccess:_})=>{const{control:t,handleSubmit:w,setValue:l,watch:x,getValues:S,formState:{errors:a,isValid:h},reset:c}=z({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",phone_number:"",position_id:"",company_id:"",password:"",password_confirmation:""}}),[L,p]=d.useState([]),[j,b]=d.useState(""),[g,C]=d.useState(null),N=x(),u=x("company_id");d.useEffect(()=>{const s={first_name:n.first_name,last_name_1:n.last_name_1,last_name_2:n.last_name_2||"",username:n.username,phone_number:n.phone_number||"",position_id:n.position_id?n.position_id.toString():"",company_id:n.company_id?n.company_id.toString():"",password:"",password_confirmation:""};c(s);const r=m.filter(o=>o.company_id===Number(s.company_id));p(r),s.position_id&&r.some(o=>o.id.toString()===s.position_id)?l("position_id",s.position_id):l("position_id","")},[n,m,c,l]),d.useEffect(()=>{const s=Number(u);if(s){const r=m.filter(o=>o.company_id===s);p(r),l("position_id","")}else p([]),l("position_id","")},[u,m,l]);const A=s=>{const r={first_name:s.first_name,last_name_1:s.last_name_1,last_name_2:s.last_name_2,phone_number:s.phone_number,username:s.username,company_id:Number(s.company_id),position_id:Number(s.position_id)};s.password&&(r.password=s.password,r.password_confirmation=s.password_confirmation),q.patch(`/admin/employees/${n.id}`,r).then(o=>{C("¡Empleado actualizado con éxito!"),c({...s,password:"",password_confirmation:""}),_()}).catch(o=>{var f,v;console.error("Error al actualizar el empleado",o),b(((v=(f=o.response)==null?void 0:f.data)==null?void 0:v.message)||"Ocurrió un error al actualizar el empleado.")})};return e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"",children:"Editar Usuario"}),e.jsx("ul",{className:"steps w-full",children:e.jsx("li",{className:"step step-primary",children:"Datos del Empleado"})}),e.jsx("form",{className:"form_data_entry",onSubmit:w(A),children:e.jsxs("div",{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"first_name",control:t,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})}),a.first_name&&e.jsx("p",{className:"text-red-600",children:a.first_name.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"last_name_1",control:t,rules:{required:"El primer apellido es obligatorio",minLength:{value:3,message:"El primer apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El primer apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El primer apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})}),a.last_name_1&&e.jsx("p",{className:"text-red-600",children:a.last_name_1.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"last_name_2",control:t,rules:{minLength:{value:3,message:"El segundo apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El segundo apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El segundo apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})}),a.last_name_2&&e.jsx("p",{className:"text-red-600",children:a.last_name_2.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"username",control:t,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:50,message:"El nombre de usuario no debe exceder los 50 caracteres"},pattern:{value:/^\S+@\S+\.\S+$/,message:"El nombre de usuario debe ser un email válido"}},render:({field:s})=>e.jsx("input",{...s,type:"email",className:"input__data__entry",placeholder:"Nombre de usuario (Email)"})}),a.username&&e.jsx("p",{className:"text-red-600",children:a.username.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"phone_number",control:t,rules:{required:"El número de teléfono es obligatorio",maxLength:{value:15,message:"El número de teléfono no debe exceder los 15 caracteres"},pattern:{value:/^[0-9+\-()\s]+$/,message:"El número de teléfono contiene caracteres inválidos"}},render:({field:s})=>e.jsx("input",{...s,type:"text",className:"input__data__entry",placeholder:"Número de teléfono"})}),a.phone_number&&e.jsx("p",{className:"text-red-600",children:a.phone_number.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"company_id",control:t,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),y.map(r=>e.jsx("option",{value:r.id.toString(),children:r.name},r.id))]})}),a.company_id&&e.jsx("p",{className:"text-red-600",children:a.company_id.message})]}),N.company_id===""&&e.jsx("p",{className:"text-red-600",children:"La empresa es obligatoria"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"position_id",control:t,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:!u,children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),L.map(r=>e.jsx("option",{value:r.id.toString(),children:r.name},r.id))]})}),a.position_id&&e.jsx("p",{className:"text-red-600",children:a.position_id.message})]}),N.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"password",control:t,rules:{minLength:{value:4,message:"La contraseña debe tener al menos 4 caracteres"}},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña (dejar vacío si no desea cambiar)"})}),a.password&&e.jsx("p",{className:"text-red-600",children:a.password.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(i,{name:"password_confirmation",control:t,rules:{validate:s=>s===S("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})}),a.password_confirmation&&e.jsx("p",{className:"text-red-600",children:a.password_confirmation.message})]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-cancel",onClick:E,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-accept ml-2",disabled:!h,children:"Guardar"})]}),!h&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]})}),g&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Acción Exitosa"}),e.jsx("p",{className:"py-4",children:g}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:_,children:"Aceptar"})})]})}),j&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-error",children:"Error"}),e.jsx("p",{className:"py-4",children:j}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-error",onClick:()=>b(""),children:"Cerrar"})})]})})]})};export{M as default};
