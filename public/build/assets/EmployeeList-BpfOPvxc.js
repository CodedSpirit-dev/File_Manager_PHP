import{r as a,b as l,j as e}from"./app-CwydSlOL.js";import B from"./EditEmployee-DAp_atdp.js";import G from"./CreateEmployee-CUd7UI-o.js";import"./index.esm-CLML5ayY.js";const V=()=>{const[D,v]=a.useState([]),[u,k]=a.useState([]),[g,M]=a.useState([]),[w,p]=a.useState(!0),[y,A]=a.useState(null),[N,L]=a.useState(null),[P,h]=a.useState(!1),[R,c]=a.useState(!1),[I,E]=a.useState(null),b=a.useRef(null),d=a.useRef(null),[o,S]=a.useState(null),[m,_]=a.useState(!1),[C,f]=a.useState(null),[j,O]=a.useState(null),$=s=>{f(s.id);const t=u.find(r=>r.id===s.position_id),n=t?t.company_id:null,i={...s,company_id:n};Promise.all([l.get("/api/permissions"),l.get(`/api/employees/${s.id}/permissions`)]).then(([r,W])=>{const q=r.data,z=W.data;L(i),O({permissions:q,employeePermissions:z}),h(!0),f(null)}).catch(r=>{console.error("Error al cargar los datos para editar el usuario",r),f(null)})};a.useEffect(()=>{x()},[]);const x=()=>{p(!0),Promise.all([l.get("admin/employees"),l.get("api/positions"),l.get("admin/companies")]).then(([s,t,n])=>{v(s.data),k(t.data),M(n.data),p(!1)}).catch(s=>{console.error("Error al cargar los datos",s),A("Error al cargar los datos"),p(!1)})},T=s=>{var t;S(s),(t=d.current)==null||t.showModal()},U=()=>{o&&(_(!0),l.delete(`admin/employees/${o.id}`).then(()=>{var s,t;E("¡Usuario eliminado con éxito!"),x(),(s=d.current)==null||s.close(),(t=b.current)==null||t.showModal()}).catch(s=>{console.error("Error al eliminar el usuario",s)}).finally(()=>{_(!1),S(null)}))},F=()=>{var s;(s=b.current)==null||s.close(),E(null)};return w?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):y?e.jsx("div",{className:"text-center text-error",children:y}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-primary",children:"LISTA DE USUARIOS"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>c(!0),className:"btn btn-success",children:"Agregar usuario"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Fecha de Registro"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Último Inicio de Sesión"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Puesto"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:D.map(s=>{const t=u.find(i=>i.id===s.position_id),n=t?g.find(i=>i.id===t.company_id):null;return e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:[s.first_name," ",s.last_name_1]}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:new Date(s.registered_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"No registrado"}),e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content",children:[t==null?void 0:t.name,e.jsx("br",{}),n&&e.jsx("span",{className:"mt-1 inline-block bg-secondary text-secondary-content text-xs px-2 py-1 rounded",children:n.name})]}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>$(s),className:"btn btn-primary btn-sm",disabled:C===s.id,children:C===s.id?e.jsx("span",{className:"loading loading-spinner"}):"Editar"}),e.jsx("button",{onClick:()=>T(s),className:"btn btn-error btn-sm text-base-100",children:"Eliminar"})]})})]},s.id)})})]}),P&&N&&j&&e.jsx(B,{employee:N,positions:u,companies:g,permissions:j.permissions,employeePermissions:j.employeePermissions,onClose:()=>h(!1),onSuccess:()=>{h(!1),x()}}),R&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box relative",children:[e.jsx("button",{className:"btn btn-sm btn-circle absolute right-2 top-2",onClick:()=>c(!1),children:"✕"}),e.jsx(G,{onSuccess:()=>{x(),c(!1)},onClose:()=>c(!1)})]})}),e.jsx("dialog",{ref:d,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsx("h4",{className:"font-bold text-center",children:o?`¿Estás seguro de eliminar a ${o.first_name} ${o.last_name_1} de la base de datos?`:"¿Estás seguro de eliminar este usuario de la base de datos?"}),e.jsx("p",{className:"text-justify mt-4",children:"Esta operación no se puede deshacer."}),e.jsxs("div",{className:"modal-action justify-center mt-6",children:[e.jsx("button",{type:"button",className:"btn btn-warning",onClick:()=>{var s;return(s=d.current)==null?void 0:s.close()},disabled:m,children:"No, cancelar"}),e.jsx("button",{type:"button",onClick:U,className:`btn btn-error ${m?"loading":""}`,disabled:m,children:m?"Eliminando...":"Sí, eliminar"})]})]})}),e.jsx("dialog",{ref:b,id:"modal_employee_success",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center",children:"Acción Exitosa"}),e.jsx("p",{className:"text-center text-success",children:I}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{type:"button",className:"btn btn-info",onClick:F,children:"Aceptar"})})]})})]})]})};export{V as default};
