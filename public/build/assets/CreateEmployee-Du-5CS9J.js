import{r as o,a as _,j as e}from"./app-Dbza6AWq.js";import{u as Z,C as l}from"./index.esm-DpAVc0lC.js";function T({onSuccess:v,onClose:E}){const{control:n,handleSubmit:h,setValue:j,watch:t,getValues:i,formState:{errors:a,isValid:b},reset:w}=Z({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",phone_number:"",password:"",password_confirmation:"",company_id:"",position_id:""}}),[g,C]=o.useState([]),[S,M]=o.useState([]),[L,R]=o.useState([]),[q,A]=o.useState(""),[P,U]=o.useState(null),c=t(),d=o.useRef(null),m=o.useRef(null),u=o.useRef(null);o.useEffect(()=>{_.get("api/positions").then(s=>C(s.data)).catch(s=>console.error("Error al cargar los puestos",s)),_.get("admin/companies").then(s=>M(s.data)).catch(s=>console.error("Error al cargar las empresas",s))},[]);const N=t("company_id");o.useEffect(()=>{const s=g.filter(r=>r.company_id===Number(N));R(s),j("position_id","")},[N,g,j]);const k=()=>{var s;(s=d.current)==null||s.showModal()},p=()=>{var s;(s=d.current)==null||s.close()},$=()=>{var s;(s=m.current)==null||s.showModal()},F=()=>{var s;(s=m.current)==null||s.close(),v()},O=()=>{var s;(s=u.current)==null||s.showModal()},V=()=>{var s;(s=u.current)==null||s.close()},z=s=>{const r={first_name:s.first_name,last_name_1:s.last_name_1,last_name_2:s.last_name_2,phone_number:s.phone_number,username:s.username,password:s.password,password_confirmation:s.password_confirmation,company_id:Number(s.company_id),position_id:Number(s.position_id)};_.post("/admin/employees",r).then(x=>{U("¡Usuario registrado con éxito!"),w(),p(),$()}).catch(x=>{var f,y;console.error("Error al registrar el usuario",x),A(((y=(f=x.response)==null?void 0:f.data)==null?void 0:y.message)||"Ocurrió un error al registrar el usuario."),p(),O()})};return e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"",children:"Registro de nuevos usuarios"}),e.jsx("ul",{className:"steps w-full",children:e.jsx("li",{className:"step step-primary",children:"Datos del Usuario"})}),e.jsx("form",{className:"form_data_entry",onSubmit:h(k),children:e.jsxs("div",{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"first_name",control:n,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})}),a.first_name&&e.jsx("p",{className:"text-red-600",children:a.first_name.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"last_name_1",control:n,rules:{required:"El primer apellido es obligatorio",minLength:{value:3,message:"El primer apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El primer apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El primer apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})}),a.last_name_1&&e.jsx("p",{className:"text-red-600",children:a.last_name_1.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"last_name_2",control:n,rules:{minLength:{value:3,message:"El segundo apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El segundo apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El segundo apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})}),a.last_name_2&&e.jsx("p",{className:"text-red-600",children:a.last_name_2.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"username",control:n,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:50,message:"El nombre de usuario no debe exceder los 50 caracteres"},pattern:{value:/^\S+@\S+\.\S+$/,message:"El nombre de usuario debe ser un email válido"}},render:({field:s})=>e.jsx("input",{...s,type:"email",className:"input__data__entry",placeholder:"Nombre de usuario (Email)"})}),a.username&&e.jsx("p",{className:"text-red-600",children:a.username.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"phone_number",control:n,rules:{required:"El número de teléfono es obligatorio",maxLength:{value:15,message:"El número de teléfono no debe exceder los 15 caracteres"},pattern:{value:/^\+((52|1)[\s\-]?)?(\(?\d{2,3}\)?[\s\-]?)?(\d{3}[\s\-]?\d{2,4}[\s\-]?\d{4})$/,message:"El número de teléfono debe ser un número válido de México o EE. UU."}},render:({field:s})=>e.jsx("input",{...s,type:"text",className:"input__data__entry",placeholder:"Número de teléfono"})}),a.phone_number&&e.jsx("p",{className:"text-red-600",children:a.phone_number.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"company_id",control:n,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),S.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})}),a.company_id&&e.jsx("p",{className:"text-red-600",children:a.company_id.message})]}),c.company_id&&e.jsx(e.Fragment,{children:c.company_id===""&&e.jsx("p",{className:"text-red-600",children:"La empresa es obligatoria"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"position_id",control:n,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:t("company_id")==="",children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),L.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})}),a.position_id&&e.jsx("p",{className:"text-red-600",children:a.position_id.message})]}),c.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"password",control:n,rules:{required:"La contraseña es obligatoria",minLength:{value:6,message:"La contraseña debe tener al menos 6 caracteres"}},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña"})}),a.password&&e.jsx("p",{className:"text-red-600",children:a.password.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"password_confirmation",control:n,rules:{required:"Debe confirmar la contraseña",validate:s=>s===i("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})}),a.password_confirmation&&e.jsx("p",{className:"text-red-600",children:a.password_confirmation.message})]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-cancel",onClick:E,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-accept ml-2",disabled:!b,children:"Guardar"})]}),!b&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]})}),e.jsx("dialog",{ref:d,id:"modal_employee_confirm",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsxs("h4",{className:"font-bold text-center",children:["¿Estás seguro de registrar al usuario ",e.jsxs("b",{children:[i("first_name")," ",i("last_name_1")]}),"?"]}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:p,children:"No, cancelar"}),e.jsx("button",{type:"button",className:"btn-accept",onClick:h(z),children:"Sí, registrar usuario"})]})]})}),e.jsx("dialog",{ref:m,id:"modal_employee_success",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center",children:"Registro de Usuario"}),e.jsx("p",{className:"text-center text-success",children:P}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{type:"button",className:"btn btn-info",onClick:F,children:"Aceptar"})})]})}),e.jsx("dialog",{ref:u,id:"modal_employee_error",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h4",{className:"font-bold text-center",children:"Error al Registrar Usuario"}),e.jsx("p",{className:"text-center text-error",children:q}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{className:"btn-accept",onClick:V,children:"Cerrar"})})]})})]})}export{T as default};
