import{q as P,r as c,j as a,b as T}from"./app-CLNopbFG.js";import{G as v,F as V}from"./Toolbar-DV2OTHU5.js";import B from"./Modal-8nWZ71ur.js";import{getFiles as O,createFolder as R,uploadFile as z,deleteFile as A}from"./api-ombY7JLs.js";function G(i){return v({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(i)}function L(i){return v({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(i)}const W=()=>{var y;const{auth:i}=P().props,w=((y=i.user)==null?void 0:y.permissions)||[],[n,f]=c.useState(null),[d,b]=c.useState([]),[s,g]=c.useState("public"),[F,p]=c.useState(!1),[h,x]=c.useState("");c.useEffect(()=>{u()},[s]);const u=async()=>{try{const e=await O(s),t=C(e.directories,e.files);b(t)}catch(e){console.error("Error al obtener archivos:",e),alert("Error al obtener archivos.")}},C=(e,t)=>{let r=1;const o=e.map(m=>({id:r++,name:m.split("/").pop()||m,type:"folder",date:new Date})),l=t.map(m=>({id:r++,name:m.split("/").pop()||m,type:"file",date:new Date}));return[...o,...l]},j=e=>w.includes(e),N=e=>{f(t=>t===e?null:e)},E=e=>{e.type==="folder"?g(`${s}/${e.name}`):alert(`Abrir archivo: ${e.name}`)},D=()=>{const e=s.split("/");e.length>1&&(e.pop(),g(e.join("/")))},I=()=>{p(!0)},k=async()=>{if(h.trim()===""){alert("El nombre de la carpeta no puede estar vacío.");return}try{const e=await R(h,s);alert(e.message),u(),x(""),p(!1)}catch(e){alert("Error al crear la carpeta."),console.error(e)}},S=()=>{alert("Funcionalidad de subir carpeta no implementada aún.")},U=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const t=await z(e.files[0],s);alert(t.message),u()}catch(t){alert("Error al subir el archivo."),console.error(t)}},e.click()},$=async()=>{var e;if(n){const t=d.find(r=>r.name===n);if(t&&t.type==="file")try{const r=await T.get("/filemanager/files/download",{params:{filename:n,path:s},responseType:"blob"}),o=window.URL.createObjectURL(new Blob([r.data])),l=document.createElement("a");l.href=o,l.setAttribute("download",n),document.body.appendChild(l),l.click(),(e=l.parentNode)==null||e.removeChild(l)}catch(r){alert("Error al descargar el archivo."),console.error(r)}else alert("Por favor, selecciona un archivo para descargar.")}},H=async()=>{if(n&&window.confirm(`¿Estás seguro de eliminar "${n}"?`))try{const t=d.find(r=>r.name===n);if(t){if(t.type==="file"){const r=await A(n,s);alert(r.message)}else if(t.type==="folder"){alert("Eliminar carpetas no está implementado aún.");return}u(),f(null)}}catch(t){alert("Error al eliminar el elemento."),console.error(t)}},M=e=>{const t=[...d].sort((r,o)=>e==="date"?new Date(r.date).getTime()-new Date(o.date).getTime():r.name.localeCompare(o.name));b(t)};return a.jsxs("div",{className:"file-manager bg-white",children:[a.jsxs("div",{className:"flex items-center p-4 bg-gray-100 shadow",children:[a.jsx("button",{className:`btn btn-secondary mr-2 ${s==="public"?"btn-disabled":""}`,onClick:D,disabled:s==="public",children:"Volver"}),a.jsxs("span",{className:"text-lg font-semibold",children:["Ruta: /",s]})]}),a.jsx(V,{onCreateFolder:I,onUploadFolder:S,onUploadFile:U,onDownloadFile:$,onDelete:H,onSort:M,isItemSelected:n!==null,hasPermission:j}),a.jsxs(B,{isOpen:F,title:"Crear Nueva Carpeta",onClose:()=>p(!1),children:[a.jsx("input",{type:"text",value:h,onChange:e=>x(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),a.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[a.jsx("button",{className:"btn btn-secondary",onClick:()=>p(!1),children:"Cancelar"}),a.jsx("button",{className:"btn btn-primary",onClick:k,children:"Crear"})]})]}),a.jsx("div",{className:"p-4",children:d.length===0?a.jsx("p",{children:"No hay archivos o carpetas disponibles."}):a.jsx("ul",{className:"grid grid-cols-4 gap-4",children:d.map(e=>a.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${n===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>N(e.name),onDoubleClick:()=>E(e),children:[a.jsx("span",{className:"text-4xl",children:e.type==="folder"?a.jsx(L,{}):a.jsx(G,{})}),a.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]})};export{W as default};
