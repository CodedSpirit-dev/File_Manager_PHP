import{r as p,j as e,b as v}from"./app-EiJ4knnL.js";import{u as G,C as o}from"./index.esm-BzUwNG8z.js";const R=({employee:l,positions:u,companies:A,permissions:$,employeePermissions:E,onClose:w,onSuccess:j})=>{const{control:t,handleSubmit:z,setValue:c,watch:g,getValues:N,formState:{errors:n,isValid:C},reset:x}=G({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",position_id:"",company_id:"",password:"",password_confirmation:"",enable_permissions:!1,selected_permissions:[]}}),[F,f]=p.useState([]),[m,h]=p.useState(1),[S,b]=p.useState(""),[k,L]=p.useState(null),V=g(),q=g("enable_permissions"),y=g("company_id"),P={Empresas:["can_create_companies","can_delete_companies","can_update_companies"],Puestos:["can_create_positions","can_update_positions","can_delete_positions"],Empleados:["can_create_employees","can_delete_employees","can_update_employees","can_view_company_employees","can_view_all_employees"],"Gestión de Archivos y Carpetas":["can_view_file_explorer","can_open_files","can_upload_files_and_folders","can_create_folders","can_download_files_and_folders","can_copy_files","can_move_files","can_rename_files_and_folders","can_delete_files_and_folders"]},M=Object.keys(P).map(s=>({category:s,permissions:$.filter(a=>P[s].includes(a.name))}));p.useEffect(()=>{const s=E.map(r=>r.id),a={first_name:l.first_name,last_name_1:l.last_name_1,last_name_2:l.last_name_2||"",username:l.username,position_id:l.position_id?l.position_id.toString():"",company_id:l.company_id?l.company_id.toString():"",password:"",password_confirmation:"",enable_permissions:s.length>0,selected_permissions:s};x(a);const i=u.filter(r=>r.company_id===Number(a.company_id));f(i),a.position_id&&i.some(r=>r.id.toString()===a.position_id)?c("position_id",a.position_id):c("position_id","")},[l,E,u,x,c]),p.useEffect(()=>{const s=Number(y);if(s){const a=u.filter(i=>i.company_id===s);f(a),c("position_id","")}else f([]),c("position_id","")},[y,u,c]);const O=s=>{const a=N("selected_permissions");a.includes(s)?c("selected_permissions",a.filter(i=>i!==s)):c("selected_permissions",[...a,s])},Z=s=>{const a={first_name:s.first_name,last_name_1:s.last_name_1,last_name_2:s.last_name_2,username:s.username,company_id:Number(s.company_id),position_id:Number(s.position_id)};s.password&&(a.password=s.password,a.password_confirmation=s.password_confirmation),v.patch(`/admin/employees/${l.id}`,a).then(i=>{s.enable_permissions?v.post("/api/userpermissions",{employee_id:l.id,permissions:s.selected_permissions}).then(()=>{L("¡Empleado actualizado con éxito!"),x(),h(1),j()}).catch(r=>{var d,_;console.error("Error al asignar permisos",r),b(((_=(d=r.response)==null?void 0:d.data)==null?void 0:_.message)||"Ocurrió un error al asignar permisos.")}):v.delete(`/api/userpermissions/${l.id}`).then(()=>{L("¡Empleado actualizado con éxito!"),x(),h(1),j()}).catch(r=>{var d,_;console.error("Error al eliminar permisos",r),b(((_=(d=r.response)==null?void 0:d.data)==null?void 0:_.message)||"Ocurrió un error al eliminar permisos.")})}).catch(i=>{var r,d;console.error("Error al actualizar el empleado",i),b(((d=(r=i.response)==null?void 0:r.data)==null?void 0:d.message)||"Ocurrió un error al actualizar el empleado.")})};return e.jsxs("div",{children:[e.jsx("h3",{className:"",children:"Editar Usuario"}),e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${m>=1?"step-primary":""}`,children:"Datos del Empleado"}),e.jsx("li",{className:`step ${m===2?"step-primary":""}`,children:"Permisos"})]}),e.jsxs("form",{className:"form_data_entry",onSubmit:z(Z),children:[m===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{name:"first_name",control:t,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})}),n.first_name&&e.jsx("p",{className:"text-red-600",children:n.first_name.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{name:"last_name_1",control:t,rules:{required:"El primer apellido es obligatorio",minLength:{value:3,message:"El primer apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El primer apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El primer apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})}),n.last_name_1&&e.jsx("p",{className:"text-red-600",children:n.last_name_1.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{name:"last_name_2",control:t,rules:{minLength:{value:3,message:"El segundo apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El segundo apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El primer apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})}),n.last_name_2&&e.jsx("p",{className:"text-red-600",children:n.last_name_2.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{name:"username",control:t,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:50,message:"El nombre de usuario no debe exceder los 50 caracteres"},pattern:{value:/^\S+@\S+\.\S+$/,message:"El nombre de usuario debe ser un email válido"}},render:({field:s})=>e.jsx("input",{...s,type:"email",className:"input__data__entry",placeholder:"Nombre de usuario (Email)"})}),n.username&&e.jsx("p",{className:"text-red-600",children:n.username.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{name:"company_id",control:t,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),A.map(a=>e.jsx("option",{value:a.id.toString(),children:a.name},a.id))]})}),n.company_id&&e.jsx("p",{className:"text-red-600",children:n.company_id.message})]}),V.company_id===""&&e.jsx("p",{className:"text-red-600",children:"La empresa es obligatoria"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{name:"position_id",control:t,render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:!y,children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),F.map(a=>e.jsx("option",{value:a.id.toString(),children:a.name},a.id))]})}),n.position_id&&e.jsx("p",{className:"text-red-600",children:n.position_id.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{name:"password",control:t,rules:{minLength:{value:4,message:"La contraseña debe tener al menos 4 caracteres"}},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña (dejar vacío si no desea cambiar)"})}),n.password&&e.jsx("p",{className:"text-red-600",children:n.password.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{name:"password_confirmation",control:t,rules:{validate:s=>s===N("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})}),n.password_confirmation&&e.jsx("p",{className:"text-red-600",children:n.password_confirmation.message})]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-cancel",onClick:w,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-accept ml-2",onClick:()=>h(m+1),disabled:!C,children:"Siguiente"})]}),!C&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]}),m===2&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4",children:e.jsxs("label",{htmlFor:"enable_permissions",className:"flex items-center",children:[e.jsx(o,{name:"enable_permissions",control:t,render:({field:s})=>e.jsx("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:s.value,onChange:a=>s.onChange(a.target.checked),id:"enable_permissions"})}),e.jsx("span",{className:"ml-2",children:"Habilitar permisos"})]})}),q&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"mb-3 text-xl text-center font-bold",children:"Permisos"}),M.map(({category:s,permissions:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(i=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:N("selected_permissions").includes(i.id),onChange:()=>O(i.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:i.description})]},i.id))})]},s))]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-cancel",onClick:w,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn-info-mod mx-2",onClick:()=>h(m-1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn btn-success",children:"Guardar"})]})]})]}),k&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Acción Exitosa"}),e.jsx("p",{className:"py-4",children:k}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:j,children:"Aceptar"})})]})}),S&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-error",children:"Error"}),e.jsx("p",{className:"py-4",children:S}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-error",onClick:()=>b(""),children:"Cerrar"})})]})})]})};export{R as default};
