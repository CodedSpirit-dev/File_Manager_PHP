import{q as Re,r as n,j as s,b as Te}from"./app-C-tb7Vy8.js";import{F as Oe,B as De,a as Ae,b as Pe,c as Le,d as He,e as Ue,f as ze,g as Ve,h as $e,i as qe,j as Ge,k as Je,l as Ke,m as Xe,n as We,o as Ye,p as _e,q as Qe,r as Ze,s as es,t as ss,v as rs,w as ts,x as as,y as os,z as ns,A as ls,C as is,D as cs,E as ps,G as ds,H as ms,I as us,J as fs,K as xs,L as hs,M as ys,N as js,O as Fs,Q as bs,R as gs,S as vs,T as ws,U as Cs,V as Bs,W as Es,X as Ns,Y as Ss,Z as Ms}from"./Toolbar-BK7doiRq.js";import z from"./Modal-C2jue6Pb.js";import Is from"./FileViewerModal-Bx1QIOnS.js";import{G as ee}from"./index-C-ux25at.js";import{getFilesTree as ks,createFolder as Rs,uploadDirectory as Ts,uploadFile as Os,downloadFile as Ds,downloadFolder as As,deleteFile as Ps,deleteFolder as Ls,copyFile as Hs,moveFile as Us,renameFile as zs}from"./fileManagerApi-j-BCsAx4.js";import Vs from"./Breadcrumb-YgaPMZXh.js";import"./FileViewer-YcZhUxhe.js";function $s(h){return ee({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(h)}function qs(h){return ee({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(h)}const er=()=>{var _;const{auth:h}=Re().props;(_=h.user)!=null&&_.permissions;const[l,f]=n.useState([]),[m,S]=n.useState([]),[i,y]=n.useState(""),[M,se]=n.useState(null),[g,re]=n.useState([]),[I,te]=n.useState(1),[ae,v]=n.useState(!1),[k,V]=n.useState(""),[$,q]=n.useState(!1),[w,oe]=n.useState(null),[G,ne]=n.useState(!0),[j,R]=n.useState(!1),[T,O]=n.useState(null),[F,D]=n.useState(!1),[A,P]=n.useState(null),[le,L]=n.useState(!1),[ie,ce]=n.useState(""),[pe,de]=n.useState(""),[Gs,me]=n.useState("success"),[b,C]=n.useState(!1),[H,B]=n.useState(""),[U,J]=n.useState(!0);n.useEffect(()=>{(async()=>{try{await Promise.all([ue(),u()]),K(g,i),f([])}catch(r){console.error("Error al inicializar datos:",r)}finally{ne(!1)}})()},[]),n.useEffect(()=>{g.length>0&&K(g,i)},[g,i]);const ue=async()=>{try{const e=await Te.get("/filemanager/hierarchy-company",{withCredentials:!0}),{hierarchy_level:r,company_name:t}=e.data;te(r),se(t);const o=`public/${t}`;y(o)}catch(e){console.error("Error al obtener jerarquía y empresa:",e)}},u=async()=>{try{const e=await ks();re([{name:"public",path:"public",type:"folder",children:e}])}catch(e){console.error("Error fetching files tree:",e),a("Error","Error al obtener el árbol de archivos.","error")}},K=(e,r)=>{var c,Q;const t=r.split("/").filter(Boolean);let o={children:e};for(const x of t){const N=(c=o.children)==null?void 0:c.find(Z=>Z.name===x&&Z.type==="folder");if(N)o=N;else{console.error("Ruta no encontrada en el árbol:",r),S([]);return}}let p=1;const d=((Q=o.children)==null?void 0:Q.map(x=>({id:p++,name:x.name,type:x.type,date:new Date,path:x.path})))||[];d.sort((x,N)=>x.name.localeCompare(N.name)),S(d)},fe=e=>{var t;switch((t=e.split(".").pop())==null?void 0:t.toLowerCase()){case"aac":return s.jsx(Ms,{});case"ai":return s.jsx(Ss,{});case"bmp":return s.jsx(Ns,{});case"cs":return s.jsx(Es,{});case"css":return s.jsx(Bs,{});case"csv":return s.jsx(Cs,{});case"doc":return s.jsx(ws,{});case"docx":return s.jsx(vs,{});case"exe":return s.jsx(gs,{});case"gif":return s.jsx(bs,{});case"heic":return s.jsx(Fs,{});case"html":return s.jsx(js,{});case"java":return s.jsx(ys,{});case"jpg":case"jpeg":return s.jsx(hs,{});case"js":return s.jsx(xs,{});case"json":return s.jsx(fs,{});case"jsx":return s.jsx(us,{});case"key":return s.jsx(ms,{});case"m4p":return s.jsx(ds,{});case"md":return s.jsx(ps,{});case"mdx":return s.jsx(cs,{});case"mov":return s.jsx(is,{});case"mp3":return s.jsx(ls,{});case"mp4":return s.jsx(ns,{});case"otf":return s.jsx(os,{});case"pdf":return s.jsx(as,{});case"php":return s.jsx(ts,{});case"png":return s.jsx(rs,{});case"ppt":return s.jsx(ss,{});case"pptx":return s.jsx(es,{});case"psd":return s.jsx(Ze,{});case"py":return s.jsx(Qe,{});case"raw":return s.jsx(_e,{});case"rb":return s.jsx(Ye,{});case"sass":return s.jsx(We,{});case"scss":return s.jsx(Xe,{});case"sh":return s.jsx(Ke,{});case"sql":return s.jsx(Je,{});case"svg":return s.jsx(Ge,{});case"tiff":return s.jsx(qe,{});case"tsx":return s.jsx($e,{});case"ttf":return s.jsx(Ve,{});case"txt":return s.jsx(ze,{});case"wav":return s.jsx(Ue,{});case"woff":return s.jsx(He,{});case"xls":return s.jsx(Le,{});case"xlsx":return s.jsx(Pe,{});case"xml":return s.jsx(Ae,{});case"yml":return s.jsx(De,{});default:return s.jsx($s,{})}},xe=(e,r)=>{r.ctrlKey||r.metaKey?f(t=>t.includes(e)?t.filter(o=>o!==e):[...t,e]):f(t=>t.includes(e)&&t.length===1?[]:[e])},he=e=>{var r;if(e.type==="folder")y(e.path);else{const t=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();t==="pdf"||t==="docx"||t==="xlsx"?(oe({url:`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(i)}`,type:t}),q(!0)):a("Error","Tipo de archivo no soportado para visualización.","error")}},a=(e,r,t)=>{ce(e),de(r),me(t),L(!0)},ye=()=>{v(!0)},je=async()=>{if(k.trim()===""){a("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const e=await Rs(k,i);a("Éxito","Carpeta creada exitosamente.","success"),u(),V(""),v(!1)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para crear carpetas.","error"):a("Error","Error al crear la carpeta.","error"),console.error(e)}},Fe=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const r=await Ts(e.files,i);a("Éxito","Carpeta subida exitosamente.","success"),u()}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para subir carpetas.","error"):a("Error","Error al subir la carpeta.","error"),console.error(r)}},e.click()},be=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const r=await Os(e.files[0],i);a("Éxito","Archivo subido exitosamente.","success"),u()}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para subir archivos.","error"):a("Error","Error al subir el archivo.","error"),console.error(r)}},e.click()},ge=async()=>{var e,r;if(l.length>0)try{for(const t of l){const o=m.find(p=>p.name===t);if(o){if(o.type==="file"){const p=await Ds(o.name,i),d=window.URL.createObjectURL(new Blob([p])),c=document.createElement("a");c.href=d,c.setAttribute("download",o.name),document.body.appendChild(c),c.click(),(e=c.parentNode)==null||e.removeChild(c)}else if(o.type==="folder"){const p=await As(o.name,i),d=window.URL.createObjectURL(new Blob([p])),c=document.createElement("a");c.href=d,c.setAttribute("download",`${o.name}.zip`),document.body.appendChild(c),c.click(),(r=c.parentNode)==null||r.removeChild(c)}}}a("Éxito","Elemento(s) descargado(s) exitosamente.","success")}catch(t){t.response&&t.response.status===403?a("Error","No tienes permiso para descargar uno o más elementos.","error"):a("Error","Error al descargar uno o más elementos.","error"),console.error(t)}else a("Error","Por favor, selecciona al menos un elemento para descargar.","error")},ve=async()=>{if(l.length>0&&window.confirm(`¿Estás seguro de que deseas eliminar ${l.length} elemento(s)?`))try{for(const r of l){const t=m.find(o=>o.name===r);t&&(t.type==="file"?await Ps(t.name,i):t.type==="folder"&&await Ls(t.name,i))}a("Éxito","Elemento(s) eliminado(s) exitosamente.","success"),u(),f([])}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para eliminar uno o más elementos.","error"):a("Error","Error al eliminar uno o más elementos.","error"),console.error(r)}},we=async()=>{l.length>0&&(l.every(r=>{const t=m.find(o=>o.name===r);return t&&t.type==="file"})?(O({filenames:l,path:i}),R(!0)):a("Error","Solo se pueden copiar archivos.","error"))},Ce=async()=>{if(T)try{for(const e of T.filenames)await Hs(e,T.path,i);a("Éxito","Archivo(s) copiado(s) exitosamente.","success"),u(),R(!1),O(null),f([])}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para copiar uno o más archivos.","error"):a("Error","Error al copiar uno o más archivos.","error"),console.error(e)}},X=()=>{R(!1),O(null)},Be=async()=>{l.length>0&&(l.every(r=>{const t=m.find(o=>o.name===r);return t&&t.type==="file"})?(P({filenames:l,path:i}),D(!0)):a("Error","Solo se pueden mover archivos.","error"))},Ee=async()=>{if(A)try{for(const e of A.filenames)await Us(e,A.path,i);a("Éxito","Archivo(s) movido(s) exitosamente.","success"),u(),D(!1),P(null),f([])}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para mover uno o más archivos.","error"):a("Error","Error al mover uno o más archivos.","error"),console.error(e)}},W=()=>{D(!1),P(null)},Ne=()=>{if(l.length===1){const e=l[0],r=m.find(t=>t.name===e);if(r){const t=r.type==="file"&&r.name.slice(0,r.name.lastIndexOf("."))||r.name;B(t),J(r.type==="file"),C(!0)}}else a("Error","Solo puedes renombrar un elemento a la vez.","error")},Se=async e=>{if(e.preventDefault(),H.trim()===""){a("Error","El nombre del elemento no puede estar vacío.","error");return}let r=H;if(U){const t=m.find(o=>o.name===l[0]);if(t){const o=t.name.lastIndexOf("."),p=o!==-1?t.name.slice(o):"";r+=p}}try{if(l.length===1&&l[0]!=null){const t=await zs(l[0],r,i);a("Éxito","Elemento renombrado exitosamente.","success"),u(),f([]),C(!1),B("")}}catch(t){t.response&&t.response.status===403?a("Error","No tienes permiso para renombrar este elemento.","error"):a("Error","Error al renombrar el elemento.","error"),console.error(t)}},Y=()=>{C(!1),B(""),J(!0)},Me=({criteria:e,order:r})=>{const t=[...m].sort((o,p)=>{let d=0;return e==="name"&&(d=o.name.localeCompare(p.name)),r==="asc"?d:-d});S(t)},E=n.useCallback(e=>{e.key==="Escape"&&(j&&X(),F&&W(),b&&Y())},[j,F,b]);n.useEffect(()=>(j||F||b?window.addEventListener("keydown",E):window.removeEventListener("keydown",E),()=>{window.removeEventListener("keydown",E)}),[j,F,b,E]);const Ie=()=>{const e=i.split("/").filter(Boolean);if(e.length>1){e.pop();const r=e.join("/");y(r)}else y("public")},ke=i!==`public/${M}`||I<=1;return s.jsxs(s.Fragment,{children:[I!==null&&M&&!G&&s.jsx(Vs,{currentPath:i,onNavigateTo:y,hierarchyLevel:I,companyName:M}),s.jsxs("div",{className:"file-manager bg-white min-h-fit",children:[s.jsx(Oe,{onCreateFolder:ye,onUploadFolder:Fe,onUploadFile:be,onDownloadFile:ge,onDelete:ve,onCopy:we,onRename:Ne,onMove:Be,onSort:Me,isItemSelected:l.length>0,onCopyHere:Ce,onCancelCopy:X,isCopying:j,onMoveHere:Ee,onCancelMove:W,isMoving:F,onBack:Ie,canGoBack:ke,selectedItemsCount:l.length}),s.jsxs(z,{isOpen:ae,title:"Crear Nueva Carpeta",onClose:()=>v(!1),children:[s.jsx("input",{type:"text",value:k,onChange:e=>V(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancelar"}),s.jsx("button",{className:"btn btn-primary",onClick:je,children:"Crear"})]})]}),$&&w&&w.type&&s.jsx(Is,{isOpen:$,fileUrl:w.url,fileType:w.type,onClose:()=>q(!1)}),s.jsx(z,{isOpen:b,title:`Renombrar ${U?"Archivo":"Carpeta"}`,onClose:()=>C(!1),children:s.jsxs("form",{onSubmit:Se,children:[s.jsx("div",{className:"flex flex-col space-y-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsxs("span",{className:"label-text",children:["Nombre ",U?"de archivo":"de carpeta"]})}),s.jsx("input",{type:"text",value:H,onChange:e=>B(e.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]})}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,children:"Cancelar"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),s.jsx("div",{className:"p-4",children:G?s.jsx("div",{className:"flex justify-center items-center",children:s.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):m.length===0?s.jsx("p",{className:"text-center text-gray-500",children:"No hay archivos o carpetas disponibles."}):s.jsx("ul",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4",children:m.map(e=>s.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center relative ${l.includes(e.name)?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:r=>xe(e.name,r),onDoubleClick:()=>he(e),children:[s.jsx("span",{className:"text-4xl",children:e.type==="folder"?s.jsx(qs,{}):fe(e.name)}),s.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name}),l.includes(e.name)&&s.jsx("span",{className:"absolute top-2 right-2 bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center",children:"✓"})]},e.id))})})]}),s.jsxs(z,{isOpen:le,title:ie,onClose:()=>L(!1),children:[s.jsx("p",{children:pe}),s.jsx("div",{className:"flex justify-end mt-4",children:s.jsx("button",{className:"btn",onClick:()=>L(!1),children:"Aceptar"})})]})]})};export{er as default};
