import{r as n,b as d,j as e}from"./app-B7hObJoY.js";import{u as $,C as t}from"./index.esm-B9eEAOqR.js";function M(){const{control:l,handleSubmit:y,setValue:p,watch:i,getValues:x,formState:{errors:m,isValid:_},reset:b}=$({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",password:"",password_confirmation:"",company_id:"",position_id:"",enable_permissions:!1,selected_permissions:[]}}),[N,v]=n.useState([]),[C,w]=n.useState([]),[S,P]=n.useState([]),[k,F]=n.useState([]),[A,h]=n.useState(!1),[q,u]=n.useState(!1),[o,c]=n.useState(1),z=2,a=i(),g=i("password"),f=i("password_confirmation"),L=i("enable_permissions");n.useEffect(()=>{d.get("api/positions").then(s=>v(s.data)).catch(s=>console.error("Error al cargar los puestos",s)),d.get("api/permissions").then(s=>P(s.data)).catch(s=>console.error("Error al cargar los permisos",s)),d.get("admin/companies").then(s=>w(s.data)).catch(s=>console.error("Error al cargar las empresas",s))},[]);const E=i("company_id");n.useEffect(()=>{const s=N.filter(r=>r.company_id===Number(E));F(s),p("position_id","")},[E,N]);const V=s=>{const r=x("selected_permissions");r.includes(s)?p("selected_permissions",r.filter(j=>j!==s)):p("selected_permissions",[...r,s])},Z=s=>{o<z?c(o+1):d.post("/admin/employees/store",s).then(r=>{const j=r.data.id;s.enable_permissions?d.post("/api/userpermissions",{employee_id:j,permissions:s.selected_permissions}).then(()=>{h(!0),b(),c(1)}).catch(R=>{console.error("Error al asignar permisos",R),u(!0)}):(h(!0),b(),c(1))}).catch(r=>{console.error("Error al registrar el empleado",r),u(!0)})};return e.jsxs("div",{className:"container__25",children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Registro de nuevos empleados"}),e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${o>=1?"step-primary":""}`,children:"Datos del empleado"}),e.jsx("li",{className:`step ${o===2?"step-primary":""}`,children:"Permisos"})]}),e.jsxs("form",{onSubmit:y(Z),children:[o===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre(s)"}),e.jsx(t,{name:"first_name",control:l,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})})]}),a.first_name&&e.jsxs(e.Fragment,{children:[a.first_name.length<3&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe tener menos de 3 caracteres"}),a.first_name.length>50&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe exceder los 50 caracteres"}),a.first_name.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Primer apellido"}),e.jsx(t,{name:"last_name_1",control:l,rules:{required:"El primer apellido es obligatorio"},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})})]}),a.last_name_1&&e.jsxs(e.Fragment,{children:[a.last_name_1.length<3&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener menos de 3 caracteres"}),a.last_name_1.length>50&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe exceder los 50 caracteres"}),a.last_name_1.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener espacios"}),a.last_name_1.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El primer apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Segundo apellido"}),e.jsx(t,{name:"last_name_2",control:l,render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})})]}),a.last_name_2&&e.jsxs(e.Fragment,{children:[a.last_name_2.length<3&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener menos de 3 caracteres"}),a.last_name_2.length>50&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe exceder los 50 caracteres"}),a.last_name_2.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener espacios"}),a.last_name_2.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre de usuario (CURP)"}),e.jsx(t,{name:"username",control:l,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:18,message:"El nombre de usuario no debe exceder los 18 caracteres"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre de usuario (CURP)"})}),m.username&&e.jsx("p",{className:"text-red-600",children:m.username.message})]}),a.username&&e.jsxs(e.Fragment,{children:[a.username.length<3&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener menos de 3 caracteres"}),a.username.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener espacios"}),a.username.length>50&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe exceder los 50 caracteres"}),a.username.match(/[^a-zA-Z0-9]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario apellido solo puede contener letras y numeros"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Empresa"}),e.jsx(t,{name:"company_id",control:l,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),C.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})})]}),a.company_id&&e.jsx(e.Fragment,{children:a.company_id===""&&e.jsx("p",{className:"text-red-600",children:"El puesto es obligatorio"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Puesto"}),e.jsx(t,{name:"position_id",control:l,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:i("company_id")==="",children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),k.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})})]}),a.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),a.position_id&&e.jsx(e.Fragment,{children:a.position_id===""&&e.jsx("p",{className:"text-red-600",children:"El puesto es obligatorio"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Contraseña"}),e.jsx(t,{name:"password",control:l,rules:{required:"La contraseña es obligatoria"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña"})}),m.password&&e.jsx("p",{className:"text-red-600",children:m.password.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Confirmar contraseña"}),e.jsx(t,{name:"password_confirmation",control:l,rules:{required:"Debe confirmar la contraseña",validate:s=>s===x("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})})]}),g&&f&&g!==f&&e.jsx("p",{className:"text-red-600",children:"Las contraseñas no coinciden"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"button",className:"btn btn-block",onClick:()=>c(o+1),disabled:!_,children:"Siguiente"})}),!_&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]}),o===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"enable_permissions",children:"Habilitar permisos"}),e.jsx(t,{name:"enable_permissions",control:l,defaultValue:!1,render:({field:s})=>e.jsx("input",{type:"checkbox",className:"ml-2 checkbox checkbox-primary",checked:s.value,onChange:r=>s.onChange(r.target.checked),name:s.name,ref:s.ref,onBlur:s.onBlur})})]}),L&&e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"mb-3 text-xl text-center font-black block",children:"Permisos"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:S.map(s=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:x("selected_permissions").includes(s.id),onChange:()=>V(s.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:s.description})]},s.id))})]}),e.jsxs("div",{className:"mt-4 flex justify-center",children:[e.jsx("button",{type:"button",className:"btn size-2/4 mr-1",onClick:()=>c(o-1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn size-2/4 ml-1",children:"Guardar"})]})]})]}),A&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"¡Empleado registrado con éxito!"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{h(!1),c(1)},children:"Cerrar"})})]})}),q&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Error al registrar el empleado"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!1),children:"Cerrar"})})]})})]})}export{M as default};
