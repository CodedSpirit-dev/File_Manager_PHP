import{q as Ne,r as o,j as s}from"./app-5lgFhUDD.js";import{F as Se,B as Me,a as Ie,b as Te,c as ke,d as Re,e as De,f as Oe,g as Ae,h as Pe,i as Ue,j as Le,k as Ve,l as He,m as $e,n as ze,o as Je,p as qe,q as Ge,r as Xe,s as Ke,t as We,u as Qe,v as Ye,w as Ze,x as _e,y as es,z as ss,A as rs,C as ts,D as as,E as os,G as ns,H as ls,I as is,J as cs,K as ps,L as ds,M as us,N as ms,O as fs,P as xs,Q as hs,R as ys,S as js,T as vs,U as Fs,V as bs,W as ws,X as Cs}from"./Toolbar-ClX1l5Vw.js";import N from"./Modal-_7LlsPlq.js";import gs from"./FileViewer-DdPrq2hK.js";import{G as Y}from"./index-D1WNgpnD.js";import{getFilesTree as Es,createFolder as Bs,uploadDirectory as Ns,uploadFile as Ss,downloadFile as Ms,downloadFolder as Is,deleteFile as Ts,deleteFolder as ks,copyFile as Rs,moveFile as Ds,renameFile as Os}from"./fileManagerApi-DJetiOuY.js";import As from"./Breadcrumb-_MNRdxme.js";function Ps(m){return Y({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(m)}function Us(m){return Y({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(m)}const Ks=()=>{var G;const{auth:m}=Ne().props,Z=((G=m.user)==null?void 0:G.permissions)||[],[n,f]=o.useState(null),[p,S]=o.useState([]),[c,L]=o.useState("public"),[Ls,_]=o.useState([]),[ee,F]=o.useState(!1),[M,V]=o.useState(""),[H,$]=o.useState(!1),[b,se]=o.useState(null),[x,I]=o.useState(!1),[T,k]=o.useState(null),[h,R]=o.useState(!1),[D,O]=o.useState(null),[re,A]=o.useState(!1),[te,ae]=o.useState(""),[oe,ne]=o.useState(""),[Vs,le]=o.useState("success"),[y,w]=o.useState(!1),[C,g]=o.useState(""),[P,E]=o.useState(""),[j,U]=o.useState(!0);o.useEffect(()=>{d(),f(null)},[]);const d=async()=>{try{const e=await Es();_(e),ie(e,c)}catch(e){console.error("Error fetching files tree:",e),t("Error","Error al obtener el árbol de archivos.","error")}},ie=(e,r)=>{var X,K;const a=r.split("/").filter(Boolean);let l={children:e};for(const v of a){const W=(X=l.children)==null?void 0:X.find(Q=>Q.name===v&&Q.type==="folder");if(W)l=W;else{console.error("Ruta no encontrada en el árbol:",r),S([]);return}}let u=1;const i=((K=l.children)==null?void 0:K.map(v=>({id:u++,name:v.name,type:v.type,date:new Date,path:v.path})))||[];S(i)},ce=e=>{L(e)},pe=e=>{var a;switch((a=e.split(".").pop())==null?void 0:a.toLowerCase()){case"aac":return s.jsx(Cs,{});case"ai":return s.jsx(ws,{});case"bmp":return s.jsx(bs,{});case"cs":return s.jsx(Fs,{});case"css":return s.jsx(vs,{});case"csv":return s.jsx(js,{});case"doc":return s.jsx(ys,{});case"docx":return s.jsx(hs,{});case"exe":return s.jsx(xs,{});case"gif":return s.jsx(fs,{});case"heic":return s.jsx(ms,{});case"html":return s.jsx(us,{});case"java":return s.jsx(ds,{});case"jpg":return s.jsx(ps,{});case"js":return s.jsx(cs,{});case"json":return s.jsx(is,{});case"jsx":return s.jsx(ls,{});case"key":return s.jsx(ns,{});case"m4p":return s.jsx(os,{});case"md":return s.jsx(as,{});case"mdx":return s.jsx(ts,{});case"mov":return s.jsx(rs,{});case"mp3":return s.jsx(ss,{});case"mp4":return s.jsx(es,{});case"otf":return s.jsx(_e,{});case"pdf":return s.jsx(Ze,{});case"php":return s.jsx(Ye,{});case"png":return s.jsx(Qe,{});case"ppt":return s.jsx(We,{});case"pptx":return s.jsx(Ke,{});case"psd":return s.jsx(Xe,{});case"py":return s.jsx(Ge,{});case"raw":return s.jsx(qe,{});case"rb":return s.jsx(Je,{});case"sass":return s.jsx(ze,{});case"scss":return s.jsx($e,{});case"sh":return s.jsx(He,{});case"sql":return s.jsx(Ve,{});case"svg":return s.jsx(Le,{});case"tiff":return s.jsx(Ue,{});case"tsx":return s.jsx(Pe,{});case"ttf":return s.jsx(Ae,{});case"txt":return s.jsx(Oe,{});case"wav":return s.jsx(De,{});case"woff":return s.jsx(Re,{});case"xls":return s.jsx(ke,{});case"xlsx":return s.jsx(Te,{});case"xml":return s.jsx(Ie,{});case"yml":return s.jsx(Me,{});default:return s.jsx(Ps,{})}},de=e=>Z.includes(e),ue=e=>{f(r=>r===e?null:e)},me=e=>{var r;if(e.type==="folder")L(e.path);else{const a=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();a==="pdf"||a==="docx"||a==="xlsx"?(se({url:`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(c)}`,type:a}),$(!0)):t("Error","Tipo de archivo no soportado para visualización.","error")}},t=(e,r,a)=>{ae(e),ne(r),le(a),A(!0)},fe=()=>{F(!0)},xe=async()=>{if(M.trim()===""){t("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const e=await Bs(M,c);t("Éxito","Carpeta creada exitosamente.","success"),d(),V(""),F(!1)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para crear carpetas.","error"):t("Error","Error al crear la carpeta.","error"),console.error(e)}},he=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const r=await Ns(e.files,c);t("Éxito","Carpeta subida exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para subir carpetas.","error"):t("Error","Error al subir la carpeta.","error"),console.error(r)}},e.click()},ye=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const r=await Ss(e.files[0],c);t("Éxito","Archivo subido exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para subir archivos.","error"):t("Error","Error al subir el archivo.","error"),console.error(r)}},e.click()},je=async()=>{var e,r;if(n){const a=p.find(l=>l.name===n);if(a){if(a.type==="file")try{const l=await Ms(a.name,c),u=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=u,i.setAttribute("download",a.name),document.body.appendChild(i),i.click(),(e=i.parentNode)==null||e.removeChild(i),t("Éxito","Archivo descargado exitosamente.","success")}catch(l){l.response&&l.response.status===403?t("Error","No tienes permiso para descargar archivos.","error"):t("Error","Error al descargar el archivo.","error"),console.error(l)}else if(a.type==="folder")try{const l=await Is(a.name,c),u=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=u,i.setAttribute("download",`${a.name}.zip`),document.body.appendChild(i),i.click(),(r=i.parentNode)==null||r.removeChild(i),t("Éxito","Carpeta descargada exitosamente.","success")}catch(l){l.response&&l.response.status===403?t("Error","No tienes permiso para descargar carpetas.","error"):t("Error","Error al descargar la carpeta.","error"),console.error(l)}}}else t("Error","Por favor, selecciona un elemento para descargar.","error")},ve=async()=>{if(n&&window.confirm(`¿Estás seguro de que deseas eliminar "${n}"?`))try{const r=p.find(a=>a.name===n);if(r){let a;r.type==="file"?a=await Ts(r.name,c):r.type==="folder"&&(a=await ks(r.name,c)),t("Éxito",a.message||"Elemento eliminado exitosamente.","success"),d(),f(null)}}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para eliminar este elemento.","error"):t("Error","Error al eliminar el elemento.","error"),console.error(r)}},Fe=async()=>{if(n){const e=p.find(r=>r.name===n);e&&e.type==="file"?(k({filename:e.name,path:c}),I(!0)):t("Error","Solo se pueden copiar archivos.","error")}},be=async()=>{if(T)try{const e=await Rs(T.filename,T.path,c);t("Éxito","Archivo copiado exitosamente.","success"),d(),I(!1),k(null)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para copiar archivos.","error"):t("Error","Error al copiar el archivo.","error"),console.error(e)}},z=()=>{I(!1),k(null)},we=async()=>{if(n){const e=p.find(r=>r.name===n);e&&e.type==="file"?(O({filename:e.name,path:c}),R(!0)):t("Error","Solo se pueden mover archivos.","error")}},Ce=async()=>{if(D)try{const e=await Ds(D.filename,D.path,c);t("Éxito","Archivo movido exitosamente.","success"),d(),R(!1),O(null),f(null)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para mover archivos.","error"):t("Error","Error al mover el archivo.","error"),console.error(e)}},J=()=>{R(!1),O(null)},ge=()=>{if(n){const e=p.find(r=>r.name===n);if(e){const[r,a]=e.type==="file"?[n.slice(0,n.lastIndexOf("."))||n,n.slice(n.lastIndexOf(".")+1)]:[n,""];g(r),E(a),U(e.type==="file"),w(!0)}}},Ee=async e=>{if(e.preventDefault(),C.trim()===""){t("Error","El nombre del elemento no puede estar vacío.","error");return}if(j&&P.trim()===""){t("Error","La extensión del archivo no puede estar vacía.","error");return}const r=j?`${C}.${P}`:C;try{if(n!=null){const a=await Os(n,r,c)}t("Éxito","Elemento renombrado exitosamente.","success"),d(),f(null),w(!1),g(""),E(""),U(!0)}catch(a){a.response&&a.response.status===403?t("Error","No tienes permiso para renombrar este elemento.","error"):t("Error","Error al renombrar el elemento.","error"),console.error(a)}},q=()=>{w(!1),g(""),E(""),U(!0)},Be=({criteria:e,order:r})=>{const a=[...p].sort((l,u)=>{let i=0;return e==="name"?i=l.name.localeCompare(u.name):e==="date"&&(i=new Date(l.date).getTime()-new Date(u.date).getTime()),r==="asc"?i:-i});S(a)},B=o.useCallback(e=>{e.key==="Escape"&&(x&&z(),h&&J(),y&&q())},[x,h,y]);return o.useEffect(()=>(x||h||y?window.addEventListener("keydown",B):window.removeEventListener("keydown",B),()=>{window.removeEventListener("keydown",B)}),[x,h,y,B]),s.jsxs(s.Fragment,{children:[s.jsx(As,{currentPath:c,onNavigateTo:ce}),s.jsxs("div",{className:"file-manager bg-white",children:[s.jsx(Se,{onCreateFolder:fe,onUploadFolder:he,onUploadFile:ye,onDownloadFile:je,onDelete:ve,onCopy:Fe,onRename:ge,onMove:we,onSort:Be,isItemSelected:n!==null,hasPermission:de,onCopyHere:be,onCancelCopy:z,isCopying:x,onMoveHere:Ce,onCancelMove:J,isMoving:h}),s.jsxs(N,{isOpen:ee,title:"Crear Nueva Carpeta",onClose:()=>F(!1),children:[s.jsx("input",{type:"text",value:M,onChange:e=>V(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>F(!1),children:"Cancelar"}),s.jsx("button",{className:"btn btn-primary",onClick:xe,children:"Crear"})]})]}),H&&b&&b.type&&s.jsxs(N,{isOpen:H,title:`Visualizando: ${n}`,onClose:()=>$(!1),children:[s.jsx("div",{className:"flex justify-between items-center mb-4"}),s.jsx("div",{className:"h-96 overflow-auto",children:s.jsx(gs,{fileUrl:b.url,fileType:b.type})})]}),s.jsx(N,{isOpen:y,title:`Renombrar ${j?"Archivo":"Carpeta"}`,onClose:()=>w(!1),children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),Ee(e)},children:[s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsxs("span",{className:"label-text",children:["Nombre ",j?"de archivo":"de carpeta"]})}),s.jsx("input",{type:"text",value:C,onChange:e=>g(e.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]}),j&&s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsx("span",{className:"label-text",children:"Extensión del archivo"})}),s.jsx("input",{type:"text",value:P,onChange:e=>E(e.target.value),className:"input input-bordered w-full",placeholder:"Extensión (ej: txt, pdf)"})]})]}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:q,children:"Cancelar"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),s.jsx("div",{className:"p-4",children:p.length===0?s.jsx("p",{children:"No hay archivos o carpetas disponibles."}):s.jsx("ul",{className:"grid grid-cols-4 gap-4",children:p.map(e=>s.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${n===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>ue(e.name),onDoubleClick:()=>me(e),children:[s.jsx("span",{className:"text-4xl",children:e.type==="folder"?s.jsx(Us,{}):pe(e.name)}),s.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]}),s.jsxs(N,{isOpen:re,title:te,onClose:()=>A(!1),children:[s.jsx("p",{children:oe}),s.jsx("div",{className:"flex justify-end mt-4",children:s.jsx("button",{className:"btn",onClick:()=>A(!1),children:"Aceptar"})})]})]})};export{Ks as default};
