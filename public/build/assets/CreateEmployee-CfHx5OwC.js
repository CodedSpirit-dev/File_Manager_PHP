import{W as w,r as l,b as m,j as e,Y as E}from"./app-CLN75ivf.js";function R({}){const{data:a,setData:o,post:q,processing:_,reset:x}=w({first_name:"",last_name_1:"",last_name_2:"",username:"",password:"",password_confirmation:"",position_id:"",enable_permissions:!1,selected_permissions:[]}),[j,b]=l.useState([]),[N,g]=l.useState([]),[v,p]=l.useState(!1),[f,u]=l.useState(!1),[t,c]=l.useState(1),y=2;l.useEffect(()=>{m.get("/api/positions").then(s=>{b(s.data)}).catch(s=>{console.error("Error al cargar los puestos",s)}),m.get("/api/permissions").then(s=>{g(s.data)}).catch(s=>{console.error("Error al cargar los permisos",s)})},[]);const C=s=>{const r=Number(s.target.value);s.target.checked?o("selected_permissions",[...a.selected_permissions,r]):o("selected_permissions",a.selected_permissions.filter(i=>i!==r))},n=s=>{o(s.target.name,s.target.value)},k=s=>{o(s.target.name,s.target.checked)},S=()=>{t>1&&c(t-1)},h=s=>{s.preventDefault(),t<y?c(t+1):m.post(route("admin.employees.store"),a).then(r=>{const i=r.data.id;a.enable_permissions?m.post("api/userpermissions",{employee_id:i,permissions:a.selected_permissions}).then(()=>{p(!0),x(),c(1)}).catch(d=>{console.error("Error al asignar los permisos",d),u(!0)}):(p(!0),x(),c(1))}).catch(r=>{var i,d;console.error("Error al guardar el empleado",r),(d=(i=r.response)==null?void 0:i.data)!=null&&d.errors&&u(!0)})};return e.jsxs("div",{className:"container__25",children:[e.jsx(E,{title:"Registro de nuevos empleados"}),e.jsxs("form",{className:"h-auto",onSubmit:h,children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Registro de nuevos empleados"}),e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${t>=1?"step-primary":""}`,children:"Registrar nuevo empleado"}),e.jsx("li",{className:`step ${t===2?"step-primary":""}`,children:"Elegir los permisos para el nuevo usuario"})]}),t===1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4",children:e.jsx("input",{id:"first_name",name:"first_name",value:a.first_name,className:"input__data__entry",placeholder:"Nombre(s)",onChange:n,required:!0})}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{id:"last_name_1",name:"last_name_1",value:a.last_name_1,className:"input__data__entry ",placeholder:"Primer apellido",onChange:n,required:!0})}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{id:"last_name_2",name:"last_name_2",value:a.last_name_2,className:"input__data__entry",placeholder:"Segundo apellido",onChange:n,required:!0})}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{id:"username",name:"username",value:a.username,className:"input__data__entry",placeholder:"Nombre de usuario (CURP)",maxLength:18,onChange:n,required:!0})}),e.jsx("div",{className:"mt-4",children:e.jsxs("select",{id:"position_id",name:"position_id",value:a.position_id,className:"input__data__entry",onChange:n,required:!0,children:[e.jsx("option",{className:"input__data__entry",value:"",children:"Seleccione un puesto"}),j.map(s=>e.jsx("option",{className:"input__data__entry",value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{id:"password",type:"password",name:"password",value:a.password,className:"input__data__entry",placeholder:"Contraseña",onChange:n,required:!0})}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{id:"password_confirmation",type:"password",name:"password_confirmation",value:a.password_confirmation,className:"input__data__entry",placeholder:"Confirmar contraseña",onChange:n,required:!0})}),e.jsx("div",{className:"mt-4 flex items-center justify-end",children:e.jsx("button",{className:"btn btn-block",onClick:h,disabled:_,children:"Siguiente"})})]}),t===2&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4",children:e.jsxs("label",{htmlFor:"enable_permissions",className:"input__label",children:["Habilitar permisos",e.jsx("input",{id:"enable_permissions",name:"enable_permissions",type:"checkbox",checked:a.enable_permissions,className:"ml-2 checkbox checkbox-primary",onChange:k})]})}),a.enable_permissions&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4",children:N.map(s=>e.jsx("div",{children:e.jsxs("label",{htmlFor:`permission_${s.id}`,className:"input__label ",children:[e.jsx("input",{id:`permission_${s.id}`,type:"checkbox",value:s.id,checked:a.selected_permissions.includes(s.id),onChange:C,className:"checkbox checkbox-primary mr-5"}),s.permission_description]})},s.id))}),e.jsx("div",{className:"mt-4 flex justify-between",children:e.jsx("button",{className:"btn btn-block",onClick:S,children:"Anterior"})}),e.jsx("div",{className:"mt-4 flex justify-between",children:e.jsx("button",{className:"btn btn-block ",onClick:h,disabled:_,children:"Guardar"})})]})]}),v&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"¡Empleado registrado con éxito!"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>p(!1),children:"Cerrar"})})]})}),f&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Error al registrar el empleado"}),e.jsx("p",{children:"Por favor, verifica los campos e inténtalo nuevamente."}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!1),children:"Cerrar"})})]})})]})}export{R as default};
