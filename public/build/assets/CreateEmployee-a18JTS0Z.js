import{r as n,b as m,j as e}from"./app-BGBdX5dH.js";import{u as $,C as t}from"./index.esm-D93nuGBA.js";function I(){const{control:l,handleSubmit:v,setValue:x,watch:i,getValues:h,formState:{errors:c,isValid:b},reset:N}=$({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",password:"",password_confirmation:"",company_id:"",position_id:"",enable_permissions:!1,selected_permissions:[]}}),[g,C]=n.useState([]),[w,S]=n.useState([]),[k,P]=n.useState([]),[F,A]=n.useState([]),[q,u]=n.useState(!1),[z,j]=n.useState(!1),[o,d]=n.useState(1),L=2,a=i(),f=i("password"),E=i("password_confirmation"),V=i("enable_permissions");n.useEffect(()=>{m.get("/api/positions").then(s=>C(s.data)).catch(s=>console.error("Error al cargar los puestos",s)),m.get("/api/permissions").then(s=>P(s.data)).catch(s=>console.error("Error al cargar los permisos",s)),m.get("/api/companies").then(s=>S(s.data)).catch(s=>console.error("Error al cargar las empresas",s))},[]);const y=i("company_id");n.useEffect(()=>{const s=g.filter(r=>r.company_id===Number(y));A(s),x("position_id","")},[y,g]);const Z=s=>{const r=Number(s.target.value),p=h("selected_permissions")||[];s.target.checked?x("selected_permissions",[...p,r]):x("selected_permissions",p.filter(_=>_!==r))},R=s=>{o<L?d(o+1):m.post(route("admin.employees.store"),s).then(r=>{const p=r.data.id;s.enable_permissions?m.post("/api/userpermissions",{employee_id:p,permissions:s.selected_permissions}).then(()=>{u(!0),N(),d(1)}).catch(_=>{console.error("Error al asignar permisos",_),j(!0)}):(u(!0),N(),d(1))}).catch(r=>{console.error("Error al registrar el empleado",r),j(!0)})};return e.jsxs("div",{className:"container__25",children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Registro de nuevos empleados"}),e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${o>=1?"step-primary":""}`,children:"Datos del empleado"}),e.jsx("li",{className:`step ${o===2?"step-primary":""}`,children:"Permisos"})]}),e.jsxs("form",{onSubmit:v(R),children:[o===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre(s)"}),e.jsx(t,{name:"first_name",control:l,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})}),c.first_name&&e.jsx("p",{className:"text-red-600",children:c.first_name.message})]}),a.first_name&&e.jsxs(e.Fragment,{children:[a.first_name.length<3&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe tener menos de 3 caracteres"}),a.first_name.length>50&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe exceder los 50 caracteres"}),a.first_name.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Primer apellido"}),e.jsx(t,{name:"last_name_1",control:l,rules:{required:"El primer apellido es obligatorio"},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})})]}),a.last_name_1&&e.jsxs(e.Fragment,{children:[a.last_name_1.length<3&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener menos de 3 caracteres"}),a.last_name_1.length>50&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe exceder los 50 caracteres"}),a.last_name_1.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener espacios"}),a.last_name_1.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El primer apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Segundo apellido"}),e.jsx(t,{name:"last_name_2",control:l,render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})})]}),a.last_name_2&&e.jsxs(e.Fragment,{children:[a.last_name_2.length<3&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener menos de 3 caracteres"}),a.last_name_2.length>50&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe exceder los 50 caracteres"}),a.last_name_2.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener espacios"}),a.last_name_2.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre de usuario (CURP)"}),e.jsx(t,{name:"username",control:l,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:18,message:"El nombre de usuario no debe exceder los 18 caracteres"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre de usuario (CURP)"})}),c.username&&e.jsx("p",{className:"text-red-600",children:c.username.message})]}),a.username&&e.jsxs(e.Fragment,{children:[a.username.length<3&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener menos de 3 caracteres"}),a.username.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener espacios"}),a.username.length>50&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe exceder los 50 caracteres"}),a.username.match(/[^a-zA-Z0-9]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario apellido solo puede contener letras y numeros"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Empresa"}),e.jsx(t,{name:"company_id",control:l,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),w.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})})]}),a.company_id&&e.jsx(e.Fragment,{children:a.company_id===""&&e.jsx("p",{className:"text-red-600",children:"El puesto es obligatorio"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Puesto"}),e.jsx(t,{name:"position_id",control:l,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:i("company_id")==="",children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),F.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})})]}),a.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),a.position_id&&e.jsx(e.Fragment,{children:a.position_id===""&&e.jsx("p",{className:"text-red-600",children:"El puesto es obligatorio"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Contraseña"}),e.jsx(t,{name:"password",control:l,rules:{required:"La contraseña es obligatoria"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña"})}),c.password&&e.jsx("p",{className:"text-red-600",children:c.password.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Confirmar contraseña"}),e.jsx(t,{name:"password_confirmation",control:l,rules:{required:"Debe confirmar la contraseña",validate:s=>s===h("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})})]}),f&&E&&f!==E&&e.jsx("p",{className:"text-red-600",children:"Las contraseñas no coinciden"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"button",className:"btn btn-block",onClick:()=>d(o+1),disabled:!b,children:"Siguiente"})}),!b&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]}),o===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"enable_permissions",children:"Habilitar permisos"}),e.jsx(t,{name:"enable_permissions",control:l,defaultValue:!1,render:({field:s})=>e.jsx("input",{type:"checkbox",className:"ml-2 checkbox checkbox-primary",checked:s.value,onChange:r=>s.onChange(r.target.checked),name:s.name,ref:s.ref,onBlur:s.onBlur})})]}),V&&e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"mb-3 text-xl text-center font-black block",children:"Permisos"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:k.map(s=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:h("selected_permissions").includes(s.id),onChange:Z,className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:s.permission_description})]},s.id))})]}),e.jsxs("div",{className:"mt-4 flex justify-center",children:[e.jsx("button",{type:"button",className:"btn size-2/4 mr-1",onClick:()=>d(o-1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn size-2/4 ml-1",children:"Guardar"})]})]})]}),q&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"¡Empleado registrado con éxito!"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{u(!1),d(1)},children:"Cerrar"})})]})}),z&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Error al registrar el empleado"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>j(!1),children:"Cerrar"})})]})})]})}export{I as default};
