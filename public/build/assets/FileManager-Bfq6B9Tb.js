import{q as L,r as i,j as r,b as G}from"./app-DkbLPtcs.js";import{G as j,F as q}from"./Toolbar-D_F192S9.js";import C from"./Modal-CLPDsxbS.js";import J from"./FileViewer-C4l8lhSG.js";import{getFiles as K,createFolder as Q,uploadDirectory as W,uploadFile as X,deleteFile as Y,deleteFolder as Z,updateFolder as _}from"./api-D4FUCmXS.js";function ee(p){return j({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(p)}function te(p){return j({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(p)}const se=()=>{var F;const{auth:p}=L().props,N=((F=p.user)==null?void 0:F.permissions)||[],[n,h]=i.useState(null),[c,x]=i.useState([]),[o,b]=i.useState("public"),[I,f]=i.useState(!1),[y,g]=i.useState(""),[w,v]=i.useState(!1),[u,E]=i.useState(null);i.useEffect(()=>{d()},[o]);const d=async()=>{try{const e=await K(o),t=k(e.directories,e.files);x(t)}catch(e){console.error("Error al obtener archivos:",e),alert("Error al obtener archivos.")}},D=()=>{const e=o.split("/");e.length>1&&(e.pop(),b(e.join("/")))},k=(e,t)=>{let a=1;const l=e.map(m=>({id:a++,name:m.split("/").pop()||m,type:"folder",date:new Date})),s=t.map(m=>({id:a++,name:m.split("/").pop()||m,type:"file",date:new Date}));return[...l,...s]},S=e=>N.includes(e),V=e=>{h(t=>t===e?null:e)},U=e=>{var t;if(e.type==="folder")b(`${o}/${e.name}`);else{const a=(t=e.name.split(".").pop())==null?void 0:t.toLowerCase();let l=null;if(a==="pdf")l="pdf";else if(a==="docx")l="docx";else if(a==="xlsx")l="xlsx";else{alert("Tipo de archivo no soportado para visualización.");return}const s=`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(o)}`;E({url:s,type:l}),v(!0)}},R=()=>{f(!0)},T=async()=>{if(y.trim()===""){alert("El nombre de la carpeta no puede estar vacío.");return}try{const e=await Q(y,o);alert(e.message),d(),g(""),f(!1)}catch(e){alert("Error al crear la carpeta."),console.error(e)}},$=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const t=await W(e.files,o);alert(t.message),d()}catch(t){alert("Error al subir la carpeta."),console.error(t)}},e.click()},M=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const t=await X(e.files[0],o);alert(t.message),d()}catch(t){alert("Error al subir el archivo."),console.error(t)}},e.click()},O=async()=>{var e;if(n){const t=c.find(a=>a.name===n);if(t&&t.type==="file")try{const a=await G.get("/filemanager/files/download",{params:{filename:n,path:o},responseType:"blob"}),l=window.URL.createObjectURL(new Blob([a.data])),s=document.createElement("a");s.href=l,s.setAttribute("download",n),document.body.appendChild(s),s.click(),(e=s.parentNode)==null||e.removeChild(s)}catch(a){alert("Error al descargar el archivo."),console.error(a)}else alert("Por favor, selecciona un archivo para descargar.")}},A=async()=>{if(n&&window.confirm(`¿Estás seguro de eliminar "${n}"?`))try{const t=c.find(a=>a.name===n);if(t){let a;t.type==="file"?a=await Y(n,o):t.type==="folder"&&(a=await Z(n,o)),alert(a.message),d(),h(null)}}catch(t){alert("Error al eliminar el elemento."),console.error(t)}},z=async()=>{n&&alert("Funcionalidad de copiar aún no implementada.")},H=async()=>{n&&alert("Funcionalidad de mover aún no implementada.")},P=async()=>{if(n){const e=prompt(`Ingresa el nuevo nombre para "${n}":`);if(e&&e.trim()!=="")try{const t=c.find(a=>a.name===n);if(t){let a;if(t.type==="folder")a=await _(t.name,e,o);else{alert("Renombrar archivos aún no está implementado.");return}alert(a.message),d(),h(null)}}catch(t){alert("Error al renombrar el elemento."),console.error(t)}}},B=e=>{const t=[...c].sort((a,l)=>e==="date"?new Date(a.date).getTime()-new Date(l.date).getTime():a.name.localeCompare(l.name));x(t)};return r.jsxs("div",{className:"file-manager bg-white",children:[r.jsxs("div",{className:"flex items-center p-4 bg-gray-100 shadow",children:[r.jsx("button",{className:`btn btn-secondary mr-2 ${o==="public"?"btn-disabled":""}`,onClick:D,disabled:o==="public",children:"Volver"}),r.jsxs("span",{className:"text-lg font-semibold",children:["Ruta: /",o]})]}),r.jsx(q,{onCreateFolder:R,onUploadFolder:$,onUploadFile:M,onDownloadFile:O,onDelete:A,onSort:B,isItemSelected:n!==null,hasPermission:S,onCopy:z,onMove:H,onRename:P}),r.jsxs(C,{isOpen:I,title:"Crear Nueva Carpeta",onClose:()=>f(!1),children:[r.jsx("input",{type:"text",value:y,onChange:e=>g(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),r.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[r.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancelar"}),r.jsx("button",{className:"btn btn-primary",onClick:T,children:"Crear"})]})]}),w&&u&&u.type&&r.jsx(C,{isOpen:w,title:`Visualizando: ${n}`,onClose:()=>v(!1),children:r.jsx("div",{className:"h-96 overflow-auto",children:r.jsx(J,{fileUrl:u.url,fileType:u.type})})}),r.jsx("div",{className:"p-4",children:c.length===0?r.jsx("p",{children:"No hay archivos o carpetas disponibles."}):r.jsx("ul",{className:"grid grid-cols-4 gap-4",children:c.map(e=>r.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${n===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>V(e.name),onDoubleClick:()=>U(e),children:[r.jsx("span",{className:"text-4xl",children:e.type==="folder"?r.jsx(te,{}):r.jsx(ee,{})}),r.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]})};export{se as default};
