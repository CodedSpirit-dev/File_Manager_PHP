import{q as L,r as i,j as l,b as G}from"./app-Bvmp4ha9.js";import{G as x,F as q}from"./Toolbar-DKyjcPK5.js";import v from"./Modal-B0soycAz.js";import J from"./FileViewer-P64ROHHL.js";import{getFiles as K,createFolder as Q,uploadDirectory as W,uploadFile as X,deleteFile as Y,deleteFolder as Z,updateFolder as _}from"./api-QU-puqHP.js";function ee(c){return x({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(c)}function te(c){return x({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(c)}function ne(c){return x({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m289.94 256 95-95A24 24 0 0 0 351 127l-95 95-95-95a24 24 0 0 0-34 34l95 95-95 95a24 24 0 1 0 34 34l95-95 95 95a24 24 0 0 0 34-34z"},child:[]}]})(c)}const ie=()=>{var j;const{auth:c}=L().props,N=((j=c.user)==null?void 0:j.permissions)||[],[r,h]=i.useState(null),[d,w]=i.useState([]),[o,b]=i.useState("public"),[I,f]=i.useState(!1),[y,F]=i.useState(""),[C,g]=i.useState(!1),[u,E]=i.useState(null);i.useEffect(()=>{m()},[o]);const m=async()=>{try{const e=await K(o);w(D(e.directories,e.files))}catch(e){console.error("Error fetching files:",e),alert("Error fetching files.")}},k=()=>{const e=o.split("/");e.length>1&&(e.pop(),b(e.join("/")))},D=(e,t)=>{let n=1;const s=e.map(p=>({id:n++,name:p.split("/").pop()||p,type:"folder",date:new Date})),a=t.map(p=>({id:n++,name:p.split("/").pop()||p,type:"file",date:new Date}));return[...s,...a]},S=e=>N.includes(e),V=e=>{h(t=>t===e?null:e)},U=e=>{var t;if(e.type==="folder")b(`${o}/${e.name}`);else{const n=(t=e.name.split(".").pop())==null?void 0:t.toLowerCase();let s;if(n==="pdf"||n==="docx"||n==="xlsx")s=n;else{alert("File type not supported for viewing.");return}const a=`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(o)}`;E({url:a,type:s}),g(!0)}},$=()=>{f(!0)},A=async()=>{if(y.trim()===""){alert("Folder name cannot be empty.");return}try{const e=await Q(y,o);alert(e.message),m(),F(""),f(!1)}catch(e){alert("Error creating folder."),console.error(e)}},M=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const t=await W(e.files,o);alert(t.message),m()}catch(t){alert("Error uploading folder."),console.error(t)}},e.click()},R=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const t=await X(e.files[0],o);alert(t.message),m()}catch(t){alert("Error uploading file."),console.error(t)}},e.click()},T=async()=>{var e;if(r){const t=d.find(n=>n.name===r);if(t&&t.type==="file")try{const n=await G.get("/filemanager/files/download",{params:{filename:r,path:o},responseType:"blob"}),s=window.URL.createObjectURL(new Blob([n.data])),a=document.createElement("a");a.href=s,a.setAttribute("download",r),document.body.appendChild(a),a.click(),(e=a.parentNode)==null||e.removeChild(a)}catch(n){alert("Error downloading file."),console.error(n)}else alert("Please select a file to download.")}},z=async()=>{if(r&&window.confirm(`Are you sure you want to delete "${r}"?`))try{const t=d.find(n=>n.name===r);if(t){let n;t.type==="file"?n=await Y(r,o):t.type==="folder"&&(n=await Z(r,o)),alert(n.message),m(),h(null)}}catch(t){alert("Error deleting item."),console.error(t)}},O=async()=>{r&&alert("Copy functionality not implemented yet.")},B=async()=>{r&&alert("Move functionality not implemented yet.")},P=async()=>{if(r){const e=prompt(`Enter the new name for "${r}":`);if(e&&e.trim()!=="")try{const t=d.find(n=>n.name===r);if(t){let n;if(t.type==="folder")n=await _(t.name,e,o);else{alert("Renaming files is not implemented yet.");return}alert(n.message),m(),h(null)}}catch(t){alert("Error renaming item."),console.error(t)}}},H=e=>{const t=[...d].sort((n,s)=>e==="date"?new Date(n.date).getTime()-new Date(s.date).getTime():n.name.localeCompare(s.name));w(t)};return l.jsxs("div",{className:"file-manager bg-white",children:[l.jsxs("div",{className:"flex items-center p-4 bg-gray-100 shadow",children:[l.jsx("button",{className:`btn btn-secondary mr-2 ${o==="public"?"btn-disabled":""}`,onClick:k,disabled:o==="public",children:"Back"}),l.jsxs("span",{className:"text-lg font-semibold",children:["Path: /",o]})]}),l.jsx(q,{onCreateFolder:$,onUploadFolder:M,onUploadFile:R,onDownloadFile:T,onDelete:z,onSort:H,isItemSelected:r!==null,hasPermission:S,onCopy:O,onMove:B,onRename:P}),l.jsxs(v,{isOpen:I,title:"Create New Folder",onClose:()=>f(!1),children:[l.jsx("input",{type:"text",value:y,onChange:e=>F(e.target.value),placeholder:"Folder name",className:"input input-bordered w-full"}),l.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[l.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancel"}),l.jsx("button",{className:"btn btn-primary",onClick:A,children:"Create"})]})]}),C&&u&&u.type&&l.jsxs(v,{isOpen:C,title:`Visualizando: ${r}`,onClose:()=>g(!1),children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h2",{className:"text-lg font-semibold",children:`Visualizando: ${r}`}),l.jsx("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-gray-700",children:l.jsx(ne,{size:24})})]}),l.jsx("div",{className:"h-96 overflow-auto",children:l.jsx(J,{fileUrl:u.url,fileType:u.type})})]}),l.jsx("div",{className:"p-4",children:d.length===0?l.jsx("p",{children:"No files or folders available."}):l.jsx("ul",{className:"grid grid-cols-4 gap-4",children:d.map(e=>l.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${r===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>V(e.name),onDoubleClick:()=>U(e),children:[l.jsx("span",{className:"text-4xl",children:e.type==="folder"?l.jsx(te,{}):l.jsx(ee,{})}),l.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]})};export{ie as default};
