import{r as t,b as n,j as e,Y as q}from"./app-EiJ4knnL.js";import z from"./EditEmployee-xKa6Wjvq.js";import B from"./CreateEmployee-Q5RQdVD6.js";import"./index.esm-BzUwNG8z.js";const Q=()=>{const[v,M]=t.useState([]),[x,A]=t.useState([]),[y,F]=t.useState([]),[L,p]=t.useState(!0),[f,O]=t.useState(null),[N,P]=t.useState(null),[E,u]=t.useState(!1),[h,b]=t.useState(!1),[S,_]=t.useState(null);t.useRef(null);const c=t.useRef(null),[o,D]=t.useState(null),[d,C]=t.useState(!1),[k,j]=t.useState(null),[g,$]=t.useState(null),w=s=>{j(s.id);const a=x.find(r=>r.id===s.position_id),l=a?a.company_id:null,i={...s,company_id:l};Promise.all([n.get("/api/permissions"),n.get(`/api/employees/${s.id}/permissions`)]).then(([r,T])=>{const W=r.data,Y=T.data;P(i),$({permissions:W,employeePermissions:Y}),u(!0),j(null)}).catch(r=>{console.error("Error al cargar los datos para editar el usuario",r),j(null)})};t.useEffect(()=>{m()},[]);const m=()=>{p(!0),Promise.all([n.get("admin/employees"),n.get("api/positions"),n.get("admin/companies")]).then(([s,a,l])=>{M(s.data),A(a.data),F(l.data),p(!1)}).catch(s=>{console.error("Error al cargar los datos",s),O("Error al cargar los datos"),p(!1)})},I=s=>{var a;D(s),(a=c.current)==null||a.showModal()},R=()=>{o&&(C(!0),n.delete(`admin/employees/${o.id}`).then(()=>{var s;_("¡Usuario eliminado con éxito!"),m(),(s=c.current)==null||s.close()}).catch(s=>{console.error("Error al eliminar el usuario",s)}).finally(()=>{C(!1),D(null)}))},U=()=>{_(null)};return L?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):f?e.jsx("div",{className:"text-center text-error",children:f}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx(q,{title:"Usuarios"}),e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-primary",children:"LISTA DE USUARIOS"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>b(!0),className:"btn btn-success",children:"Agregar usuario"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Fecha de Registro"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Último Inicio de Sesión"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Puesto"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:v.map(s=>{const a=x.find(i=>i.id===s.position_id),l=a?y.find(i=>i.id===a.company_id):null;return e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:[s.first_name," ",s.last_name_1]}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:new Date(s.registered_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"No registrado"}),e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content",children:[a==null?void 0:a.name,e.jsx("br",{}),l&&e.jsx("span",{className:"mt-1 inline-block bg-secondary text-secondary-content text-xs px-2 py-1 rounded",children:l.name})]}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>w(s),className:"btn btn-primary btn-sm",disabled:k===s.id,children:k===s.id?e.jsx("span",{className:"loading loading-spinner"}):"Editar"}),e.jsx("button",{onClick:()=>I(s),className:"btn btn-error btn-sm text-base-100",children:"Eliminar"})]})})]},s.id)})})]}),N&&g&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"edit-employee-modal",className:"modal-toggle",checked:E,readOnly:!0}),e.jsx("label",{htmlFor:"edit-employee-modal",className:`modal cursor-pointer ${E?"modal-open":""}`,children:e.jsx("label",{className:"modal-box relative",htmlFor:"",children:e.jsx(z,{employee:N,positions:x,companies:y,permissions:g.permissions,employeePermissions:g.employeePermissions,onClose:()=>u(!1),onSuccess:()=>{u(!1),m()}})})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"add-employee-modal",className:"modal-toggle",checked:h,readOnly:!0}),e.jsx("label",{htmlFor:"add-employee-modal",className:`modal cursor-pointer ${h?"modal-open":""}`,children:e.jsx("label",{className:"modal-box relative",htmlFor:"",children:e.jsx(B,{onSuccess:()=>{m(),b(!1)},onClose:()=>b(!1)})})})]}),e.jsx("dialog",{ref:c,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsx("h4",{className:"font-bold text-center",children:o?`¿Estás seguro de eliminar a ${o.first_name} ${o.last_name_1} de la base de datos?`:"¿Estás seguro de eliminar este usuario de la base de datos?"}),e.jsx("p",{className:"text-justify mt-4",children:"Esta operación no se puede deshacer."}),e.jsxs("div",{className:"modal-action justify-center mt-6",children:[e.jsx("button",{type:"button",className:"btn btn-warning",onClick:()=>{var s;return(s=c.current)==null?void 0:s.close()},disabled:d,children:"No, cancelar"}),e.jsx("button",{type:"button",onClick:R,className:`btn btn-error ${d?"loading":""}`,disabled:d,children:d?"Eliminando...":"Sí, eliminar"})]})]})}),S&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center text-lg",children:"Acción Exitosa"}),e.jsx("p",{className:"text-center py-4 text-green-500",children:S}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:U,children:"Aceptar"})})]})})]})]})};export{Q as default};
