import{q as Re,r as o,j as s,b as Te}from"./app-jbPvg9aA.js";import{F as Oe,B as Ae,a as De,b as Le,c as Pe,d as He,e as Ue,f as Ve,g as $e,h as ze,i as qe,j as Ge,k as Je,l as Xe,m as Ke,n as We,o as Ye,p as _e,q as Qe,r as Ze,s as es,t as ss,v as rs,w as ts,x as as,y as os,z as ns,A as ls,C as cs,D as is,E as ps,G as ds,H as us,I as ms,J as fs,K as xs,L as hs,M as ys,N as js,O as vs,Q as Fs,R as bs,S as ws,T as gs,U as Cs,V as Es,W as Bs,X as Ns,Y as Ss,Z as Ms}from"./Toolbar-DnPkWloT.js";import $ from"./Modal-B-ouTBfQ.js";import ks from"./FileViewerModal-Cg3XHTjl.js";import{G as se}from"./index-CpXqm4Rw.js";import{getFilesTree as Is,createFolder as Rs,uploadDirectory as Ts,uploadFile as Os,downloadFile as As,downloadFolder as Ds,deleteFile as Ls,deleteFolder as Ps,copyFile as Hs,moveFile as Us,renameFile as Vs}from"./fileManagerApi-BpXfqTnh.js";import $s from"./Breadcrumb-wrI73Uwh.js";import"./FileViewer-jQ5n4sIV.js";function zs(m){return se({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(m)}function qs(m){return se({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(m)}const er=()=>{var Y;const{auth:m}=Re().props;(Y=m.user)!=null&&Y.permissions;const[n,f]=o.useState(null),[p,M]=o.useState([]),[c,x]=o.useState(""),[k,re]=o.useState(null),[b,te]=o.useState([]),[I,ae]=o.useState(1),[oe,w]=o.useState(!1),[R,z]=o.useState(""),[q,G]=o.useState(!1),[g,ne]=o.useState(null),[h,T]=o.useState(!1),[O,A]=o.useState(null),[y,D]=o.useState(!1),[L,P]=o.useState(null),[le,H]=o.useState(!1),[ce,ie]=o.useState(""),[pe,de]=o.useState(""),[Gs,ue]=o.useState("success"),[j,C]=o.useState(!1),[E,B]=o.useState(""),[U,N]=o.useState(""),[v,V]=o.useState(!0);o.useEffect(()=>{(async()=>{try{await me(),await d(),J(b,c),f(null)}catch(r){console.error("Error al inicializar datos:",r)}})()},[]),o.useEffect(()=>{b.length>0&&J(b,c)},[b,c]);const me=async()=>{try{const e=await Te.get("/filemanager/hierarchy-company",{withCredentials:!0}),{hierarchy_level:r,company_name:t}=e.data;ae(r),re(t);const l=`public/${t}`;x(l)}catch(e){console.error("Error al obtener jerarquía y empresa:",e)}},d=async()=>{try{const r={name:"public",path:"public",type:"folder",children:await Is()};te([r])}catch(e){console.error("Error fetching files tree:",e),a("Error","Error al obtener el árbol de archivos.","error")}},J=(e,r)=>{var _,Q;const t=r.split("/").filter(Boolean);let l={children:e};for(const F of t){const Z=(_=l.children)==null?void 0:_.find(ee=>ee.name===F&&ee.type==="folder");if(Z)l=Z;else{console.error("Ruta no encontrada en el árbol:",r),M([]);return}}let u=1;const i=((Q=l.children)==null?void 0:Q.map(F=>({id:u++,name:F.name,type:F.type,date:new Date,path:F.path})))||[];M(i)},fe=e=>{var t;switch((t=e.split(".").pop())==null?void 0:t.toLowerCase()){case"aac":return s.jsx(Ms,{});case"ai":return s.jsx(Ss,{});case"bmp":return s.jsx(Ns,{});case"cs":return s.jsx(Bs,{});case"css":return s.jsx(Es,{});case"csv":return s.jsx(Cs,{});case"doc":return s.jsx(gs,{});case"docx":return s.jsx(ws,{});case"exe":return s.jsx(bs,{});case"gif":return s.jsx(Fs,{});case"heic":return s.jsx(vs,{});case"html":return s.jsx(js,{});case"java":return s.jsx(ys,{});case"jpg":case"jpeg":return s.jsx(hs,{});case"js":return s.jsx(xs,{});case"json":return s.jsx(fs,{});case"jsx":return s.jsx(ms,{});case"key":return s.jsx(us,{});case"m4p":return s.jsx(ds,{});case"md":return s.jsx(ps,{});case"mdx":return s.jsx(is,{});case"mov":return s.jsx(cs,{});case"mp3":return s.jsx(ls,{});case"mp4":return s.jsx(ns,{});case"otf":return s.jsx(os,{});case"pdf":return s.jsx(as,{});case"php":return s.jsx(ts,{});case"png":return s.jsx(rs,{});case"ppt":return s.jsx(ss,{});case"pptx":return s.jsx(es,{});case"psd":return s.jsx(Ze,{});case"py":return s.jsx(Qe,{});case"raw":return s.jsx(_e,{});case"rb":return s.jsx(Ye,{});case"sass":return s.jsx(We,{});case"scss":return s.jsx(Ke,{});case"sh":return s.jsx(Xe,{});case"sql":return s.jsx(Je,{});case"svg":return s.jsx(Ge,{});case"tiff":return s.jsx(qe,{});case"tsx":return s.jsx(ze,{});case"ttf":return s.jsx($e,{});case"txt":return s.jsx(Ve,{});case"wav":return s.jsx(Ue,{});case"woff":return s.jsx(He,{});case"xls":return s.jsx(Pe,{});case"xlsx":return s.jsx(Le,{});case"xml":return s.jsx(De,{});case"yml":return s.jsx(Ae,{});default:return s.jsx(zs,{})}},xe=e=>{f(r=>r===e?null:e)},he=e=>{var r;if(e.type==="folder")x(e.path);else{const t=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();t==="pdf"||t==="docx"||t==="xlsx"?(ne({url:`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(c)}`,type:t}),G(!0)):a("Error","Tipo de archivo no soportado para visualización.","error")}},a=(e,r,t)=>{ie(e),de(r),ue(t),H(!0)},ye=()=>{w(!0)},je=async()=>{if(R.trim()===""){a("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const e=await Rs(R,c);a("Éxito","Carpeta creada exitosamente.","success"),d(),z(""),w(!1)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para crear carpetas.","error"):a("Error","Error al crear la carpeta.","error"),console.error(e)}},ve=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const r=await Ts(e.files,c);a("Éxito","Carpeta subida exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para subir carpetas.","error"):a("Error","Error al subir la carpeta.","error"),console.error(r)}},e.click()},Fe=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const r=await Os(e.files[0],c);a("Éxito","Archivo subido exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para subir archivos.","error"):a("Error","Error al subir el archivo.","error"),console.error(r)}},e.click()},be=async()=>{var e,r;if(n){const t=p.find(l=>l.name===n);if(t){if(t.type==="file")try{const l=await As(t.name,c),u=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=u,i.setAttribute("download",t.name),document.body.appendChild(i),i.click(),(e=i.parentNode)==null||e.removeChild(i),a("Éxito","Archivo descargado exitosamente.","success")}catch(l){l.response&&l.response.status===403?a("Error","No tienes permiso para descargar archivos.","error"):a("Error","Error al descargar el archivo.","error"),console.error(l)}else if(t.type==="folder")try{const l=await Ds(t.name,c),u=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=u,i.setAttribute("download",`${t.name}.zip`),document.body.appendChild(i),i.click(),(r=i.parentNode)==null||r.removeChild(i),a("Éxito","Carpeta descargada exitosamente.","success")}catch(l){l.response&&l.response.status===403?a("Error","No tienes permiso para descargar carpetas.","error"):a("Error","Error al descargar la carpeta.","error"),console.error(l)}}}else a("Error","Por favor, selecciona un elemento para descargar.","error")},we=async()=>{if(n&&window.confirm(`¿Estás seguro de que deseas eliminar "${n}"?`))try{const r=p.find(t=>t.name===n);if(r){let t;r.type==="file"?t=await Ls(r.name,c):r.type==="folder"&&(t=await Ps(r.name,c)),a("Éxito",t.message||"Elemento eliminado exitosamente.","success"),d(),f(null)}}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para eliminar este elemento.","error"):a("Error","Error al eliminar el elemento.","error"),console.error(r)}},ge=async()=>{if(n){const e=p.find(r=>r.name===n);e&&e.type==="file"?(A({filename:e.name,path:c}),T(!0)):a("Error","Solo se pueden copiar archivos.","error")}},Ce=async()=>{if(O)try{const e=await Hs(O.filename,O.path,c);a("Éxito","Archivo copiado exitosamente.","success"),d(),T(!1),A(null)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para copiar archivos.","error"):a("Error","Error al copiar el archivo.","error"),console.error(e)}},X=()=>{T(!1),A(null)},Ee=async()=>{if(n){const e=p.find(r=>r.name===n);e&&e.type==="file"?(P({filename:e.name,path:c}),D(!0)):a("Error","Solo se pueden mover archivos.","error")}},Be=async()=>{if(L)try{const e=await Us(L.filename,L.path,c);a("Éxito","Archivo movido exitosamente.","success"),d(),D(!1),P(null),f(null)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para mover archivos.","error"):a("Error","Error al mover el archivo.","error"),console.error(e)}},K=()=>{D(!1),P(null)},Ne=()=>{if(n){const e=p.find(r=>r.name===n);if(e){const[r,t]=e.type==="file"?[n.slice(0,n.lastIndexOf("."))||n,n.slice(n.lastIndexOf(".")+1)]:[n,""];B(r),N(t),V(e.type==="file"),C(!0)}}},Se=async e=>{if(e.preventDefault(),E.trim()===""){a("Error","El nombre del elemento no puede estar vacío.","error");return}if(v&&U.trim()===""){a("Error","La extensión del archivo no puede estar vacía.","error");return}const r=v?`${E}.${U}`:E;try{if(n!=null){const t=await Vs(n,r,c)}a("Éxito","Elemento renombrado exitosamente.","success"),d(),f(null),C(!1),B(""),N(""),V(!0)}catch(t){t.response&&t.response.status===403?a("Error","No tienes permiso para renombrar este elemento.","error"):a("Error","Error al renombrar el elemento.","error"),console.error(t)}},W=()=>{C(!1),B(""),N(""),V(!0)},Me=({criteria:e,order:r})=>{const t=[...p].sort((l,u)=>{let i=0;return e==="name"&&(i=l.name.localeCompare(u.name)),r==="asc"?i:-i});M(t)},S=o.useCallback(e=>{e.key==="Escape"&&(h&&X(),y&&K(),j&&W())},[h,y,j]);o.useEffect(()=>(h||y||j?window.addEventListener("keydown",S):window.removeEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}),[h,y,j,S]);const ke=()=>{const e=c.split("/").filter(Boolean);if(e.length>1){e.pop();const r=e.join("/");x(r)}else x("public")},Ie=c!==`public/${k}`||I<=1;return s.jsxs(s.Fragment,{children:[I!==null&&k&&s.jsx($s,{currentPath:c,onNavigateTo:x,hierarchyLevel:I,companyName:k}),s.jsxs("div",{className:"file-manager bg-white min-h-fit",children:[s.jsx(Oe,{onCreateFolder:ye,onUploadFolder:ve,onUploadFile:Fe,onDownloadFile:be,onDelete:we,onCopy:ge,onRename:Ne,onMove:Ee,onSort:Me,isItemSelected:n!==null,onCopyHere:Ce,onCancelCopy:X,isCopying:h,onMoveHere:Be,onCancelMove:K,isMoving:y,onBack:ke,canGoBack:Ie}),s.jsxs($,{isOpen:oe,title:"Crear Nueva Carpeta",onClose:()=>w(!1),children:[s.jsx("input",{type:"text",value:R,onChange:e=>z(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>w(!1),children:"Cancelar"}),s.jsx("button",{className:"btn btn-primary",onClick:je,children:"Crear"})]})]}),q&&g&&g.type&&s.jsx(ks,{isOpen:q,fileUrl:g.url,fileType:g.type,onClose:()=>G(!1)}),s.jsx($,{isOpen:j,title:`Renombrar ${v?"Archivo":"Carpeta"}`,onClose:()=>C(!1),children:s.jsxs("form",{onSubmit:Se,children:[s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsxs("span",{className:"label-text",children:["Nombre ",v?"de archivo":"de carpeta"]})}),s.jsx("input",{type:"text",value:E,onChange:e=>B(e.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]}),v&&s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsx("span",{className:"label-text",children:"Extensión del archivo"})}),s.jsx("input",{type:"text",value:U,onChange:e=>N(e.target.value),className:"input input-bordered w-full",placeholder:"Extensión (ej: txt, pdf)"})]})]}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:W,children:"Cancelar"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),s.jsx("div",{className:"p-4",children:p.length===0?s.jsx("p",{className:"text-center text-gray-500",children:"No hay archivos o carpetas disponibles."}):s.jsx("ul",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4",children:p.map(e=>s.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${n===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>xe(e.name),onDoubleClick:()=>he(e),children:[s.jsx("span",{className:"text-4xl",children:e.type==="folder"?s.jsx(qs,{}):fe(e.name)}),s.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]}),s.jsxs($,{isOpen:le,title:ce,onClose:()=>H(!1),children:[s.jsx("p",{children:pe}),s.jsx("div",{className:"flex justify-end mt-4",children:s.jsx("button",{className:"btn",onClick:()=>H(!1),children:"Aceptar"})})]})]})};export{er as default};
