import{r as d,b as u,j as e}from"./app-C0iC1Yht.js";import{u as M,C as i}from"./index.esm-C6sG1gHs.js";const G=({employee:n,positions:h,companies:k,onClose:v})=>{const{control:t,handleSubmit:P,setValue:_,watch:m,getValues:j,formState:{errors:l,isValid:y},reset:b}=M({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",position_id:"",company_id:"",password:"",password_confirmation:"",enable_permissions:!1,selected_permissions:[]}}),[z,A]=d.useState([]),[F,w]=d.useState([]),[L,N]=d.useState(!1),[Z,g]=d.useState(!1),[o,p]=d.useState(1),$=2,a=m(),C=m("password"),S=m("password_confirmation"),q=m("enable_permissions"),f=m("company_id");d.useEffect(()=>{u.get("/api/permissions").then(s=>A(s.data)).catch(s=>console.error("Error al cargar los permisos",s)),u.get(`/api/employees/${n.id}/permissions`).then(s=>{const r=s.data.map(x=>x.id),c={first_name:n.first_name,last_name_1:n.last_name_1,last_name_2:n.last_name_2||"",username:n.username,position_id:n.position_id.toString(),company_id:n.company_id?n.company_id.toString():"",password:"",password_confirmation:"",enable_permissions:r.length>0,selected_permissions:r};b(c);const E=h.filter(x=>x.company_id===Number(c.company_id));w(E)}).catch(s=>console.error("Error al cargar los permisos del empleado",s))},[]),d.useEffect(()=>{const s=h.filter(r=>r.company_id===Number(f));w(s),_("position_id","")},[f,h]);const V=s=>{const r=j("selected_permissions");r.includes(s)?_("selected_permissions",r.filter(c=>c!==s)):_("selected_permissions",[...r,s])},R=s=>{if(o<$)p(o+1);else{const r={...s,position_id:s.position_id,company_id:s.company_id};u.patch(`/admin/employees/${n.id}`,r).then(c=>{const E=n.id;s.enable_permissions?u.post("/api/userpermissions",{employee_id:E,permissions:s.selected_permissions}).then(()=>{N(!0),b(),p(1)}).catch(x=>{console.error("Error al asignar permisos",x),g(!0)}):(N(!0),b(),p(1))}).catch(c=>{console.error("Error al actualizar el empleado",c),g(!0)})}};return e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box w-11/12 max-w-5xl",children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Editar Empleado"}),e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${o>=1?"step-primary":""}`,children:"Datos del empleado"}),e.jsx("li",{className:`step ${o===2?"step-primary":""}`,children:"Permisos"})]}),e.jsxs("form",{onSubmit:P(R),children:[o===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre(s)"}),e.jsx(i,{name:"first_name",control:t,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})})]}),l.first_name&&e.jsx("p",{className:"text-red-600",children:l.first_name.message}),a.first_name&&e.jsxs(e.Fragment,{children:[a.first_name.length<3&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe tener menos de 3 caracteres"}),a.first_name.length>50&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe exceder los 50 caracteres"}),a.first_name.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Primer apellido"}),e.jsx(i,{name:"last_name_1",control:t,rules:{required:"El primer apellido es obligatorio",maxLength:{value:50,message:"El primer apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ]+$/,message:"El primer apellido solo puede contener letras sin espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})})]}),l.last_name_1&&e.jsx("p",{className:"text-red-600",children:l.last_name_1.message}),a.last_name_1&&e.jsxs(e.Fragment,{children:[a.last_name_1.length<3&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener menos de 3 caracteres"}),a.last_name_1.length>50&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe exceder los 50 caracteres"}),a.last_name_1.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener espacios"}),a.last_name_1.match(/[^a-zA-ZÀ-ÿ]/)&&e.jsx("p",{className:"text-red-600",children:"El primer apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Segundo apellido"}),e.jsx(i,{name:"last_name_2",control:t,rules:{maxLength:{value:50,message:"El segundo apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ]*$/,message:"El segundo apellido solo puede contener letras sin espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})})]}),l.last_name_2&&e.jsx("p",{className:"text-red-600",children:l.last_name_2.message}),a.last_name_2&&e.jsxs(e.Fragment,{children:[a.last_name_2.length<3&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener menos de 3 caracteres"}),a.last_name_2.length>50&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe exceder los 50 caracteres"}),a.last_name_2.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener espacios"}),a.last_name_2.match(/[^a-zA-ZÀ-ÿ]/)&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Nombre de usuario (CURP)"}),e.jsx(i,{name:"username",control:t,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:18,message:"El nombre de usuario no debe exceder los 18 caracteres"},pattern:{value:/^[a-zA-Z0-9]+$/,message:"El nombre de usuario solo puede contener letras y números sin espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre de usuario (CURP)"})})]}),l.username&&e.jsx("p",{className:"text-red-600",children:l.username.message}),a.username&&e.jsxs(e.Fragment,{children:[a.username.length<3&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe tener menos de 3 caracteres"}),a.username.length>18&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe exceder los 18 caracteres"}),a.username.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe tener espacios"}),a.username.match(/[^a-zA-Z0-9]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario solo puede contener letras y números"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Empresa"}),e.jsx(i,{name:"company_id",control:t,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),k.map(r=>e.jsx("option",{value:r.id.toString(),children:r.name},r.id))]})})]}),l.company_id&&e.jsx("p",{className:"text-red-600",children:l.company_id.message}),a.company_id===""&&e.jsx("p",{className:"text-red-600",children:"La empresa es obligatoria"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Puesto"}),e.jsx(i,{name:"position_id",control:t,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:!f,children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),F.map(r=>e.jsx("option",{value:r.id.toString(),children:r.name},r.id))]})})]}),l.position_id&&e.jsx("p",{className:"text-red-600",children:l.position_id.message}),a.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),a.position_id===""&&e.jsx("p",{className:"text-red-600",children:"El puesto es obligatorio"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Contraseña (opcional)"}),e.jsx(i,{name:"password",control:t,rules:{minLength:{value:4,message:"La contraseña debe tener al menos 4 caracteres"}},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña (dejar vacío si no desea cambiar)"})})]}),l.password&&e.jsx("p",{className:"text-red-600",children:l.password.message}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{children:"Confirmar contraseña"}),e.jsx(i,{name:"password_confirmation",control:t,rules:{validate:s=>s===j("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})})]}),l.password_confirmation&&e.jsx("p",{className:"text-red-600",children:l.password_confirmation.message}),C&&S&&C!==S&&e.jsx("p",{className:"text-red-600",children:"Las contraseñas no coinciden"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"button",className:"btn btn-block",onClick:()=>p(o+1),disabled:!y,children:"Siguiente"})}),!y&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]}),o===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"enable_permissions",children:"Habilitar permisos"}),e.jsx(i,{name:"enable_permissions",control:t,render:({field:s})=>e.jsx("input",{type:"checkbox",className:"ml-2 checkbox checkbox-primary",checked:s.value,onChange:r=>s.onChange(r.target.checked)})})]}),q&&e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"mb-3 text-xl text-center font-black block",children:"Permisos"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:z.map(s=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:j("selected_permissions").includes(s.id),onChange:()=>V(s.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:s.description})]},s.id))})]}),e.jsxs("div",{className:"mt-4 flex justify-center",children:[e.jsx("button",{type:"button",className:"btn size-2/4 mr-1",onClick:()=>p(o-1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn size-2/4 ml-1",children:"Guardar"})]})]})]}),L&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"¡Empleado actualizado con éxito!"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{N(!1),v()},children:"Cerrar"})})]})}),Z&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Error al actualizar el empleado"}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>g(!1),children:"Cerrar"})})]})}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-error",onClick:v,children:"Cancelar"})})]})})};export{G as default};
