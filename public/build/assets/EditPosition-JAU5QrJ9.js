import{r as l,a as i,j as e}from"./app-B7dVHGJe.js";import{u as A,C as F}from"./index.esm-DU-grLVq.js";const z=({position:n,onClose:d})=>{const{control:N,handleSubmit:g,formState:{errors:m,isValid:y}}=A({mode:"onChange",defaultValues:{name:n.name}}),[r,p]=l.useState(1),[u,x]=l.useState(""),[h,c]=l.useState(""),[_,b]=l.useState(!1),[v,S]=l.useState([]),[o,C]=l.useState(n.permissions?n.permissions.map(s=>s.id):[]);l.useEffect(()=>{i.get("/api/permissions").then(s=>S(s.data)).catch(()=>c("Error al cargar los permisos disponibles."))},[]);const j={Empresas:["can_create_companies","can_delete_companies","can_update_companies"],Puestos:["can_create_positions","can_update_positions","can_delete_positions"],Usuarios:["can_create_users","can_delete_users","can_update_users","can_view_company_users","can_view_all_users"],"Gestión de Archivos y Carpetas":["can_view_file_explorer","can_open_files","can_upload_files_and_folders","can_create_folders","can_download_files_and_folders","can_copy_files","can_move_files","can_rename_files_and_folders","can_delete_files_and_folders"]},E=Object.keys(j).map(s=>({category:s,permissions:v.filter(a=>j[s].includes(a.name))})),P=s=>{C(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},w=async s=>{var a,t;b(!0);try{await i.patch(`/api/positions/${n.id}`,{name:s.name}),o.length>0?await i.post("/api/positionpermissions",{position_id:n.id,permissions:o}):await i.delete(`/api/positionpermissions/${n.id}`),x("Puesto y permisos actualizados exitosamente.")}catch(f){i.isAxiosError(f)?c(((t=(a=f.response)==null?void 0:a.data)==null?void 0:t.message)||"Hubo un error al actualizar el puesto y los permisos."):c("Hubo un error al actualizar el puesto y los permisos.")}finally{b(!1)}},k=()=>{x(""),d(!0)};return e.jsxs("div",{className:"modal-box",children:[e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${r>=1?"step-primary":""}`,children:"Editar Puesto"}),e.jsx("li",{className:`step ${r===2?"step-primary":""}`,children:"Asignar Permisos"})]}),e.jsxs("form",{onSubmit:g(w),children:[r===1&&e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Editar Puesto"}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{htmlFor:"name",children:[e.jsx(F,{name:"name",control:N,rules:{required:"El nombre del puesto es obligatorio",minLength:{value:3,message:"El nombre debe tener al menos 3 caracteres"}},render:({field:s})=>e.jsx("input",{...s,placeholder:"Nombre del puesto",id:"name",className:"input__data__entry w-full"})}),m.name&&e.jsx("p",{className:"text-red-600",children:m.name.message})]})}),e.jsxs("div",{className:"mt-6 flex items-center",children:[e.jsx("button",{type:"button",className:"btn-warning-mod mx-2",onClick:()=>d(!1),children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn-accept mx-2",onClick:()=>p(2),disabled:!y,children:"Siguiente"})]})]}),r===2&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-3 text-xl text-center font-bold",children:"Asignar Permisos al Puesto"}),e.jsx("div",{className:"overflow-y-auto max-h-80",children:E.map(({category:s,permissions:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(t=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:o.includes(t.id),onChange:()=>P(t.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:t.description})]},t.id))})]},s))}),e.jsxs("div",{className:"mt-6 flex",children:[e.jsx("button",{type:"button",className:"btn-warning-mod mx-2",onClick:()=>p(1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn-accept mx-2",disabled:_,children:_?e.jsx("span",{className:"loading loading-spinner"}):"Guardar"})]})]})]}),u&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Acción Exitosa"}),e.jsx("p",{className:"py-4",children:u}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn-accept",onClick:k,children:"Aceptar"})})]})}),h&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-error",children:"Error"}),e.jsx("p",{className:"py-4",children:h}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn-accept",onClick:()=>c(""),children:"Cerrar"})})]})})]})};export{z as default};
