import{r as t,b as N,j as e,Y as I}from"./app-CYh5bE9e.js";import T from"./EditCompany-D8_yww0_.js";import Y from"./CreateCompany-y7qQoBKw.js";import{deleteCompany as q}from"./companyApi-c6awq_rb.js";import"./index.esm-CcO2mCQL.js";const Q=()=>{const[g,C]=t.useState([]),[y,d]=t.useState(!0),[x,E]=t.useState(null),[p,S]=t.useState(null),[v,h]=t.useState(!1),[D,m]=t.useState(!1),[z,b]=t.useState(null),[B,k]=t.useState(null),o=t.useRef(null),[l,j]=t.useState(null),[w,L]=t.useState(0),[M,A]=t.useState(0),[u,f]=t.useState(null),[a,i]=t.useState(null);t.useEffect(()=>{c()},[]);const c=async()=>{d(!0);try{const s=await N.get("admin/companies");C(s.data),d(!1)}catch{E("Error al cargar los datos"),d(!1)}},O=s=>{f(s.id),S(s),h(!0),f(null)},R=async s=>{var r;i(s.id);try{const n=await N.get(`admin/companies/${s.id}/counts`);L(n.data.positions_count),A(n.data.employees_count),j(s),(r=o.current)==null||r.showModal()}catch{b("Error al obtener datos de la empresa.")}finally{i(null)}},$=async()=>{var s,r,n;if(l){i(l.id);try{await q(l.id),k("Compañía eliminada exitosamente."),c()}catch(P){b(((r=(s=P.response)==null?void 0:s.data)==null?void 0:r.message)||"Error al eliminar la empresa.")}finally{(n=o.current)==null||n.close(),j(null),i(null)}}},_=()=>{c(),m(!1)};return y?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):x?e.jsx("div",{className:"text-center text-error",children:x}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx(I,{title:"Empresas"}),e.jsx("h2",{className:"text-center",children:"LISTA DE EMPRESAS"}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx("button",{onClick:()=>m(!0),className:"btn btn-success",children:"Agregar nueva empresa"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nombre de la Empresa"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Cantidad de Empleados"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:g.map(s=>e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:s.name}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:s.employees_count??0}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>O(s),className:`btn btn-primary btn-sm ${u===s.id?"loading":""}`,disabled:u===s.id,children:u===s.id?"":"Editar"}),e.jsx("button",{onClick:()=>R(s),className:`btn btn-error btn-sm text-base-100 ${a===s.id?"loading":""}`,disabled:a===s.id,children:a===s.id?"":"Eliminar"})]})})]},s.id))})]}),e.jsx("dialog",{ref:o,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsxs("h4",{className:"font-bold text-center",children:["¿Estás seguro de eliminar ",l==null?void 0:l.name," de la base de datos?"]}),e.jsxs("p",{className:"text-justify",children:["Se eliminarán ",e.jsx("b",{children:w})," puestos y ",e.jsx("b",{children:M})," empleados deberán ser reasignados a nuevas empresas y puestos."]}),e.jsx("p",{className:"text-justify",children:"Esta operación borrará todos los archivos relacionados a la empresa y no se podrán recuperar."}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{className:"btn-cancel",onClick:()=>{var s;return(s=o.current)==null?void 0:s.close()},disabled:!!a,children:"No, cancelar"}),e.jsx("button",{onClick:()=>$(),className:`btn-accept ${a?"loading":""}`,disabled:!!a,children:a?"":"Sí, eliminar"})]})]})}),D&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsx(Y,{onClose:()=>m(!1),onSuccess:_})}),v&&p&&e.jsx(T,{company:p,onClose:s=>{h(!1),s&&c()}})]})]})};export{Q as default};
