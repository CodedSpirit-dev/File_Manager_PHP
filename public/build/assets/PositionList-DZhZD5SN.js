import{r as t,j as e,Y as $}from"./app-NK-oG3KX.js";import q from"./CreatePosition-BLFq-I6t.js";import{getPositions as I,getPositionCounts as J,deletePosition as U}from"./positionApi-amvjxoLF.js";import Y from"./EditPosition-bM7947OA.js";import{u as z}from"./AuthProvider-C42NGhEA.js";import"./index.esm-COHxXWg1.js";const V=()=>{const{hasPermission:a}=z(),[C,S]=t.useState([]),[v,m]=t.useState(!0),[p,_]=t.useState(null),[j,P]=t.useState(null),[k,N]=t.useState(!1),[D,x]=t.useState(!1),[f,u]=t.useState(null),[c,h]=t.useState(null),[w,A]=t.useState(0),r=t.useRef(null),[l,y]=t.useState(null),[i,g]=t.useState(null),[b,E]=t.useState(null);t.useEffect(()=>{d()},[]);const d=async()=>{m(!0);try{const s=await I();S(s),m(!1)}catch{_("Error al cargar los datos de posiciones"),m(!1)}},L=s=>{P(s),N(!0)},O=async s=>{var n;E(s.id);try{const o=await J(s.id);A(o.employees_count),y(s),(n=r.current)==null||n.showModal()}catch{u("Error al obtener datos de la posición.")}finally{E(null)}},M=async()=>{var s,n,o;if(l){g(l.id);try{await U(l.id),h("Puesto eliminado exitosamente."),d()}catch(T){u(((n=(s=T.response)==null?void 0:s.data)==null?void 0:n.message)||"Error al eliminar el puesto.")}finally{(o=r.current)==null||o.close(),y(null),g(null)}}},R=()=>{d(),x(!1)};return v?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):p?e.jsx("div",{className:"text-center text-error",children:p}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx($,{title:"Puestos"}),e.jsx("h2",{className:"text-center mb-2",children:"LISTA DE PUESTOS"}),a("can_create_positions")&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx("button",{onClick:()=>x(!0),className:"btn btn-success",children:"Agregar nuevo puesto"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Nombre del Puesto"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Empresa"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Nivel de Jerarquía"})," ",e.jsx("th",{className:"px-4 py-2 text-center",children:"Cantidad de Empleados"}),(a("can_update_positions")||a("can_delete_positions"))&&e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:C.map(s=>e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:s.name}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content truncate text-center",children:s.company_name||"N/A"}),e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content text-center",children:[" ",s.hierarchy_level]}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content text-center",children:s.employees_count??0}),(a("can_update_positions")||a("can_delete_positions"))&&e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[a("can_update_positions")&&e.jsx("button",{onClick:()=>L(s),className:"btn btn-primary btn-sm",children:"Editar"}),a("can_delete_positions")&&e.jsx("button",{onClick:()=>O(s),className:`btn btn-error btn-sm text-base-100 ${b===s.id?"loading":""}`,disabled:!!b,children:b===s.id?"":"Eliminar"})]})})]},s.id))})]}),e.jsx("dialog",{ref:r,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsxs("h4",{className:"font-bold text-center",children:["¿Estás seguro de eliminar el puesto ",e.jsx("b",{children:l==null?void 0:l.name})," de la base de datos?"]}),e.jsxs("p",{className:"text-justify mt-2",children:[e.jsx("b",{children:w})," empleados asociados a este puesto deberán ser reasignados a nuevas empresas y puestos."]}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{type:"button",className:"btn-warning-mod",onClick:()=>{var s;return(s=r.current)==null?void 0:s.close()},disabled:!!i,children:"No, cancelar"}),e.jsx("button",{type:"button",onClick:M,className:`btn-cancel ${i?"loading":""}`,disabled:!!i,children:i?"Eliminando...":"Sí, eliminar"})]})]})}),D&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsx(q,{onClose:()=>x(!1),onSuccess:R})}),k&&j&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsx(Y,{position:j,onClose:s=>{N(!1),s&&d()}})}),c&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center",children:"Éxito"}),e.jsx("p",{className:"text-center text-green-600",children:c}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{className:"btn btn-success",onClick:()=>h(null),children:"Cerrar"})})]})}),c&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center",children:"Éxito"}),e.jsx("p",{className:"text-center text-green-600",children:c}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{className:"btn btn-success",onClick:()=>h(null),children:"Cerrar"})})]})}),f&&e.jsx("dialog",{open:!0,className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h4",{className:"font-bold text-center",children:"Error al Eliminar Puesto"}),e.jsx("p",{className:"text-center text-red-600",children:f}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{className:"btn btn-error",onClick:()=>u(null),children:"Cerrar"})})]})})]})]})};export{V as default};
