import{r as n,b as u,j as e}from"./app-CYh5bE9e.js";import{u as X,C as t}from"./index.esm-CcO2mCQL.js";function ee({onSuccess:q,onClose:N}){const{control:o,handleSubmit:y,setValue:_,watch:i,getValues:d,formState:{errors:r,isValid:v},reset:E}=X({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",password:"",password_confirmation:"",company_id:"",position_id:"",enable_permissions:!1,selected_permissions:[]}}),[w,F]=n.useState([]),[O,$]=n.useState([]),[U,V]=n.useState([]),[z,Z]=n.useState([]);n.useState(!1),n.useState(!1);const[c,x]=n.useState(1),[D,C]=n.useState(""),[G,S]=n.useState(null),b=i();i("password"),i("password_confirmation");const H=i("enable_permissions"),j=n.useRef(null),f=n.useRef(null),g=n.useRef(null);n.useEffect(()=>{u.get("api/positions").then(s=>F(s.data)).catch(s=>console.error("Error al cargar los puestos",s)),u.get("api/permissions").then(s=>V(s.data)).catch(s=>console.error("Error al cargar los permisos",s)),u.get("admin/companies").then(s=>$(s.data)).catch(s=>console.error("Error al cargar las empresas",s))},[]);const k=i("company_id");n.useEffect(()=>{const s=w.filter(a=>a.company_id===Number(k));Z(s),_("position_id","")},[k,w,_]);const T=s=>{const a=d("selected_permissions");a.includes(s)?_("selected_permissions",a.filter(l=>l!==s)):_("selected_permissions",[...a,s])},B=()=>{var s;(s=j.current)==null||s.showModal()},m=()=>{var s;(s=j.current)==null||s.close()},M=()=>{var s;(s=f.current)==null||s.showModal()},J=()=>{var s;(s=f.current)==null||s.close(),q()},P=()=>{var s;(s=g.current)==null||s.showModal()},K=()=>{var s;(s=g.current)==null||s.close()},Q=s=>{const a={first_name:s.first_name,last_name_1:s.last_name_1,last_name_2:s.last_name_2,username:s.username,password:s.password,password_confirmation:s.password_confirmation,company_id:Number(s.company_id),position_id:Number(s.position_id)};u.post("/admin/employees",a).then(l=>{const h=l.data;s.enable_permissions&&s.selected_permissions.length>0?u.post("/api/userpermissions",{employee_id:h.id,permissions:s.selected_permissions}).then(()=>{S("¡Usuario registrado con éxito y permisos asignados!"),E(),x(1),m(),M()}).catch(p=>{var R,A;console.error("Error al asignar permisos",p),C(((A=(R=p.response)==null?void 0:R.data)==null?void 0:A.message)||"Ocurrió un error al asignar permisos."),m(),P()}):(S("¡Usuario registrado con éxito!"),E(),x(1),m(),M())}).catch(l=>{var h,p;console.error("Error al registrar el usuario",l),C(((p=(h=l.response)==null?void 0:h.data)==null?void 0:p.message)||"Ocurrió un error al registrar el usuario."),m(),P()})},L={Empresas:["can_create_companies","can_delete_companies","can_update_companies"],Puestos:["can_create_positions","can_update_positions","can_delete_positions"],Empleados:["can_create_employees","can_delete_employees","can_update_employees","can_view_company_employees","can_view_all_employees"],"Gestión de Archivos y Carpetas":["can_view_file_explorer","can_open_files","can_upload_files_and_folders","can_create_folders","can_download_files_and_folders","can_copy_files","can_move_files","can_rename_files_and_folders","can_delete_files_and_folders"]},W=Object.keys(L).map(s=>({category:s,permissions:U.filter(a=>L[s].includes(a.name))}));return e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"",children:"Registro de nuevos usuarios"}),e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${c>=1?"step-primary":""}`,children:"Datos del Usuario"}),e.jsx("li",{className:`step ${c===2?"step-primary":""}`,children:"Permisos"})]}),e.jsxs("form",{className:"form_data_entry",onSubmit:y(B),children:[c===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"first_name",control:o,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})}),r.first_name&&e.jsx("p",{className:"text-red-600",children:r.first_name.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"last_name_1",control:o,rules:{required:"El primer apellido es obligatorio",minLength:{value:3,message:"El primer apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El primer apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El primer apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})}),r.last_name_1&&e.jsx("p",{className:"text-red-600",children:r.last_name_1.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"last_name_2",control:o,rules:{minLength:{value:3,message:"El segundo apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El segundo apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El primer apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})}),r.last_name_2&&e.jsx("p",{className:"text-red-600",children:r.last_name_2.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"username",control:o,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:50,message:"El nombre de usuario no debe exceder los 50 caracteres"},pattern:{value:/^\S+@\S+\.\S+$/,message:"El nombre de usuario debe ser un email válido"}},render:({field:s})=>e.jsx("input",{...s,type:"email",className:"input__data__entry",placeholder:"Nombre de usuario (Email)"})}),r.username&&e.jsx("p",{className:"text-red-600",children:r.username.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"company_id",control:o,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),O.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),r.company_id&&e.jsx("p",{className:"text-red-600",children:r.company_id.message})]}),b.company_id&&e.jsx(e.Fragment,{children:b.company_id===""&&e.jsx("p",{className:"text-red-600",children:"La empresa es obligatoria"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"position_id",control:o,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:i("company_id")==="",children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),z.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),r.position_id&&e.jsx("p",{className:"text-red-600",children:r.position_id.message})]}),b.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"password",control:o,rules:{required:"La contraseña es obligatoria",minLength:{value:6,message:"La contraseña debe tener al menos 6 caracteres"}},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña"})}),r.password&&e.jsx("p",{className:"text-red-600",children:r.password.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"password_confirmation",control:o,rules:{required:"Debe confirmar la contraseña",validate:s=>s===d("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})}),r.password_confirmation&&e.jsx("p",{className:"text-red-600",children:r.password_confirmation.message})]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-cancel",onClick:N,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-accept ml-2",onClick:()=>x(c+1),disabled:!v,children:"Siguiente"})]}),!v&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]}),c===2&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4",children:e.jsxs("label",{htmlFor:"enable_permissions",className:"flex items-center",children:[e.jsx(t,{name:"enable_permissions",control:o,defaultValue:!1,render:({field:s})=>e.jsx("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:s.value,onChange:a=>s.onChange(a.target.checked),id:"enable_permissions"})}),e.jsx("span",{className:"ml-2",children:"Habilitar permisos"})]})}),H&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"mb-3 text-xl text-center font-bold",children:"Permisos"}),W.map(({category:s,permissions:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(l=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:d("selected_permissions").includes(l.id),onChange:()=>T(l.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:l.description})]},l.id))})]},s))]}),e.jsxs("div",{className:"mt-4 flex justify-center",children:[e.jsx("button",{type:"button",className:"btn btn-cancel",onClick:N,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn-info-mod mx-2",onClick:()=>x(c-1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn btn-success",children:"Guardar"})]})]})]}),e.jsx("dialog",{ref:j,id:"modal_employee_confirm",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsxs("h4",{className:"font-bold text-center",children:["¿Estás seguro de registrar al usuario ",e.jsxs("b",{children:[d("first_name")," ",d("last_name_1")]}),"?"]}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:m,children:"No, cancelar"}),e.jsx("button",{type:"button",className:"btn-accept",onClick:y(Q),children:"Sí, registrar usuario"})]})]})}),e.jsx("dialog",{ref:f,id:"modal_employee_success",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center",children:"Registro de Usuario"}),e.jsx("p",{className:"text-center text-success",children:G}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{type:"button",className:"btn btn-info",onClick:J,children:"Aceptar"})})]})}),e.jsx("dialog",{ref:g,id:"modal_employee_error",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h4",{className:"font-bold text-center",children:"Error al Registrar Usuario"}),e.jsx("p",{className:"text-center text-error",children:D}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{className:"btn-accept",onClick:K,children:"Cerrar"})})]})})]})}export{ee as default};
