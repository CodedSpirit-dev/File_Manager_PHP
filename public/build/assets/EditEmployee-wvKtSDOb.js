import{r as d,j as e,a as $}from"./app-Zw6Pw8Qo.js";import{u as V,C as l}from"./index.esm-CzC4_LFi.js";const F=({employee:r,positions:m,companies:w,onClose:S,onSuccess:L})=>{const{control:o,handleSubmit:C,setValue:i,watch:u,getValues:z,formState:{errors:a,isValid:_},reset:x}=V({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",phone_number:"",position_id:"",company_id:"",password:"",password_confirmation:""}}),[A,c]=d.useState([]),[h,j]=d.useState(""),[b,g]=d.useState(null),[N,f]=d.useState(!1),v=u(),p=u("company_id");d.useEffect(()=>{const s={first_name:r.first_name,last_name_1:r.last_name_1,last_name_2:r.last_name_2||"",username:r.username,phone_number:r.phone_number||"",position_id:r.position_id?r.position_id.toString():"",company_id:r.company_id?r.company_id.toString():"",password:"",password_confirmation:""};x(s);const n=m.filter(t=>t.company_id===Number(s.company_id));c(n),s.position_id&&n.some(t=>t.id.toString()===s.position_id)?i("position_id",s.position_id):i("position_id","")},[r,m,x,i]),d.useEffect(()=>{const s=Number(p);if(s){const n=m.filter(t=>t.company_id===s);c(n),i("position_id","")}else c([]),i("position_id","")},[p,m,i]);const q=()=>{g(null),L()},M=s=>{f(!0);const n={first_name:s.first_name,last_name_1:s.last_name_1,last_name_2:s.last_name_2,phone_number:s.phone_number,username:s.username,company_id:Number(s.company_id),position_id:Number(s.position_id)};s.password&&(n.password=s.password,n.password_confirmation=s.password_confirmation),$.patch(`/admin/employees/${r.id}`,n).then(t=>{g("¡Empleado actualizado con éxito!")}).catch(t=>{var y,E;console.error("Error al actualizar el empleado",t),j(((E=(y=t.response)==null?void 0:y.data)==null?void 0:E.message)||"Ocurrió un error al actualizar el empleado.")}).finally(()=>{f(!1)})};return e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"",children:"Editar Usuario"}),e.jsx("ul",{className:"steps w-full",children:e.jsx("li",{className:"step step-primary",children:"Datos del Empleado"})}),e.jsxs("form",{className:"form_data_entry",onSubmit:C(M),children:[e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"first_name",control:o,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})}),a.first_name&&e.jsx("p",{className:"text-red-600",children:a.first_name.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"last_name_1",control:o,rules:{required:"El primer apellido es obligatorio",minLength:{value:3,message:"El primer apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El primer apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El primer apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})}),a.last_name_1&&e.jsx("p",{className:"text-red-600",children:a.last_name_1.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"last_name_2",control:o,rules:{minLength:{value:3,message:"El segundo apellido debe tener al menos 3 caracteres"},maxLength:{value:50,message:"El segundo apellido no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El segundo apellido solo puede contener letras y espacios"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})}),a.last_name_2&&e.jsx("p",{className:"text-red-600",children:a.last_name_2.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"username",control:o,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:50,message:"El nombre de usuario no debe exceder los 50 caracteres"},pattern:{value:/^\S+@\S+\.\S+$/,message:"El nombre de usuario debe ser un email válido"}},render:({field:s})=>e.jsx("input",{...s,type:"email",className:"input__data__entry",placeholder:"Nombre de usuario (Email)"})}),a.username&&e.jsx("p",{className:"text-red-600",children:a.username.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"phone_number",control:o,rules:{required:"El número de teléfono es obligatorio",maxLength:{value:15,message:"El número de teléfono no debe exceder los 15 caracteres"},pattern:{value:/^\+((52|1)[\s\-]?)?(\(?\d{2,3}\)?[\s\-]?)?(\d{3}[\s\-]?\d{2,4}[\s\-]?\d{4})$/,message:"El número de teléfono debe ser válido de México o EE. UU., comenzando con + y código de área"}},render:({field:s})=>e.jsx("input",{...s,type:"text",className:"input__data__entry",placeholder:"Número de teléfono"})}),a.phone_number&&e.jsx("p",{className:"text-red-600",children:a.phone_number.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"company_id",control:o,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),w.map(n=>e.jsx("option",{value:n.id.toString(),children:n.name},n.id))]})}),a.company_id&&e.jsx("p",{className:"text-red-600",children:a.company_id.message})]}),v.company_id===""&&e.jsx("p",{className:"text-red-600",children:"La empresa es obligatoria"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"position_id",control:o,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:!p,children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),A.map(n=>e.jsx("option",{value:n.id.toString(),children:n.name},n.id))]})}),a.position_id&&e.jsx("p",{className:"text-red-600",children:a.position_id.message})]}),v.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"password",control:o,rules:{minLength:{value:4,message:"La contraseña debe tener al menos 4 caracteres"}},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña (dejar vacío si no desea cambiar)"})}),a.password&&e.jsx("p",{className:"text-red-600",children:a.password.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{name:"password_confirmation",control:o,rules:{validate:s=>s===z("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})}),a.password_confirmation&&e.jsx("p",{className:"text-red-600",children:a.password_confirmation.message})]}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-cancel",onClick:S,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-accept ml-2",disabled:!_||N,children:N?e.jsx("span",{className:"loading loading-spinner"}):"Guardar"})]}),!_&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]}),b&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Acción Exitosa"}),e.jsx("p",{className:"py-4",children:b}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-primary",onClick:q,children:"Aceptar"})})]})}),h&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-error",children:"Error"}),e.jsx("p",{className:"py-4",children:h}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-error",onClick:()=>j(""),children:"Cerrar"})})]})})]})};export{F as default};
