import{q as V,r as d,j as r,b as B}from"./app-dmGPL6eg.js";import{G as v,F as O}from"./Toolbar-itICleqT.js";import T from"./Modal-Cngu8I2o.js";import{getFiles as z,createFolder as G,uploadDirectory as L,uploadFile as q,deleteFile as J,deleteFolder as K}from"./api-D6FUqUs5.js";function Q(s){return v({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(s)}function W(s){return v({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(s)}async function X(s,f){}async function Y(s,f){}async function Z(s,f){}const ae=()=>{var w;const{auth:s}=V().props,f=((w=s.user)==null?void 0:w.permissions)||[],[a,y]=d.useState(null),[l,b]=d.useState([]),[o,g]=d.useState("public"),[C,h]=d.useState(!1),[u,x]=d.useState("");d.useEffect(()=>{m()},[o]);const m=async()=>{try{const e=await z(o),t=F(e.directories,e.files);b(t)}catch(e){console.error("Error al obtener archivos:",e),alert("Error al obtener archivos.")}},F=(e,t)=>{let n=1;const i=e.map(p=>({id:n++,name:p.split("/").pop()||p,type:"folder",date:new Date})),c=t.map(p=>({id:n++,name:p.split("/").pop()||p,type:"file",date:new Date}));return[...i,...c]},j=e=>f.includes(e),N=e=>{y(t=>t===e?null:e)},E=e=>{e.type==="folder"?g(`${o}/${e.name}`):alert(`Abrir archivo: ${e.name}`)},I=()=>{const e=o.split("/");e.length>1&&(e.pop(),g(e.join("/")))},D=()=>{h(!0)},k=async()=>{if(u.trim()===""){alert("El nombre de la carpeta no puede estar vacío.");return}try{const e=await G(u,o);alert(e.message),m(),x(""),h(!1)}catch(e){alert("Error al crear la carpeta."),console.error(e)}},S=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const t=await L(e.files,o);alert(t.message),m()}catch(t){alert("Error al subir la carpeta."),console.error(t)}},e.click()},P=async()=>{if(a){const e=l.find(t=>t.name===a);if(e)try{const t=await X(e.name,o);alert("No se ha implementado la copia de elementos.")}catch(t){alert("Error al copiar el elemento."),console.error(t)}}},A=async()=>{if(a){const e=l.find(t=>t.name===a);if(e)try{const t=await Z(e.name,o);alert("No se ha implementado el movimiento de elementos.")}catch(t){alert("Error al mover el elemento."),console.error(t)}}},M=async()=>{if(a){const e=l.find(t=>t.name===a);if(e)try{const t=await Y(e.name,o);alert("No se ha implementado la renombrar elementos.")}catch(t){alert("Error al renombrar el elemento."),console.error(t)}}},R=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const t=await q(e.files[0],o);alert(t.message),m()}catch(t){alert("Error al subir el archivo."),console.error(t)}},e.click()},U=async()=>{var e;if(a){const t=l.find(n=>n.name===a);if(t&&t.type==="file")try{const n=await B.get("/filemanager/files/download",{params:{filename:a,path:o},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([n.data])),c=document.createElement("a");c.href=i,c.setAttribute("download",a),document.body.appendChild(c),c.click(),(e=c.parentNode)==null||e.removeChild(c)}catch(n){alert("Error al descargar el archivo."),console.error(n)}else alert("Por favor, selecciona un archivo para descargar.")}},$=async()=>{if(a&&window.confirm(`¿Estás seguro de eliminar "${a}"?`))try{const t=l.find(n=>n.name===a);if(t){if(t.type==="file"){const n=await J(a,o);alert(n.message)}else if(t.type==="folder"){const n=await K(a,o);alert(n.message)}m(),y(null)}}catch(t){alert("Error al eliminar el elemento."),console.error(t)}},H=e=>{const t=[...l].sort((n,i)=>e==="date"?new Date(n.date).getTime()-new Date(i.date).getTime():n.name.localeCompare(i.name));b(t)};return r.jsxs("div",{className:"file-manager bg-white",children:[r.jsxs("div",{className:"flex items-center p-4 bg-gray-100 shadow",children:[r.jsx("button",{className:`btn btn-secondary mr-2 ${o==="public"?"btn-disabled":""}`,onClick:I,disabled:o==="public",children:"Volver"}),r.jsxs("span",{className:"text-lg font-semibold",children:["Ruta: /",o]})]}),r.jsx(O,{onCreateFolder:D,onUploadFolder:S,onUploadFile:R,onDownloadFile:U,onDelete:$,onSort:H,isItemSelected:a!==null,hasPermission:j,onCopy:P,onMove:A,onRename:M}),r.jsxs(T,{isOpen:C,title:"Crear Nueva Carpeta",onClose:()=>h(!1),children:[r.jsx("input",{type:"text",value:u,onChange:e=>x(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),r.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[r.jsx("button",{className:"btn btn-secondary",onClick:()=>h(!1),children:"Cancelar"}),r.jsx("button",{className:"btn btn-primary",onClick:k,children:"Crear"})]})]}),r.jsx("div",{className:"p-4",children:l.length===0?r.jsx("p",{children:"No hay archivos o carpetas disponibles."}):r.jsx("ul",{className:"grid grid-cols-4 gap-4",children:l.map(e=>r.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${a===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>N(e.name),onDoubleClick:()=>E(e),children:[r.jsx("span",{className:"text-4xl",children:e.type==="folder"?r.jsx(W,{}):r.jsx(Q,{})}),r.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]})};export{ae as default};
