import{r as n,a as b,j as e}from"./app-zbCKMT02.js";import k from"./LogToolbar-Djf8vlRS.js";const A=()=>{const[o,y]=n.useState([]),[u,f]=n.useState([]),[j,p]=n.useState(!0),[m,g]=n.useState(null),[l,N]=n.useState(""),[x,_]=n.useState(""),[r,h]=n.useState({key:"date",direction:"desc"}),[L,w]=n.useState([]);n.useEffect(()=>{S()},[]),n.useEffect(()=>{if(o.length>0){const t=Array.from(new Set(o.map(s=>s.transaction_id)));w(t)}},[o]),n.useEffect(()=>{C()},[o,l,r,x]);const S=async()=>{p(!0);try{const t=await b.get("/api/logs");y(t.data)}catch(t){g("Error al cargar los registros"),console.error(t)}finally{p(!1)}},C=()=>{let t=[...o];if(l){const s=l.toLowerCase();t=t.filter(a=>a.description.toLowerCase().includes(s)||a.user_name&&a.user_name.toLowerCase().includes(s))}x&&(t=t.filter(s=>s.transaction_id.toLowerCase()===x.toLowerCase())),t.sort((s,a)=>{let i,c;return r.key==="user_name"?(i=s.user_name?s.user_name.toLowerCase():s.user_id!==null&&s.user_id!==void 0?s.user_id.toString():"",c=a.user_name?a.user_name.toLowerCase():a.user_id!==null&&a.user_id!==void 0?a.user_id.toString():"",i=i.toLowerCase(),c=c.toLowerCase()):r.key==="date"?(i=new Date(s.date),c=new Date(a.date)):(i=s[r.key],c=a[r.key],typeof i=="string"&&(i=i.toLowerCase()),typeof c=="string"&&(c=c.toLowerCase())),i<c?r.direction==="asc"?-1:1:i>c?r.direction==="asc"?1:-1:0}),f(t)},d=t=>{h(s=>({key:t,direction:s.key===t&&s.direction==="asc"?"desc":"asc"}))};return j?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):m?e.jsx("div",{className:"text-center text-error",children:m}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx("h2",{className:"text-center mb-4 text-2xl font-semibold",children:"Historial de Logs"}),e.jsx(k,{searchQuery:l,setSearchQuery:N,transactionFilter:x,setTransactionFilter:_,transactionOptions:L,sortOrder:r.direction,setSortOrder:t=>h(s=>({...s,direction:t}))}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsxs("th",{className:"px-4 py-2 text-center cursor-pointer",onClick:()=>d("id"),children:["ID ",r.key==="id"?r.direction==="asc"?"↑":"↓":""]}),e.jsxs("th",{className:"px-4 py-2 text-center cursor-pointer",onClick:()=>d("user_name"),children:["Usuario ",r.key==="user_name"?r.direction==="asc"?"↑":"↓":""]}),e.jsxs("th",{className:"px-4 py-2 text-center cursor-pointer",onClick:()=>d("transaction_id"),children:["Transacción ",r.key==="transaction_id"?r.direction==="asc"?"↑":"↓":""]}),e.jsxs("th",{className:"px-4 py-2 text-center cursor-pointer",onClick:()=>d("description"),children:["Descripción ",r.key==="description"?r.direction==="asc"?"↑":"↓":""]}),e.jsxs("th",{className:"px-4 py-2 text-center cursor-pointer",onClick:()=>d("date"),children:["Fecha y Hora ",r.key==="date"?r.direction==="asc"?"↑":"↓":""]}),e.jsx("th",{className:"px-4 py-2 text-center",children:"IP Address"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"User Agent"})]})}),e.jsx("tbody",{children:u.length>0?u.map(t=>e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{className:"border px-4 py-2 text-center",children:t.id}),e.jsx("td",{className:"border px-4 py-2 text-center",children:t.user_name||t.user_id}),e.jsx("td",{className:"border px-4 py-2 text-center",children:t.transaction_id}),e.jsx("td",{className:"border px-4 py-2 text-center",children:t.description}),e.jsx("td",{className:"border px-4 py-2 text-center",children:new Date(t.date).toLocaleString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),e.jsx("td",{className:"border px-4 py-2 text-center",children:t.ip_address||"N/A"}),e.jsx("td",{className:"border px-4 py-2 text-center",children:t.user_agent||"N/A"})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4",children:"No hay registros para mostrar."})})})]})})]})};export{A as default};
