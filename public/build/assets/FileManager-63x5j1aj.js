import{q as Le,r as l,j as e,b as Ue}from"./app-BnNsUsYD.js";import{F as He,B as ze,b as Ve,c as $e,d as qe,e as Ge,f as Je,g as Ke,h as Xe,i as We,j as _e,k as Ye,l as Qe,m as Ze,n as es,o as ss,p as ts,q as rs,s as as,t as os,v as ns,x as ls,y as is,z as cs,A as ps,C as ds,D as ms,E as us,G as fs,H as hs,I as xs,J as ys,K as js,L as gs,M as Fs,N as vs,O as bs,Q as Cs,R as ws,S as Bs,T as Es,U as Ns,V as Ss,W as Ms,X as Is,Y as ks,Z as Os,_ as As,a0 as Ps,a1 as Rs}from"./Toolbar-Cn1EFOJk.js";import j from"./Modal-B6lSVj_-.js";import Ts from"./FileViewerModal-Cbhsjw8F.js";import{G as ne}from"./index-BBVP-7Cz.js";import{getFilesTree as Ds,createFolder as Ls,uploadDirectory as Us,uploadFile as Hs,downloadFile as zs,downloadFolder as Vs,deleteFile as $s,deleteFolder as qs,copyFiles as Gs,moveFile as Js,renameFile as Ks}from"./fileManagerApi-DHEunZPK.js";import Xs from"./Breadcrumb-CfQQKqW-.js";import"./portal-DGpZwuxO.js";import"./use-server-handoff-complete-DRAXSv_O.js";import"./FileViewer-DortQW5A.js";function Ws(g){return ne({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(g)}function _s(g){return ne({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(g)}const it=()=>{var re;const{auth:g}=Le().props;(re=g.user)!=null&&re.permissions;const[i,h]=l.useState([]),[u,O]=l.useState([]),[c,F]=l.useState(""),[A,le]=l.useState(null),[B,ie]=l.useState([]),[P,ce]=l.useState(1),[pe,E]=l.useState(!1),[R,J]=l.useState(""),[K,X]=l.useState(!1),[N,de]=l.useState(null),[W,me]=l.useState(!0),[v,T]=l.useState(!1),[_,D]=l.useState(null),[b,L]=l.useState(!1),[Y,U]=l.useState(null),[ue,H]=l.useState(!1),[fe,he]=l.useState(""),[xe,ye]=l.useState(""),[Ys,je]=l.useState("success"),[C,S]=l.useState(!1),[z,M]=l.useState(""),[V,Q]=l.useState(!0),[$,x]=l.useState(null),[q,G]=l.useState(null),[w,y]=l.useState(null);l.useEffect(()=>{(async()=>{try{await Promise.all([ge(),m()]),Z(B,c),h([])}catch(r){console.error("Error al inicializar datos:",r)}finally{me(!1)}})()},[]),l.useEffect(()=>{B.length>0&&Z(B,c)},[B,c]);const ge=async()=>{try{const s=await Ue.get("/filemanager/hierarchy-company",{withCredentials:!0}),{hierarchy_level:r,company_name:t}=s.data;ce(r),le(t);const a=`public/${t}`;F(a)}catch(s){console.error("Error al obtener jerarquía y empresa:",s)}},m=async()=>{try{const s=await Ds();ie([{name:"public",path:"public",type:"folder",children:s}])}catch(s){console.error("Error fetching files tree:",s),n("Error","Error al obtener el árbol de archivos.","error")}},Z=(s,r)=>{var p,ae;const t=r.split("/").filter(Boolean);let a={children:s};for(const f of t){const k=(p=a.children)==null?void 0:p.find(oe=>oe.name===f&&oe.type==="folder");if(k)a=k;else{console.error("Ruta no encontrada en el árbol:",r),O([]);return}}let o=1;const d=((ae=a.children)==null?void 0:ae.map(f=>({id:o++,name:f.name,type:f.type,date:new Date,path:f.path})))||[];d.sort((f,k)=>f.name.localeCompare(k.name)),O(d)},Fe=s=>{var t;switch((t=s.split(".").pop())==null?void 0:t.toLowerCase()){case"aac":return e.jsx(Rs,{});case"ai":return e.jsx(Ps,{});case"bmp":return e.jsx(As,{});case"cs":return e.jsx(Os,{});case"css":return e.jsx(ks,{});case"csv":return e.jsx(Is,{});case"doc":return e.jsx(Ms,{});case"docx":return e.jsx(Ss,{});case"exe":return e.jsx(Ns,{});case"gif":return e.jsx(Es,{});case"heic":return e.jsx(Bs,{});case"html":return e.jsx(ws,{});case"java":return e.jsx(Cs,{});case"jpg":case"jpeg":return e.jsx(bs,{});case"js":return e.jsx(vs,{});case"json":return e.jsx(Fs,{});case"jsx":return e.jsx(gs,{});case"key":return e.jsx(js,{});case"m4p":return e.jsx(ys,{});case"md":return e.jsx(xs,{});case"mdx":return e.jsx(hs,{});case"mov":return e.jsx(fs,{});case"mp3":return e.jsx(us,{});case"mp4":return e.jsx(ms,{});case"otf":return e.jsx(ds,{});case"pdf":return e.jsx(ps,{});case"php":return e.jsx(cs,{});case"png":return e.jsx(is,{});case"ppt":return e.jsx(ls,{});case"pptx":return e.jsx(ns,{});case"psd":return e.jsx(os,{});case"py":return e.jsx(as,{});case"raw":return e.jsx(rs,{});case"rb":return e.jsx(ts,{});case"sass":return e.jsx(ss,{});case"scss":return e.jsx(es,{});case"sh":return e.jsx(Ze,{});case"sql":return e.jsx(Qe,{});case"svg":return e.jsx(Ye,{});case"tiff":return e.jsx(_e,{});case"tsx":return e.jsx(We,{});case"ttf":return e.jsx(Xe,{});case"txt":return e.jsx(Ke,{});case"wav":return e.jsx(Je,{});case"woff":return e.jsx(Ge,{});case"xls":return e.jsx(qe,{});case"xlsx":return e.jsx($e,{});case"xml":return e.jsx(Ve,{});case"yml":return e.jsx(ze,{});default:return e.jsx(Ws,{})}},ve=(s,r)=>{r.ctrlKey||r.metaKey?h(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s]):h(t=>t.includes(s)&&t.length===1?[]:[s])},be=s=>{var r;if(s.type==="folder")F(s.path);else{const t=(r=s.name.split(".").pop())==null?void 0:r.toLowerCase();t==="pdf"||t==="docx"||t==="xlsx"?(de({url:`/filemanager/files/view?filename=${encodeURIComponent(s.name)}&path=${encodeURIComponent(c)}`,type:t}),X(!0)):n("Error","Tipo de archivo no soportado para visualización.","error")}},n=(s,r,t)=>{he(s),ye(r),je(t),H(!0)},Ce=()=>{E(!0)},we=async()=>{if(R.trim()===""){n("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const s=await Ls(R,c);n("Éxito","Carpeta creada exitosamente.","success"),m(),J(""),E(!1)}catch(s){s.response&&s.response.status===403?n("Error","No tienes permiso para crear carpetas.","error"):n("Error","Error al crear la carpeta.","error"),console.error(s)}},Be=async()=>{const s=document.createElement("input");s.type="file",s.webkitdirectory=!0,s.onchange=async()=>{if(s.files&&s.files.length>0){const r=s.files.length;let t=0;x({total:r,completed:0});try{await Us(s.files,c),t=r,x({total:r,completed:t}),n("Éxito","Carpeta subida exitosamente.","success"),m()}catch{n("Error","Error al subir la carpeta.","error")}finally{x(null)}}},s.click()},Ee=async()=>{const s=document.createElement("input");s.type="file",s.multiple=!0,s.onchange=async()=>{var r,t;if(s.files&&s.files.length>0){const a=s.files.length;let o=0;x({total:a,completed:0});try{for(const d of Array.from(s.files))await Hs(d,c),o+=1,x({total:a,completed:o});n("Éxito","Archivos subidos exitosamente.","success"),m()}catch(d){((t=(r=d.response)==null?void 0:r.data)==null?void 0:t.exception)==="Illuminate\\Http\\Exceptions\\PostTooLargeException"?n("Error","Uno de los archivos supera el límite de 10MB.","error"):n("Error","Error al subir uno o más archivos.","error")}finally{x(null)}}},s.click()},Ne=async()=>{var s,r;if(i.length>0)try{for(const t of i){const a=u.find(o=>o.path===t);if(a){if(a.type==="file"){const o=await zs(a.name,c),d=window.URL.createObjectURL(new Blob([o])),p=document.createElement("a");p.href=d,p.setAttribute("download",a.name),document.body.appendChild(p),p.click(),(s=p.parentNode)==null||s.removeChild(p)}else if(a.type==="folder"){const o=await Vs(a.name,c),d=window.URL.createObjectURL(new Blob([o])),p=document.createElement("a");p.href=d,p.setAttribute("download",`${a.name}.zip`),document.body.appendChild(p),p.click(),(r=p.parentNode)==null||r.removeChild(p)}}}n("Éxito","Elemento(s) descargado(s) exitosamente.","success")}catch(t){t.response&&t.response.status===403?n("Error","No tienes permiso para descargar uno o más elementos.","error"):n("Error","Error al descargar uno o más elementos.","error"),console.error(t)}else n("Error","Por favor, selecciona al menos un elemento para descargar.","error")},Se=async()=>{if(i.length>0&&window.confirm(`¿Estás seguro de que deseas eliminar ${i.length} elemento(s)?`)){const r=i.length;let t=0;G({total:r,completed:0});try{for(const a of i){const o=u.find(d=>d.path===a);o&&(o.type==="file"?await $s(o.name,c):o.type==="folder"&&await qs(o.name,c),t+=1,G({total:r,completed:t}))}n("Éxito","Elemento(s) eliminado(s) exitosamente.","success"),m()}catch{n("Error","Error al eliminar uno o más elementos.","error")}finally{G(null)}}},Me=async()=>{i.length>0&&(D({filenames:i,path:c}),T(!0))},Ie=async()=>{if(_){const{filenames:s,path:r}=_,t=s.length;let a=0;y({type:"copy",total:t,completed:a});try{await Gs(s.map(o=>o.split("/").pop()||o),r,c),a=t,y({type:"copy",total:t,completed:a}),n("Éxito","Archivo(s) copiado(s) exitosamente.","success"),m(),T(!1),D(null),h([])}catch(o){o.response&&o.response.status===403?n("Error","No tienes permiso para copiar uno o más archivos.","error"):o.response&&o.response.data.errors?n("Error",o.response.data.errors.join(" "),"error"):n("Error","Error al copiar uno o más archivos.","error"),console.error(o)}finally{y(null)}}},ee=()=>{T(!1),D(null)},ke=async()=>{i.length>0&&(U({filenames:i,path:c}),L(!0))},Oe=async()=>{if(Y){const{filenames:s,path:r}=Y,t=s.length;let a=0;y({type:"move",total:t,completed:a});try{const o=s.map(async d=>{const p=d.split("/").pop();p&&(await Js(p,r,c),a+=1,y({type:"move",total:t,completed:a}))});await Promise.all(o),n("Éxito","Archivo(s) movido(s) exitosamente.","success"),m(),L(!1),U(null),h([])}catch(o){o.response&&o.response.status===403?n("Error","No tienes permiso para mover uno o más archivos.","error"):n("Error","Error al mover uno o más archivos.","error"),console.error(o)}finally{y(null)}}},se=()=>{L(!1),U(null)},Ae=()=>{if(i.length===1){const s=i[0],r=u.find(t=>t.path===s);if(r){const t=r.type==="file"&&r.name.slice(0,r.name.lastIndexOf("."))||r.name;M(t),Q(r.type==="file"),S(!0)}}else n("Error","Solo puedes renombrar un elemento a la vez.","error")},Pe=async s=>{if(s.preventDefault(),z.trim()===""){n("Error","El nombre del elemento no puede estar vacío.","error");return}let r=z;if(V){const t=u.find(a=>a.path===i[0]);if(t){const a=t.name.lastIndexOf("."),o=a!==-1?t.name.slice(a):"";r+=o}}try{if(i.length===1&&i[0]!=null){const t=await Ks(i[0],r,c);n("Éxito","Elemento renombrado exitosamente.","success"),m(),h([]),S(!1),M("")}}catch(t){t.response&&t.response.status===403?n("Error","No tienes permiso para renombrar este elemento.","error"):n("Error","Error al renombrar el elemento.","error"),console.error(t)}},te=()=>{S(!1),M(""),Q(!0)},Re=({criteria:s,order:r})=>{const t=[...u].sort((a,o)=>{let d=0;return s==="name"&&(d=a.name.localeCompare(o.name)),r==="asc"?d:-d});O(t)},I=l.useCallback(s=>{s.key==="Escape"&&(v&&ee(),b&&se(),C&&te())},[v,b,C]);l.useEffect(()=>(v||b||C?window.addEventListener("keydown",I):window.removeEventListener("keydown",I),()=>{window.removeEventListener("keydown",I)}),[v,b,C,I]);const Te=()=>{const s=c.split("/").filter(Boolean);if(s.length>1){s.pop();const r=s.join("/");F(r)}else F("public")},De=c!==`public/${A}`||P<=1;return e.jsxs(e.Fragment,{children:[P!==null&&A&&!W&&e.jsx(Xs,{currentPath:c,onNavigateTo:F,hierarchyLevel:P,companyName:A}),e.jsxs("div",{className:"file-manager bg-white min-h-fit",children:[e.jsx(He,{onCreateFolder:Ce,onUploadFolder:Be,onUploadFile:Ee,onDownloadFile:Ne,onDelete:Se,onCopy:Me,onRename:Ae,onMove:ke,onSort:Re,isItemSelected:i.length>0,onCopyHere:Ie,onCancelCopy:ee,isCopying:v,onMoveHere:Oe,onCancelMove:se,isMoving:b,onBack:Te,canGoBack:De,selectedItemsCount:i.length}),$&&e.jsx(j,{isOpen:!0,title:"Subiendo Archivos",onClose:()=>{},canClose:!1,children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("span",{className:"loading loading-spinner loading-lg text-primary"}),e.jsxs("p",{children:["Subiendo ",$.completed," de ",$.total," archivos."]})]})}),q&&e.jsx(j,{isOpen:!0,title:"Eliminando Archivos",onClose:()=>{},canClose:!1,children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("span",{className:"loading loading-spinner loading-lg text-primary"}),e.jsxs("p",{children:["Eliminando ",q.completed," de ",q.total," archivos."]})]})}),e.jsxs(j,{isOpen:pe,title:"Crear Nueva Carpeta",onClose:()=>E(!1),children:[e.jsx("input",{type:"text",value:R,onChange:s=>J(s.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>E(!1),children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:we,children:"Crear"})]})]}),K&&N&&N.type&&e.jsx(Ts,{isOpen:K,fileUrl:N.url,fileType:N.type,onClose:()=>X(!1)}),e.jsx(j,{isOpen:C,title:`Renombrar ${V?"Archivo":"Carpeta"}`,onClose:()=>S(!1),children:e.jsxs("form",{onSubmit:Pe,children:[e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Nombre ",V?"de archivo":"de carpeta"]})}),e.jsx("input",{type:"text",value:z,onChange:s=>M(s.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]})}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:te,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),e.jsx("div",{className:"p-4",children:W?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):u.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No hay archivos o carpetas disponibles."}):e.jsx("ul",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4",children:u.map(s=>e.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center relative ${i.includes(s.path)?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:r=>ve(s.path,r),onDoubleClick:()=>be(s),children:[e.jsx("span",{className:"text-4xl",children:s.type==="folder"?e.jsx(_s,{}):Fe(s.name)}),e.jsx("span",{className:"mt-2 text-center truncate w-full",children:s.name}),i.includes(s.path)&&e.jsx("span",{className:"absolute top-2 right-2 bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center",children:"✓"})]},s.path))})})]}),e.jsxs(j,{isOpen:ue,title:fe,onClose:()=>H(!1),children:[e.jsx("p",{children:xe}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{className:"btn",onClick:()=>H(!1),children:"Aceptar"})})]}),w&&e.jsx(j,{isOpen:!0,title:w.type==="copy"?"Copiando Archivos":"Moviendo Archivos",onClose:()=>{},canClose:!1,children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("span",{className:"loading loading-spinner loading-lg text-primary"}),e.jsxs("p",{children:[w.type==="copy"?"Copiando":"Moviendo"," ",w.completed," de ",w.total," archivos."]})]})})]})};export{it as default};
