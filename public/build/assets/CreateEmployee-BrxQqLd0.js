import{r,b as x,j as e}from"./app-CqAKmByK.js";import{u as K,C as t}from"./index.esm-x6YN9HKA.js";function X({onSuccess:k,onClose:b}){const{control:l,handleSubmit:N,setValue:p,watch:c,getValues:m,formState:{errors:o,isValid:f},reset:P}=K({mode:"onChange",defaultValues:{first_name:"",last_name_1:"",last_name_2:"",username:"",password:"",password_confirmation:"",company_id:"",position_id:"",enable_permissions:!1,selected_permissions:[]}}),[g,M]=r.useState([]),[F,R]=r.useState([]),[A,q]=r.useState([]),[L,z]=r.useState([]);r.useState(!1),r.useState(!1);const[i,u]=r.useState(1),[V,Z]=r.useState(""),[O,$]=r.useState(null),a=c(),y=c("password"),E=c("password_confirmation"),D=c("enable_permissions"),v=r.useRef(null),_=r.useRef(null),h=r.useRef(null);r.useEffect(()=>{x.get("api/positions").then(s=>M(s.data)).catch(s=>console.error("Error al cargar los puestos",s)),x.get("api/permissions").then(s=>q(s.data)).catch(s=>console.error("Error al cargar los permisos",s)),x.get("admin/companies").then(s=>R(s.data)).catch(s=>console.error("Error al cargar las empresas",s))},[]);const C=c("company_id");r.useEffect(()=>{const s=g.filter(n=>n.company_id===Number(C));z(s),p("position_id","")},[C,g,p]);const G=s=>{const n=m("selected_permissions");n.includes(s)?p("selected_permissions",n.filter(d=>d!==s)):p("selected_permissions",[...n,s])},j=()=>{var s;(s=v.current)==null||s.close()},H=()=>{var s;(s=_.current)==null||s.showModal()},T=()=>{var s;(s=_.current)==null||s.close(),k()},U=()=>{var s;(s=h.current)==null||s.showModal()},B=()=>{var s;(s=h.current)==null||s.close()},w=s=>{x.post("/admin/employees/",s).then(n=>{$("¡Empleado registrado con éxito!"),P(),u(1),j(),H()}).catch(n=>{Z(s.message),j(),U()})},S={Empresas:["can_create_companies","can_delete_companies","can_update_companies"],Puestos:["can_create_positions","can_update_positions","can_delete_positions"],Empleados:["can_create_employees","can_delete_employees","can_update_employees","can_view_company_employees","can_view_all_employees"],"Gestión de Archivos y Carpetas":["can_view_file_explorer","can_open_files","can_upload_files_and_folders","can_create_folders","can_download_files_and_folders","can_copy_files","can_move_files","can_rename_files_and_folders","can_delete_files_and_folders"]},J=Object.keys(S).map(s=>({category:s,permissions:A.filter(n=>S[s].includes(n.name))}));return e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"",children:"Registro de nuevos empleados"}),e.jsxs("ul",{className:"steps w-full",children:[e.jsx("li",{className:`step ${i>=1?"step-primary":""}`,children:"Datos del empleado"}),e.jsx("li",{className:`step ${i===2?"step-primary":""}`,children:"Permisos"})]}),e.jsxs("form",{className:"form_data_entry",onSubmit:N(w),children:[i===1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4",children:e.jsx(t,{name:"first_name",control:l,rules:{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no debe exceder los 50 caracteres"},pattern:{value:/^[a-zA-ZÀ-ÿ\s]+$/,message:"El nombre solo puede contener letras"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre(s)"})})}),a.first_name&&e.jsxs(e.Fragment,{children:[a.first_name.length<3&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe tener menos de 3 caracteres"}),a.first_name.length>50&&e.jsx("p",{className:"text-red-600",children:"El nombre no debe exceder los 50 caracteres"}),a.first_name.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre solo puede contener letras"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(t,{name:"last_name_1",control:l,rules:{required:"El primer apellido es obligatorio"},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Primer apellido"})})}),a.last_name_1&&e.jsxs(e.Fragment,{children:[a.last_name_1.length<3&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener menos de 3 caracteres"}),a.last_name_1.length>50&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe exceder los 50 caracteres"}),a.last_name_1.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El primer apellido no debe tener espacios"}),a.last_name_1.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El primer apellido solo puede contener letras"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(t,{name:"last_name_2",control:l,render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Segundo apellido"})})}),a.last_name_2&&e.jsxs(e.Fragment,{children:[a.last_name_2.length<3&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener menos de 3 caracteres"}),a.last_name_2.length>50&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe exceder los 50 caracteres"}),a.last_name_2.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido no debe tener espacios"}),a.last_name_2.match(/[^a-zA-ZÀ-ÿ\s]/)&&e.jsx("p",{className:"text-red-600",children:"El segundo apellido solo puede contener letras"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"username",control:l,rules:{required:"El nombre de usuario es obligatorio",maxLength:{value:18,message:"El nombre de usuario no debe exceder los 18 caracteres"}},render:({field:s})=>e.jsx("input",{...s,className:"input__data__entry",placeholder:"Nombre de usuario (CURP)"})}),o.username&&e.jsx("p",{className:"text-red-600",children:o.username.message})]}),a.username&&e.jsxs(e.Fragment,{children:[a.username.length<3&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe tener menos de 3 caracteres"}),a.username.includes(" ")&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe tener espacios"}),a.username.length>18&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario no debe exceder los 18 caracteres"}),a.username.match(/[^a-zA-Z0-9]/)&&e.jsx("p",{className:"text-red-600",children:"El nombre de usuario solo puede contener letras y números"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"company_id",control:l,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),F.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})}),o.company_id&&e.jsx("p",{className:"text-red-600",children:o.company_id.message})]}),a.company_id&&e.jsx(e.Fragment,{children:a.company_id===""&&e.jsx("p",{className:"text-red-600",children:"La empresa es obligatoria"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"position_id",control:l,rules:{required:"El puesto es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,className:"input__data__entry",disabled:c("company_id")==="",children:[e.jsx("option",{value:"",children:"Seleccione un puesto"}),L.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})}),o.position_id&&e.jsx("p",{className:"text-red-600",children:o.position_id.message})]}),a.company_id===""&&e.jsx("p",{className:"text-red-600",children:"Antes debes seleccionar una empresa"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(t,{name:"password",control:l,rules:{required:"La contraseña es obligatoria"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Contraseña"})}),o.password&&e.jsx("p",{className:"text-red-600",children:o.password.message})]}),e.jsx("div",{className:"mt-4",children:e.jsx(t,{name:"password_confirmation",control:l,rules:{required:"Debe confirmar la contraseña",validate:s=>s===m("password")||"Las contraseñas no coinciden"},render:({field:s})=>e.jsx("input",{...s,type:"password",className:"input__data__entry",placeholder:"Confirmar contraseña"})})}),y&&E&&y!==E&&e.jsx("p",{className:"text-red-600",children:"Las contraseñas no coinciden"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{className:"btn btn-cancel",onClick:b,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-accept ml-2",onClick:()=>u(i+1),disabled:!f,children:"Siguiente"})]}),!f&&e.jsx("p",{className:"text-red-600",children:"Todos los campos son obligatorios"})]}),i===2&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4",children:e.jsxs("label",{htmlFor:"enable_permissions",className:"flex items-center",children:[e.jsx(t,{name:"enable_permissions",control:l,defaultValue:!1,render:({field:s})=>e.jsx("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:s.value,onChange:n=>s.onChange(n.target.checked),id:"enable_permissions"})}),e.jsx("span",{className:"ml-2",children:"Habilitar permisos"})]})}),D&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"mb-3 text-xl text-center font-bold",children:"Permisos"}),J.map(({category:s,permissions:n})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:n.map(d=>e.jsxs("label",{className:"flex items-center my-2",children:[e.jsx("input",{type:"checkbox",checked:m("selected_permissions").includes(d.id),onChange:()=>G(d.id),className:"checkbox checkbox-primary mr-2"}),e.jsx("span",{children:d.description})]},d.id))})]},s))]}),e.jsxs("div",{className:"mt-4 flex justify-center",children:[e.jsx("button",{className:"btn btn-cancel",onClick:b,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn-info-mod mx-2",onClick:()=>u(i-1),children:"Anterior"}),e.jsx("button",{type:"submit",className:"btn btn-success",children:"Guardar"})]})]})]}),e.jsx("dialog",{ref:v,id:"modal_employee_confirm",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsxs("h4",{className:"font-bold text-center",children:["¿Estás seguro de registrar al empleado ",e.jsxs("b",{children:[m("first_name")," ",m("last_name_1")]}),"?"]}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{className:"btn-cancel",onClick:j,children:"No, cancelar"}),e.jsx("button",{className:"btn-accept",onClick:N(w),children:"Sí, registrar empleado"})]})]})}),e.jsx("dialog",{ref:_,id:"modal_employee_success",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center",children:"Registro de Empleado"}),e.jsx("p",{className:"text-center text-success",children:O}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{type:"button",className:"btn btn-info",onClick:T,children:"Aceptar"})})]})}),e.jsx("dialog",{ref:h,id:"modal_employee_error",className:"modal modal-bottom sm:modal-middle",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h4",{className:"font-bold text-center",children:"Error al Registrar Empleado"}),e.jsx("p",{className:"text-center text-error",children:V}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{className:"btn-accept",onClick:B,children:"Cerrar"})})]})})]})}export{X as default};
