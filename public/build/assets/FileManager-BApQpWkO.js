import{q as Te,r as l,j as e,b as Ae}from"./app-BovfylV0.js";import{F as De,B as Pe,b as Le,c as He,d as Ue,e as ze,f as Ve,g as $e,h as qe,i as Ge,j as Je,k as Ke,l as Xe,m as We,n as _e,o as Ye,p as Qe,q as Ze,s as es,t as ss,v as rs,x as ts,y as as,z as os,A as ns,C as ls,D as is,E as cs,G as ps,H as ds,I as ms,J as us,K as fs,L as hs,M as ys,N as xs,O as js,Q as Fs,R as gs,S as vs,T as bs,U as Cs,V as ws,W as Bs,X as Es,Y as Ns,Z as Ss,_ as Ms,a0 as Is,a1 as ks}from"./Toolbar-uhTNLE_i.js";import I from"./Modal-SZX9kpaM.js";import Os from"./FileViewerModal-Kij97OQe.js";import{G as re}from"./index-ZHnS5jSB.js";import{getFilesTree as Rs,createFolder as Ts,uploadDirectory as As,uploadFile as Ds,downloadFile as Ps,downloadFolder as Ls,deleteFile as Hs,deleteFolder as Us,copyFiles as zs,moveFile as Vs,renameFile as $s}from"./fileManagerApi-CFxOPFhz.js";import qs from"./Breadcrumb-DcHPdjTb.js";import"./portal-XZ0YCBwn.js";import"./use-server-handoff-complete-CH_OM7W1.js";import"./FileViewer-CdrITARL.js";function Gs(x){return re({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(x)}function Js(x){return re({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(x)}const ar=()=>{var Z;const{auth:x}=Te().props;(Z=x.user)!=null&&Z.permissions;const[i,u]=l.useState([]),[f,k]=l.useState([]),[c,j]=l.useState(""),[O,te]=l.useState(null),[C,ae]=l.useState([]),[R,oe]=l.useState(1),[ne,w]=l.useState(!1),[T,V]=l.useState(""),[$,q]=l.useState(!1),[B,le]=l.useState(null),[G,ie]=l.useState(!0),[F,A]=l.useState(!1),[J,D]=l.useState(null),[g,P]=l.useState(!1),[K,L]=l.useState(null),[ce,H]=l.useState(!1),[pe,de]=l.useState(""),[me,ue]=l.useState(""),[Ks,fe]=l.useState("success"),[v,E]=l.useState(!1),[U,N]=l.useState(""),[z,X]=l.useState(!0),[b,y]=l.useState(null);l.useEffect(()=>{(async()=>{try{await Promise.all([he(),m()]),W(C,c),u([])}catch(r){console.error("Error al inicializar datos:",r)}finally{ie(!1)}})()},[]),l.useEffect(()=>{C.length>0&&W(C,c)},[C,c]);const he=async()=>{try{const s=await Ae.get("/filemanager/hierarchy-company",{withCredentials:!0}),{hierarchy_level:r,company_name:t}=s.data;oe(r),te(t);const a=`public/${t}`;j(a)}catch(s){console.error("Error al obtener jerarquía y empresa:",s)}},m=async()=>{try{const s=await Rs();ae([{name:"public",path:"public",type:"folder",children:s}])}catch(s){console.error("Error fetching files tree:",s),o("Error","Error al obtener el árbol de archivos.","error")}},W=(s,r)=>{var p,ee;const t=r.split("/").filter(Boolean);let a={children:s};for(const h of t){const M=(p=a.children)==null?void 0:p.find(se=>se.name===h&&se.type==="folder");if(M)a=M;else{console.error("Ruta no encontrada en el árbol:",r),k([]);return}}let n=1;const d=((ee=a.children)==null?void 0:ee.map(h=>({id:n++,name:h.name,type:h.type,date:new Date,path:h.path})))||[];d.sort((h,M)=>h.name.localeCompare(M.name)),k(d)},ye=s=>{var t;switch((t=s.split(".").pop())==null?void 0:t.toLowerCase()){case"aac":return e.jsx(ks,{});case"ai":return e.jsx(Is,{});case"bmp":return e.jsx(Ms,{});case"cs":return e.jsx(Ss,{});case"css":return e.jsx(Ns,{});case"csv":return e.jsx(Es,{});case"doc":return e.jsx(Bs,{});case"docx":return e.jsx(ws,{});case"exe":return e.jsx(Cs,{});case"gif":return e.jsx(bs,{});case"heic":return e.jsx(vs,{});case"html":return e.jsx(gs,{});case"java":return e.jsx(Fs,{});case"jpg":case"jpeg":return e.jsx(js,{});case"js":return e.jsx(xs,{});case"json":return e.jsx(ys,{});case"jsx":return e.jsx(hs,{});case"key":return e.jsx(fs,{});case"m4p":return e.jsx(us,{});case"md":return e.jsx(ms,{});case"mdx":return e.jsx(ds,{});case"mov":return e.jsx(ps,{});case"mp3":return e.jsx(cs,{});case"mp4":return e.jsx(is,{});case"otf":return e.jsx(ls,{});case"pdf":return e.jsx(ns,{});case"php":return e.jsx(os,{});case"png":return e.jsx(as,{});case"ppt":return e.jsx(ts,{});case"pptx":return e.jsx(rs,{});case"psd":return e.jsx(ss,{});case"py":return e.jsx(es,{});case"raw":return e.jsx(Ze,{});case"rb":return e.jsx(Qe,{});case"sass":return e.jsx(Ye,{});case"scss":return e.jsx(_e,{});case"sh":return e.jsx(We,{});case"sql":return e.jsx(Xe,{});case"svg":return e.jsx(Ke,{});case"tiff":return e.jsx(Je,{});case"tsx":return e.jsx(Ge,{});case"ttf":return e.jsx(qe,{});case"txt":return e.jsx($e,{});case"wav":return e.jsx(Ve,{});case"woff":return e.jsx(ze,{});case"xls":return e.jsx(Ue,{});case"xlsx":return e.jsx(He,{});case"xml":return e.jsx(Le,{});case"yml":return e.jsx(Pe,{});default:return e.jsx(Gs,{})}},xe=(s,r)=>{r.ctrlKey||r.metaKey?u(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s]):u(t=>t.includes(s)&&t.length===1?[]:[s])},je=s=>{var r;if(s.type==="folder")j(s.path);else{const t=(r=s.name.split(".").pop())==null?void 0:r.toLowerCase();t==="pdf"||t==="docx"||t==="xlsx"?(le({url:`/filemanager/files/view?filename=${encodeURIComponent(s.name)}&path=${encodeURIComponent(c)}`,type:t}),q(!0)):o("Error","Tipo de archivo no soportado para visualización.","error")}},o=(s,r,t)=>{de(s),ue(r),fe(t),H(!0)},Fe=()=>{w(!0)},ge=async()=>{if(T.trim()===""){o("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const s=await Ts(T,c);o("Éxito","Carpeta creada exitosamente.","success"),m(),V(""),w(!1)}catch(s){s.response&&s.response.status===403?o("Error","No tienes permiso para crear carpetas.","error"):o("Error","Error al crear la carpeta.","error"),console.error(s)}},ve=async()=>{const s=document.createElement("input");s.type="file",s.webkitdirectory=!0,s.onchange=async()=>{if(s.files&&s.files.length>0)try{const r=await As(s.files,c);o("Éxito","Carpeta subida exitosamente.","success"),m()}catch(r){r.response&&r.response.status===403?o("Error","No tienes permiso para subir carpetas.","error"):o("Error","Error al subir la carpeta.","error"),console.error(r)}},s.click()},be=async()=>{const s=document.createElement("input");s.type="file",s.onchange=async()=>{if(s.files&&s.files[0])try{const r=await Ds(s.files[0],c);o("Éxito","Archivo subido exitosamente.","success"),m()}catch(r){r.response&&r.response.status===403?o("Error","No tienes permiso para subir archivos.","error"):o("Error","Error al subir el archivo.","error"),console.error(r)}},s.click()},Ce=async()=>{var s,r;if(i.length>0)try{for(const t of i){const a=f.find(n=>n.path===t);if(a){if(a.type==="file"){const n=await Ps(a.name,c),d=window.URL.createObjectURL(new Blob([n])),p=document.createElement("a");p.href=d,p.setAttribute("download",a.name),document.body.appendChild(p),p.click(),(s=p.parentNode)==null||s.removeChild(p)}else if(a.type==="folder"){const n=await Ls(a.name,c),d=window.URL.createObjectURL(new Blob([n])),p=document.createElement("a");p.href=d,p.setAttribute("download",`${a.name}.zip`),document.body.appendChild(p),p.click(),(r=p.parentNode)==null||r.removeChild(p)}}}o("Éxito","Elemento(s) descargado(s) exitosamente.","success")}catch(t){t.response&&t.response.status===403?o("Error","No tienes permiso para descargar uno o más elementos.","error"):o("Error","Error al descargar uno o más elementos.","error"),console.error(t)}else o("Error","Por favor, selecciona al menos un elemento para descargar.","error")},we=async()=>{if(i.length>0&&window.confirm(`¿Estás seguro de que deseas eliminar ${i.length} elemento(s)?`))try{for(const r of i){const t=f.find(a=>a.path===r);t&&(t.type==="file"?await Hs(t.name,c):t.type==="folder"&&await Us(t.name,c))}o("Éxito","Elemento(s) eliminado(s) exitosamente.","success"),m(),u([])}catch(r){r.response&&r.response.status===403?o("Error","No tienes permiso para eliminar uno o más elementos.","error"):o("Error","Error al eliminar uno o más elementos.","error"),console.error(r)}},Be=async()=>{i.length>0&&(D({filenames:i,path:c}),A(!0))},Ee=async()=>{if(J){const{filenames:s,path:r}=J,t=s.length;let a=0;y({type:"copy",total:t,completed:a});try{await zs(s.map(n=>n.split("/").pop()||n),r,c),a=t,y({type:"copy",total:t,completed:a}),o("Éxito","Archivo(s) copiado(s) exitosamente.","success"),m(),A(!1),D(null),u([])}catch(n){n.response&&n.response.status===403?o("Error","No tienes permiso para copiar uno o más archivos.","error"):n.response&&n.response.data.errors?o("Error",n.response.data.errors.join(" "),"error"):o("Error","Error al copiar uno o más archivos.","error"),console.error(n)}finally{y(null)}}},_=()=>{A(!1),D(null)},Ne=async()=>{i.length>0&&(L({filenames:i,path:c}),P(!0))},Se=async()=>{if(K){const{filenames:s,path:r}=K,t=s.length;let a=0;y({type:"move",total:t,completed:a});try{const n=s.map(async d=>{const p=d.split("/").pop();p&&(await Vs(p,r,c),a+=1,y({type:"move",total:t,completed:a}))});await Promise.all(n),o("Éxito","Archivo(s) movido(s) exitosamente.","success"),m(),P(!1),L(null),u([])}catch(n){n.response&&n.response.status===403?o("Error","No tienes permiso para mover uno o más archivos.","error"):o("Error","Error al mover uno o más archivos.","error"),console.error(n)}finally{y(null)}}},Y=()=>{P(!1),L(null)},Me=()=>{if(i.length===1){const s=i[0],r=f.find(t=>t.path===s);if(r){const t=r.type==="file"&&r.name.slice(0,r.name.lastIndexOf("."))||r.name;N(t),X(r.type==="file"),E(!0)}}else o("Error","Solo puedes renombrar un elemento a la vez.","error")},Ie=async s=>{if(s.preventDefault(),U.trim()===""){o("Error","El nombre del elemento no puede estar vacío.","error");return}let r=U;if(z){const t=f.find(a=>a.path===i[0]);if(t){const a=t.name.lastIndexOf("."),n=a!==-1?t.name.slice(a):"";r+=n}}try{if(i.length===1&&i[0]!=null){const t=await $s(i[0],r,c);o("Éxito","Elemento renombrado exitosamente.","success"),m(),u([]),E(!1),N("")}}catch(t){t.response&&t.response.status===403?o("Error","No tienes permiso para renombrar este elemento.","error"):o("Error","Error al renombrar el elemento.","error"),console.error(t)}},Q=()=>{E(!1),N(""),X(!0)},ke=({criteria:s,order:r})=>{const t=[...f].sort((a,n)=>{let d=0;return s==="name"&&(d=a.name.localeCompare(n.name)),r==="asc"?d:-d});k(t)},S=l.useCallback(s=>{s.key==="Escape"&&(F&&_(),g&&Y(),v&&Q())},[F,g,v]);l.useEffect(()=>(F||g||v?window.addEventListener("keydown",S):window.removeEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}),[F,g,v,S]);const Oe=()=>{const s=c.split("/").filter(Boolean);if(s.length>1){s.pop();const r=s.join("/");j(r)}else j("public")},Re=c!==`public/${O}`||R<=1;return e.jsxs(e.Fragment,{children:[R!==null&&O&&!G&&e.jsx(qs,{currentPath:c,onNavigateTo:j,hierarchyLevel:R,companyName:O}),e.jsxs("div",{className:"file-manager bg-white min-h-fit",children:[e.jsx(De,{onCreateFolder:Fe,onUploadFolder:ve,onUploadFile:be,onDownloadFile:Ce,onDelete:we,onCopy:Be,onRename:Me,onMove:Ne,onSort:ke,isItemSelected:i.length>0,onCopyHere:Ee,onCancelCopy:_,isCopying:F,onMoveHere:Se,onCancelMove:Y,isMoving:g,onBack:Oe,canGoBack:Re,selectedItemsCount:i.length}),e.jsxs(I,{isOpen:ne,title:"Crear Nueva Carpeta",onClose:()=>w(!1),children:[e.jsx("input",{type:"text",value:T,onChange:s=>V(s.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>w(!1),children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:ge,children:"Crear"})]})]}),$&&B&&B.type&&e.jsx(Os,{isOpen:$,fileUrl:B.url,fileType:B.type,onClose:()=>q(!1)}),e.jsx(I,{isOpen:v,title:`Renombrar ${z?"Archivo":"Carpeta"}`,onClose:()=>E(!1),children:e.jsxs("form",{onSubmit:Ie,children:[e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Nombre ",z?"de archivo":"de carpeta"]})}),e.jsx("input",{type:"text",value:U,onChange:s=>N(s.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]})}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Q,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),e.jsx("div",{className:"p-4",children:G?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):f.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No hay archivos o carpetas disponibles."}):e.jsx("ul",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4",children:f.map(s=>e.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center relative ${i.includes(s.path)?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:r=>xe(s.path,r),onDoubleClick:()=>je(s),children:[e.jsx("span",{className:"text-4xl",children:s.type==="folder"?e.jsx(Js,{}):ye(s.name)}),e.jsx("span",{className:"mt-2 text-center truncate w-full",children:s.name}),i.includes(s.path)&&e.jsx("span",{className:"absolute top-2 right-2 bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center",children:"✓"})]},s.path))})})]}),e.jsxs(I,{isOpen:ce,title:pe,onClose:()=>H(!1),children:[e.jsx("p",{children:me}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{className:"btn",onClick:()=>H(!1),children:"Aceptar"})})]}),b&&e.jsx(I,{isOpen:!0,title:b.type==="copy"?"Copiando Archivos":"Moviendo Archivos",onClose:()=>{},canClose:!1,children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("span",{className:"loading loading-spinner loading-lg text-primary"}),e.jsxs("p",{children:[b.type==="copy"?"Copiando":"Moviendo"," ",b.completed," de ",b.total," archivos."]})]})})]})};export{ar as default};
