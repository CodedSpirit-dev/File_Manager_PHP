import{q as Re,r as n,j as s,b as Te}from"./app-Bb8FgcH1.js";import{F as Oe,B as Ae,a as De,b as Pe,c as Le,d as He,e as Ue,f as Ve,g as ze,h as $e,i as qe,j as Ge,k as Je,l as Xe,m as Ke,n as We,o as Ye,p as _e,q as Qe,r as Ze,s as es,t as ss,v as rs,w as ts,x as as,y as os,z as ns,A as ls,C as is,D as cs,E as ps,G as ds,H as ms,I as us,J as fs,K as xs,L as ys,M as hs,N as js,O as Fs,Q as vs,R as bs,S as gs,T as ws,U as Cs,V as Bs,W as Es,X as Ns,Y as Ss,Z as Ms}from"./Toolbar-BDNKX9Lv.js";import H from"./Modal-CK8zulGx.js";import Is from"./FileViewerModal-b6bkWkAF.js";import{G as ee}from"./index-ggVuAhaE.js";import{getFilesTree as ks,createFolder as Rs,uploadDirectory as Ts,uploadFile as Os,downloadFile as As,downloadFolder as Ds,deleteFile as Ps,deleteFolder as Ls,copyFile as Hs,moveFile as Us,renameFile as Vs}from"./fileManagerApi-Cs7CMK3z.js";import zs from"./Breadcrumb-BkFFoROx.js";import"./FileViewer-5NbkrZm5.js";function $s(u){return ee({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(u)}function qs(u){return ee({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(u)}const er=()=>{var W;const{auth:u}=Re().props;(W=u.user)!=null&&W.permissions;const[c,f]=n.useState(null),[p,E]=n.useState([]),[l,x]=n.useState(""),[N,se]=n.useState(null),[v,re]=n.useState([]),[S,te]=n.useState(1),[ae,b]=n.useState(!1),[M,U]=n.useState(""),[V,z]=n.useState(!1),[g,oe]=n.useState(null),[$,ne]=n.useState(!0),[y,I]=n.useState(!1),[k,R]=n.useState(null),[h,T]=n.useState(!1),[O,A]=n.useState(null),[le,D]=n.useState(!1),[ie,ce]=n.useState(""),[pe,de]=n.useState(""),[Gs,me]=n.useState("success"),[j,w]=n.useState(!1),[P,C]=n.useState(""),[L,q]=n.useState(!0);n.useEffect(()=>{(async()=>{try{await Promise.all([ue(),m()]),G(v,l),f(null)}catch(r){console.error("Error al inicializar datos:",r)}finally{ne(!1)}})()},[]),n.useEffect(()=>{v.length>0&&G(v,l)},[v,l]);const ue=async()=>{try{const e=await Te.get("/filemanager/hierarchy-company",{withCredentials:!0}),{hierarchy_level:r,company_name:t}=e.data;te(r),se(t);const o=`public/${t}`;x(o)}catch(e){console.error("Error al obtener jerarquía y empresa:",e)}},m=async()=>{try{const e=await ks();re([{name:"public",path:"public",type:"folder",children:e}])}catch(e){console.error("Error fetching files tree:",e),a("Error","Error al obtener el árbol de archivos.","error")}},G=(e,r)=>{var Y,_;const t=r.split("/").filter(Boolean);let o={children:e};for(const F of t){const Q=(Y=o.children)==null?void 0:Y.find(Z=>Z.name===F&&Z.type==="folder");if(Q)o=Q;else{console.error("Ruta no encontrada en el árbol:",r),E([]);return}}let d=1;const i=((_=o.children)==null?void 0:_.map(F=>({id:d++,name:F.name,type:F.type,date:new Date,path:F.path})))||[];E(i)},fe=e=>{var t;switch((t=e.split(".").pop())==null?void 0:t.toLowerCase()){case"aac":return s.jsx(Ms,{});case"ai":return s.jsx(Ss,{});case"bmp":return s.jsx(Ns,{});case"cs":return s.jsx(Es,{});case"css":return s.jsx(Bs,{});case"csv":return s.jsx(Cs,{});case"doc":return s.jsx(ws,{});case"docx":return s.jsx(gs,{});case"exe":return s.jsx(bs,{});case"gif":return s.jsx(vs,{});case"heic":return s.jsx(Fs,{});case"html":return s.jsx(js,{});case"java":return s.jsx(hs,{});case"jpg":case"jpeg":return s.jsx(ys,{});case"js":return s.jsx(xs,{});case"json":return s.jsx(fs,{});case"jsx":return s.jsx(us,{});case"key":return s.jsx(ms,{});case"m4p":return s.jsx(ds,{});case"md":return s.jsx(ps,{});case"mdx":return s.jsx(cs,{});case"mov":return s.jsx(is,{});case"mp3":return s.jsx(ls,{});case"mp4":return s.jsx(ns,{});case"otf":return s.jsx(os,{});case"pdf":return s.jsx(as,{});case"php":return s.jsx(ts,{});case"png":return s.jsx(rs,{});case"ppt":return s.jsx(ss,{});case"pptx":return s.jsx(es,{});case"psd":return s.jsx(Ze,{});case"py":return s.jsx(Qe,{});case"raw":return s.jsx(_e,{});case"rb":return s.jsx(Ye,{});case"sass":return s.jsx(We,{});case"scss":return s.jsx(Ke,{});case"sh":return s.jsx(Xe,{});case"sql":return s.jsx(Je,{});case"svg":return s.jsx(Ge,{});case"tiff":return s.jsx(qe,{});case"tsx":return s.jsx($e,{});case"ttf":return s.jsx(ze,{});case"txt":return s.jsx(Ve,{});case"wav":return s.jsx(Ue,{});case"woff":return s.jsx(He,{});case"xls":return s.jsx(Le,{});case"xlsx":return s.jsx(Pe,{});case"xml":return s.jsx(De,{});case"yml":return s.jsx(Ae,{});default:return s.jsx($s,{})}},xe=e=>{f(r=>r===e?null:e)},ye=e=>{var r;if(e.type==="folder")x(e.path);else{const t=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();t==="pdf"||t==="docx"||t==="xlsx"?(oe({url:`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(l)}`,type:t}),z(!0)):a("Error","Tipo de archivo no soportado para visualización.","error")}},a=(e,r,t)=>{ce(e),de(r),me(t),D(!0)},he=()=>{b(!0)},je=async()=>{if(M.trim()===""){a("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const e=await Rs(M,l);a("Éxito","Carpeta creada exitosamente.","success"),m(),U(""),b(!1)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para crear carpetas.","error"):a("Error","Error al crear la carpeta.","error"),console.error(e)}},Fe=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const r=await Ts(e.files,l);a("Éxito","Carpeta subida exitosamente.","success"),m()}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para subir carpetas.","error"):a("Error","Error al subir la carpeta.","error"),console.error(r)}},e.click()},ve=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const r=await Os(e.files[0],l);a("Éxito","Archivo subido exitosamente.","success"),m()}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para subir archivos.","error"):a("Error","Error al subir el archivo.","error"),console.error(r)}},e.click()},be=async()=>{var e,r;if(c){const t=p.find(o=>o.name===c);if(t){if(t.type==="file")try{const o=await As(t.name,l),d=window.URL.createObjectURL(new Blob([o])),i=document.createElement("a");i.href=d,i.setAttribute("download",t.name),document.body.appendChild(i),i.click(),(e=i.parentNode)==null||e.removeChild(i),a("Éxito","Archivo descargado exitosamente.","success")}catch(o){o.response&&o.response.status===403?a("Error","No tienes permiso para descargar archivos.","error"):a("Error","Error al descargar el archivo.","error"),console.error(o)}else if(t.type==="folder")try{const o=await Ds(t.name,l),d=window.URL.createObjectURL(new Blob([o])),i=document.createElement("a");i.href=d,i.setAttribute("download",`${t.name}.zip`),document.body.appendChild(i),i.click(),(r=i.parentNode)==null||r.removeChild(i),a("Éxito","Carpeta descargada exitosamente.","success")}catch(o){o.response&&o.response.status===403?a("Error","No tienes permiso para descargar carpetas.","error"):a("Error","Error al descargar la carpeta.","error"),console.error(o)}}}else a("Error","Por favor, selecciona un elemento para descargar.","error")},ge=async()=>{if(c&&window.confirm(`¿Estás seguro de que deseas eliminar "${c}"?`))try{const r=p.find(t=>t.name===c);if(r){let t;r.type==="file"?t=await Ps(r.name,l):r.type==="folder"&&(t=await Ls(r.name,l)),a("Éxito",t.message||"Elemento eliminado exitosamente.","success"),m(),f(null)}}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para eliminar este elemento.","error"):a("Error","Error al eliminar el elemento.","error"),console.error(r)}},we=async()=>{if(c){const e=p.find(r=>r.name===c);e&&e.type==="file"?(R({filename:e.name,path:l}),I(!0)):a("Error","Solo se pueden copiar archivos.","error")}},Ce=async()=>{if(k)try{const e=await Hs(k.filename,k.path,l);a("Éxito","Archivo copiado exitosamente.","success"),m(),I(!1),R(null)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para copiar archivos.","error"):a("Error","Error al copiar el archivo.","error"),console.error(e)}},J=()=>{I(!1),R(null)},Be=async()=>{if(c){const e=p.find(r=>r.name===c);e&&e.type==="file"?(A({filename:e.name,path:l}),T(!0)):a("Error","Solo se pueden mover archivos.","error")}},Ee=async()=>{if(O)try{const e=await Us(O.filename,O.path,l);a("Éxito","Archivo movido exitosamente.","success"),m(),T(!1),A(null),f(null)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para mover archivos.","error"):a("Error","Error al mover el archivo.","error"),console.error(e)}},X=()=>{T(!1),A(null)},Ne=()=>{if(c){const e=p.find(r=>r.name===c);if(e){const r=e.type==="file"&&e.name.slice(0,e.name.lastIndexOf("."))||e.name;C(r),q(e.type==="file"),w(!0)}}},Se=async e=>{if(e.preventDefault(),P.trim()===""){a("Error","El nombre del elemento no puede estar vacío.","error");return}let r=P;if(L){const t=p.find(o=>o.name===c);if(t){const o=t.name.lastIndexOf("."),d=o!==-1?t.name.slice(o):"";r+=d}}try{if(c!=null){const t=await Vs(c,r,l)}a("Éxito","Elemento renombrado exitosamente.","success"),m(),f(null),w(!1),C("")}catch(t){t.response&&t.response.status===403?a("Error","No tienes permiso para renombrar este elemento.","error"):a("Error","Error al renombrar el elemento.","error"),console.error(t)}},K=()=>{w(!1),C(""),q(!0)},Me=({criteria:e,order:r})=>{const t=[...p].sort((o,d)=>{let i=0;return e==="name"&&(i=o.name.localeCompare(d.name)),r==="asc"?i:-i});E(t)},B=n.useCallback(e=>{e.key==="Escape"&&(y&&J(),h&&X(),j&&K())},[y,h,j]);n.useEffect(()=>(y||h||j?window.addEventListener("keydown",B):window.removeEventListener("keydown",B),()=>{window.removeEventListener("keydown",B)}),[y,h,j,B]);const Ie=()=>{const e=l.split("/").filter(Boolean);if(e.length>1){e.pop();const r=e.join("/");x(r)}else x("public")},ke=l!==`public/${N}`||S<=1;return s.jsxs(s.Fragment,{children:[S!==null&&N&&!$&&s.jsx(zs,{currentPath:l,onNavigateTo:x,hierarchyLevel:S,companyName:N}),s.jsxs("div",{className:"file-manager bg-white min-h-fit",children:[s.jsx(Oe,{onCreateFolder:he,onUploadFolder:Fe,onUploadFile:ve,onDownloadFile:be,onDelete:ge,onCopy:we,onRename:Ne,onMove:Be,onSort:Me,isItemSelected:c!==null,onCopyHere:Ce,onCancelCopy:J,isCopying:y,onMoveHere:Ee,onCancelMove:X,isMoving:h,onBack:Ie,canGoBack:ke}),s.jsxs(H,{isOpen:ae,title:"Crear Nueva Carpeta",onClose:()=>b(!1),children:[s.jsx("input",{type:"text",value:M,onChange:e=>U(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>b(!1),children:"Cancelar"}),s.jsx("button",{className:"btn btn-primary",onClick:je,children:"Crear"})]})]}),V&&g&&g.type&&s.jsx(Is,{isOpen:V,fileUrl:g.url,fileType:g.type,onClose:()=>z(!1)}),s.jsx(H,{isOpen:j,title:`Renombrar ${L?"Archivo":"Carpeta"}`,onClose:()=>w(!1),children:s.jsxs("form",{onSubmit:Se,children:[s.jsx("div",{className:"flex flex-col space-y-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsxs("span",{className:"label-text",children:["Nombre ",L?"de archivo":"de carpeta"]})}),s.jsx("input",{type:"text",value:P,onChange:e=>C(e.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]})}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:K,children:"Cancelar"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),s.jsx("div",{className:"p-4",children:$?s.jsx("div",{className:"flex justify-center items-center",children:s.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):p.length===0?s.jsx("p",{className:"text-center text-gray-500",children:"No hay archivos o carpetas disponibles."}):s.jsx("ul",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4",children:p.map(e=>s.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${c===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>xe(e.name),onDoubleClick:()=>ye(e),children:[s.jsx("span",{className:"text-4xl",children:e.type==="folder"?s.jsx(qs,{}):fe(e.name)}),s.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]}),s.jsxs(H,{isOpen:le,title:ie,onClose:()=>D(!1),children:[s.jsx("p",{children:pe}),s.jsx("div",{className:"flex justify-end mt-4",children:s.jsx("button",{className:"btn",onClick:()=>D(!1),children:"Aceptar"})})]})]})};export{er as default};
