import{q as Me,r as a,j as o}from"./app-C0SJH87f.js";import{F as Ie,B as ke,a as Re}from"./Toolbar-BGD38U30.js";import V from"./Modal-RRPQotL-.js";import Oe from"./FileManagerModal-L3cwonBY.js";import{G as Z}from"./index-B-LK3Ovp.js";import{getFilesTree as Ae,createFolder as Te,uploadDirectory as Be,uploadFile as De,downloadFile as Ue,downloadFolder as Le,deleteFile as Ve,deleteFolder as $e,copyFile as He,moveFile as ze,renameFile as Pe}from"./fileManagerApi-D3LryG5H.js";import Ge from"./Breadcrumb-DQTOgCW9.js";import"./FileViewer-BFPNt6OK.js";function qe(f){return Z({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(f)}function Ke(f){return Z({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(f)}const or=()=>{var J;const{auth:f}=Me().props;(J=f.user)!=null&&J.permissions;const[n,u]=a.useState(null),[d,M]=a.useState([]),[c,w]=a.useState("public"),[$,_]=a.useState([]),[ee,C]=a.useState(!1),[I,H]=a.useState(""),[z,P]=a.useState(!1),[E,re]=a.useState(null),[h,k]=a.useState(!1),[R,O]=a.useState(null),[x,A]=a.useState(!1),[T,B]=a.useState(null),[oe,D]=a.useState(!1),[te,se]=a.useState(""),[ae,ne]=a.useState(""),[Je,le]=a.useState("success"),[y,g]=a.useState(!1),[N,j]=a.useState(""),[U,F]=a.useState(""),[v,L]=a.useState(!0);a.useEffect(()=>{p(),u(null)},[]),a.useEffect(()=>{ie($,c),u(null)},[c,$]);const p=async()=>{try{const r={name:"public",path:"public",type:"folder",children:await Ae()};_([r])}catch(e){console.error("Error fetching files tree:",e),t("Error","Error al obtener el árbol de archivos.","error")}},ie=(e,r)=>{var Q,W;const s=r.split("/").filter(Boolean);let l={children:e};for(const b of s){const X=(Q=l.children)==null?void 0:Q.find(Y=>Y.name===b&&Y.type==="folder");if(X)l=X;else{console.error("Ruta no encontrada en el árbol:",r),M([]);return}}let m=1;const i=((W=l.children)==null?void 0:W.map(b=>({id:m++,name:b.name,type:b.type,date:new Date,path:b.path})))||[];M(i)},ce=e=>{w(e)},de=e=>{var s;switch((s=e.split(".").pop())==null?void 0:s.toLowerCase()){case"aac":return o.jsx(Re,{});case"ai":return o.jsx(ke,{});default:return o.jsx(qe,{})}},pe=e=>{u(r=>r===e?null:e)},me=e=>{var r;if(e.type==="folder")w(e.path);else{const s=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();s==="pdf"||s==="docx"||s==="xlsx"?(re({url:`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(c)}`,type:s}),P(!0)):t("Error","Tipo de archivo no soportado para visualización.","error")}},t=(e,r,s)=>{se(e),ne(r),le(s),D(!0)},ue=()=>{C(!0)},fe=async()=>{if(I.trim()===""){t("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const e=await Te(I,c);t("Éxito","Carpeta creada exitosamente.","success"),p(),H(""),C(!1)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para crear carpetas.","error"):t("Error","Error al crear la carpeta.","error"),console.error(e)}},he=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const r=await Be(e.files,c);t("Éxito","Carpeta subida exitosamente.","success"),p()}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para subir carpetas.","error"):t("Error","Error al subir la carpeta.","error"),console.error(r)}},e.click()},xe=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const r=await De(e.files[0],c);t("Éxito","Archivo subido exitosamente.","success"),p()}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para subir archivos.","error"):t("Error","Error al subir el archivo.","error"),console.error(r)}},e.click()},ye=async()=>{var e,r;if(n){const s=d.find(l=>l.name===n);if(s){if(s.type==="file")try{const l=await Ue(s.name,c),m=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=m,i.setAttribute("download",s.name),document.body.appendChild(i),i.click(),(e=i.parentNode)==null||e.removeChild(i),t("Éxito","Archivo descargado exitosamente.","success")}catch(l){l.response&&l.response.status===403?t("Error","No tienes permiso para descargar archivos.","error"):t("Error","Error al descargar el archivo.","error"),console.error(l)}else if(s.type==="folder")try{const l=await Le(s.name,c),m=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=m,i.setAttribute("download",`${s.name}.zip`),document.body.appendChild(i),i.click(),(r=i.parentNode)==null||r.removeChild(i),t("Éxito","Carpeta descargada exitosamente.","success")}catch(l){l.response&&l.response.status===403?t("Error","No tienes permiso para descargar carpetas.","error"):t("Error","Error al descargar la carpeta.","error"),console.error(l)}}}else t("Error","Por favor, selecciona un elemento para descargar.","error")},ve=async()=>{if(n&&window.confirm(`¿Estás seguro de que deseas eliminar "${n}"?`))try{const r=d.find(s=>s.name===n);if(r){let s;r.type==="file"?s=await Ve(r.name,c):r.type==="folder"&&(s=await $e(r.name,c)),t("Éxito",s.message||"Elemento eliminado exitosamente.","success"),p(),u(null)}}catch(r){r.response&&r.response.status===403?t("Error","No tienes permiso para eliminar este elemento.","error"):t("Error","Error al eliminar el elemento.","error"),console.error(r)}},be=async()=>{if(n){const e=d.find(r=>r.name===n);e&&e.type==="file"?(O({filename:e.name,path:c}),k(!0)):t("Error","Solo se pueden copiar archivos.","error")}},we=async()=>{if(R)try{const e=await He(R.filename,R.path,c);t("Éxito","Archivo copiado exitosamente.","success"),p(),k(!1),O(null)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para copiar archivos.","error"):t("Error","Error al copiar el archivo.","error"),console.error(e)}},G=()=>{k(!1),O(null)},Ce=async()=>{if(n){const e=d.find(r=>r.name===n);e&&e.type==="file"?(B({filename:e.name,path:c}),A(!0)):t("Error","Solo se pueden mover archivos.","error")}},Ee=async()=>{if(T)try{const e=await ze(T.filename,T.path,c);t("Éxito","Archivo movido exitosamente.","success"),p(),A(!1),B(null),u(null)}catch(e){e.response&&e.response.status===403?t("Error","No tienes permiso para mover archivos.","error"):t("Error","Error al mover el archivo.","error"),console.error(e)}},q=()=>{A(!1),B(null)},ge=()=>{if(n){const e=d.find(r=>r.name===n);if(e){const[r,s]=e.type==="file"?[n.slice(0,n.lastIndexOf("."))||n,n.slice(n.lastIndexOf(".")+1)]:[n,""];j(r),F(s),L(e.type==="file"),g(!0)}}},Ne=async e=>{if(e.preventDefault(),N.trim()===""){t("Error","El nombre del elemento no puede estar vacío.","error");return}if(v&&U.trim()===""){t("Error","La extensión del archivo no puede estar vacía.","error");return}const r=v?`${N}.${U}`:N;try{if(n!=null){const s=await Pe(n,r,c)}t("Éxito","Elemento renombrado exitosamente.","success"),p(),u(null),g(!1),j(""),F(""),L(!0)}catch(s){s.response&&s.response.status===403?t("Error","No tienes permiso para renombrar este elemento.","error"):t("Error","Error al renombrar el elemento.","error"),console.error(s)}},K=()=>{g(!1),j(""),F(""),L(!0)},je=({criteria:e,order:r})=>{const s=[...d].sort((l,m)=>{let i=0;return e==="name"&&(i=l.name.localeCompare(m.name)),r==="asc"?i:-i});M(s)},S=a.useCallback(e=>{e.key==="Escape"&&(h&&G(),x&&q(),y&&K())},[h,x,y]);a.useEffect(()=>(h||x||y?window.addEventListener("keydown",S):window.removeEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}),[h,x,y,S]);const Fe=()=>{const e=c.split("/").filter(Boolean);if(e.length>1){e.pop();const r=e.join("/");w(r)}else w("public")},Se=c!=="public";return o.jsxs(o.Fragment,{children:[o.jsx(Ge,{currentPath:c,onNavigateTo:ce}),o.jsxs("div",{className:"file-manager bg-white min-h-fit",children:[o.jsx(Ie,{onCreateFolder:ue,onUploadFolder:he,onUploadFile:xe,onDownloadFile:ye,onDelete:ve,onCopy:be,onRename:ge,onMove:Ce,onSort:je,isItemSelected:n!==null,onCopyHere:we,onCancelCopy:G,isCopying:h,onMoveHere:Ee,onCancelMove:q,isMoving:x,onBack:Fe,canGoBack:Se}),o.jsxs(V,{isOpen:ee,title:"Crear Nueva Carpeta",onClose:()=>C(!1),children:[o.jsx("input",{type:"text",value:I,onChange:e=>H(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),o.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[o.jsx("button",{className:"btn btn-secondary",onClick:()=>C(!1),children:"Cancelar"}),o.jsx("button",{className:"btn btn-primary",onClick:fe,children:"Crear"})]})]}),z&&E&&E.type&&o.jsx(Oe,{isOpen:z,title:`Visualizando: ${n}`,fileUrl:E.url,fileType:E.type,onClose:()=>P(!1)}),o.jsx(V,{isOpen:y,title:`Renombrar ${v?"Archivo":"Carpeta"}`,onClose:()=>g(!1),children:o.jsxs("form",{onSubmit:Ne,children:[o.jsxs("div",{className:"flex flex-col space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"label",children:o.jsxs("span",{className:"label-text",children:["Nombre ",v?"de archivo":"de carpeta"]})}),o.jsx("input",{type:"text",value:N,onChange:e=>j(e.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]}),v&&o.jsxs("div",{children:[o.jsx("label",{className:"label",children:o.jsx("span",{className:"label-text",children:"Extensión del archivo"})}),o.jsx("input",{type:"text",value:U,onChange:e=>F(e.target.value),className:"input input-bordered w-full",placeholder:"Extensión (ej: txt, pdf)"})]})]}),o.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[o.jsx("button",{type:"button",className:"btn btn-secondary",onClick:K,children:"Cancelar"}),o.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),o.jsx("div",{className:"p-4",children:d.length===0?o.jsx("p",{className:"text-center text-gray-500",children:"No hay archivos o carpetas disponibles."}):o.jsx("ul",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4",children:d.map(e=>o.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${n===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>pe(e.name),onDoubleClick:()=>me(e),children:[o.jsx("span",{className:"text-4xl",children:e.type==="folder"?o.jsx(Ke,{}):de(e.name)}),o.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]}),o.jsxs(V,{isOpen:oe,title:te,onClose:()=>D(!1),children:[o.jsx("p",{children:ae}),o.jsx("div",{className:"flex justify-end mt-4",children:o.jsx("button",{className:"btn",onClick:()=>D(!1),children:"Aceptar"})})]})]})};export{or as default};
