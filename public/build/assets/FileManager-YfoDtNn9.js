import{q as Oe,r as o,j as s,b as Ae}from"./app-CIo3pR7v.js";import{F as De,B as Le,a as Pe,b as He,c as Ue,d as Ve,e as $e,f as ze,g as qe,h as Ge,i as Je,j as Xe,k as Ke,l as We,m as Ye,n as _e,o as Qe,p as Ze,q as es,r as ss,s as rs,t as ts,v as as,w as os,x as ns,y as ls,z as is,A as cs,C as ps,D as ds,E as us,G as ms,H as fs,I as xs,J as hs,K as ys,L as js,M as vs,N as Fs,O as bs,Q as gs,R as ws,S as Cs,T as Es,U as Bs,V as Ns,W as Ss,X as Ms,Y as ks,Z as Is}from"./Toolbar-DxAHBKSf.js";import $ from"./Modal-E3oF1E-7.js";import Rs from"./FileViewerModal-OfkfEFud.js";import{G as re}from"./index-C6nYOLKR.js";import{getFilesTree as Ts,createFolder as Os,uploadDirectory as As,uploadFile as Ds,downloadFile as Ls,downloadFolder as Ps,deleteFile as Hs,deleteFolder as Us,copyFile as Vs,moveFile as $s,renameFile as zs}from"./fileManagerApi-Dpt-cfdB.js";import qs from"./Breadcrumb-G-P1Rn7b.js";import"./FileViewer-CqXrghHb.js";function Gs(m){return re({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(m)}function Js(m){return re({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(m)}const rr=()=>{var _;const{auth:m}=Oe().props;(_=m.user)!=null&&_.permissions;const[n,f]=o.useState(null),[p,M]=o.useState([]),[i,x]=o.useState(""),[k,te]=o.useState(null),[b,ae]=o.useState([]),[I,oe]=o.useState(1),[ne,g]=o.useState(!1),[R,z]=o.useState(""),[q,G]=o.useState(!1),[w,le]=o.useState(null),[J,ie]=o.useState(!0),[h,T]=o.useState(!1),[O,A]=o.useState(null),[y,D]=o.useState(!1),[L,P]=o.useState(null),[ce,H]=o.useState(!1),[pe,de]=o.useState(""),[ue,me]=o.useState(""),[Xs,fe]=o.useState("success"),[j,C]=o.useState(!1),[E,B]=o.useState(""),[U,N]=o.useState(""),[v,V]=o.useState(!0);o.useEffect(()=>{(async()=>{try{await Promise.all([xe(),d()]),X(b,i),f(null)}catch(r){console.error("Error al inicializar datos:",r)}finally{ie(!1)}})()},[]),o.useEffect(()=>{b.length>0&&X(b,i)},[b,i]);const xe=async()=>{try{const e=await Ae.get("/filemanager/hierarchy-company",{withCredentials:!0}),{hierarchy_level:r,company_name:t}=e.data;oe(r),te(t);const l=`public/${t}`;x(l)}catch(e){console.error("Error al obtener jerarquía y empresa:",e)}},d=async()=>{try{const e=await Ts();ae([{name:"public",path:"public",type:"folder",children:e}])}catch(e){console.error("Error fetching files tree:",e),a("Error","Error al obtener el árbol de archivos.","error")}},X=(e,r)=>{var Q,Z;const t=r.split("/").filter(Boolean);let l={children:e};for(const F of t){const ee=(Q=l.children)==null?void 0:Q.find(se=>se.name===F&&se.type==="folder");if(ee)l=ee;else{console.error("Ruta no encontrada en el árbol:",r),M([]);return}}let u=1;const c=((Z=l.children)==null?void 0:Z.map(F=>({id:u++,name:F.name,type:F.type,date:new Date,path:F.path})))||[];M(c)},he=e=>{var t;switch((t=e.split(".").pop())==null?void 0:t.toLowerCase()){case"aac":return s.jsx(Is,{});case"ai":return s.jsx(ks,{});case"bmp":return s.jsx(Ms,{});case"cs":return s.jsx(Ss,{});case"css":return s.jsx(Ns,{});case"csv":return s.jsx(Bs,{});case"doc":return s.jsx(Es,{});case"docx":return s.jsx(Cs,{});case"exe":return s.jsx(ws,{});case"gif":return s.jsx(gs,{});case"heic":return s.jsx(bs,{});case"html":return s.jsx(Fs,{});case"java":return s.jsx(vs,{});case"jpg":case"jpeg":return s.jsx(js,{});case"js":return s.jsx(ys,{});case"json":return s.jsx(hs,{});case"jsx":return s.jsx(xs,{});case"key":return s.jsx(fs,{});case"m4p":return s.jsx(ms,{});case"md":return s.jsx(us,{});case"mdx":return s.jsx(ds,{});case"mov":return s.jsx(ps,{});case"mp3":return s.jsx(cs,{});case"mp4":return s.jsx(is,{});case"otf":return s.jsx(ls,{});case"pdf":return s.jsx(ns,{});case"php":return s.jsx(os,{});case"png":return s.jsx(as,{});case"ppt":return s.jsx(ts,{});case"pptx":return s.jsx(rs,{});case"psd":return s.jsx(ss,{});case"py":return s.jsx(es,{});case"raw":return s.jsx(Ze,{});case"rb":return s.jsx(Qe,{});case"sass":return s.jsx(_e,{});case"scss":return s.jsx(Ye,{});case"sh":return s.jsx(We,{});case"sql":return s.jsx(Ke,{});case"svg":return s.jsx(Xe,{});case"tiff":return s.jsx(Je,{});case"tsx":return s.jsx(Ge,{});case"ttf":return s.jsx(qe,{});case"txt":return s.jsx(ze,{});case"wav":return s.jsx($e,{});case"woff":return s.jsx(Ve,{});case"xls":return s.jsx(Ue,{});case"xlsx":return s.jsx(He,{});case"xml":return s.jsx(Pe,{});case"yml":return s.jsx(Le,{});default:return s.jsx(Gs,{})}},ye=e=>{f(r=>r===e?null:e)},je=e=>{var r;if(e.type==="folder")x(e.path);else{const t=(r=e.name.split(".").pop())==null?void 0:r.toLowerCase();t==="pdf"||t==="docx"||t==="xlsx"?(le({url:`/filemanager/files/view?filename=${encodeURIComponent(e.name)}&path=${encodeURIComponent(i)}`,type:t}),G(!0)):a("Error","Tipo de archivo no soportado para visualización.","error")}},a=(e,r,t)=>{de(e),me(r),fe(t),H(!0)},ve=()=>{g(!0)},Fe=async()=>{if(R.trim()===""){a("Error","El nombre de la carpeta no puede estar vacío.","error");return}try{const e=await Os(R,i);a("Éxito","Carpeta creada exitosamente.","success"),d(),z(""),g(!1)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para crear carpetas.","error"):a("Error","Error al crear la carpeta.","error"),console.error(e)}},be=async()=>{const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.onchange=async()=>{if(e.files&&e.files.length>0)try{const r=await As(e.files,i);a("Éxito","Carpeta subida exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para subir carpetas.","error"):a("Error","Error al subir la carpeta.","error"),console.error(r)}},e.click()},ge=async()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{if(e.files&&e.files[0])try{const r=await Ds(e.files[0],i);a("Éxito","Archivo subido exitosamente.","success"),d()}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para subir archivos.","error"):a("Error","Error al subir el archivo.","error"),console.error(r)}},e.click()},we=async()=>{var e,r;if(n){const t=p.find(l=>l.name===n);if(t){if(t.type==="file")try{const l=await Ls(t.name,i),u=window.URL.createObjectURL(new Blob([l])),c=document.createElement("a");c.href=u,c.setAttribute("download",t.name),document.body.appendChild(c),c.click(),(e=c.parentNode)==null||e.removeChild(c),a("Éxito","Archivo descargado exitosamente.","success")}catch(l){l.response&&l.response.status===403?a("Error","No tienes permiso para descargar archivos.","error"):a("Error","Error al descargar el archivo.","error"),console.error(l)}else if(t.type==="folder")try{const l=await Ps(t.name,i),u=window.URL.createObjectURL(new Blob([l])),c=document.createElement("a");c.href=u,c.setAttribute("download",`${t.name}.zip`),document.body.appendChild(c),c.click(),(r=c.parentNode)==null||r.removeChild(c),a("Éxito","Carpeta descargada exitosamente.","success")}catch(l){l.response&&l.response.status===403?a("Error","No tienes permiso para descargar carpetas.","error"):a("Error","Error al descargar la carpeta.","error"),console.error(l)}}}else a("Error","Por favor, selecciona un elemento para descargar.","error")},Ce=async()=>{if(n&&window.confirm(`¿Estás seguro de que deseas eliminar "${n}"?`))try{const r=p.find(t=>t.name===n);if(r){let t;r.type==="file"?t=await Hs(r.name,i):r.type==="folder"&&(t=await Us(r.name,i)),a("Éxito",t.message||"Elemento eliminado exitosamente.","success"),d(),f(null)}}catch(r){r.response&&r.response.status===403?a("Error","No tienes permiso para eliminar este elemento.","error"):a("Error","Error al eliminar el elemento.","error"),console.error(r)}},Ee=async()=>{if(n){const e=p.find(r=>r.name===n);e&&e.type==="file"?(A({filename:e.name,path:i}),T(!0)):a("Error","Solo se pueden copiar archivos.","error")}},Be=async()=>{if(O)try{const e=await Vs(O.filename,O.path,i);a("Éxito","Archivo copiado exitosamente.","success"),d(),T(!1),A(null)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para copiar archivos.","error"):a("Error","Error al copiar el archivo.","error"),console.error(e)}},K=()=>{T(!1),A(null)},Ne=async()=>{if(n){const e=p.find(r=>r.name===n);e&&e.type==="file"?(P({filename:e.name,path:i}),D(!0)):a("Error","Solo se pueden mover archivos.","error")}},Se=async()=>{if(L)try{const e=await $s(L.filename,L.path,i);a("Éxito","Archivo movido exitosamente.","success"),d(),D(!1),P(null),f(null)}catch(e){e.response&&e.response.status===403?a("Error","No tienes permiso para mover archivos.","error"):a("Error","Error al mover el archivo.","error"),console.error(e)}},W=()=>{D(!1),P(null)},Me=()=>{if(n){const e=p.find(r=>r.name===n);if(e){const[r,t]=e.type==="file"?[n.slice(0,n.lastIndexOf("."))||n,n.slice(n.lastIndexOf(".")+1)]:[n,""];B(r),N(t),V(e.type==="file"),C(!0)}}},ke=async e=>{if(e.preventDefault(),E.trim()===""){a("Error","El nombre del elemento no puede estar vacío.","error");return}if(v&&U.trim()===""){a("Error","La extensión del archivo no puede estar vacía.","error");return}const r=v?`${E}.${U}`:E;try{if(n!=null){const t=await zs(n,r,i)}a("Éxito","Elemento renombrado exitosamente.","success"),d(),f(null),C(!1),B(""),N(""),V(!0)}catch(t){t.response&&t.response.status===403?a("Error","No tienes permiso para renombrar este elemento.","error"):a("Error","Error al renombrar el elemento.","error"),console.error(t)}},Y=()=>{C(!1),B(""),N(""),V(!0)},Ie=({criteria:e,order:r})=>{const t=[...p].sort((l,u)=>{let c=0;return e==="name"&&(c=l.name.localeCompare(u.name)),r==="asc"?c:-c});M(t)},S=o.useCallback(e=>{e.key==="Escape"&&(h&&K(),y&&W(),j&&Y())},[h,y,j]);o.useEffect(()=>(h||y||j?window.addEventListener("keydown",S):window.removeEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}),[h,y,j,S]);const Re=()=>{const e=i.split("/").filter(Boolean);if(e.length>1){e.pop();const r=e.join("/");x(r)}else x("public")},Te=i!==`public/${k}`||I<=1;return s.jsxs(s.Fragment,{children:[I!==null&&k&&!J&&s.jsx(qs,{currentPath:i,onNavigateTo:x,hierarchyLevel:I,companyName:k}),s.jsxs("div",{className:"file-manager bg-white min-h-fit",children:[s.jsx(De,{onCreateFolder:ve,onUploadFolder:be,onUploadFile:ge,onDownloadFile:we,onDelete:Ce,onCopy:Ee,onRename:Me,onMove:Ne,onSort:Ie,isItemSelected:n!==null,onCopyHere:Be,onCancelCopy:K,isCopying:h,onMoveHere:Se,onCancelMove:W,isMoving:y,onBack:Re,canGoBack:Te}),s.jsxs($,{isOpen:ne,title:"Crear Nueva Carpeta",onClose:()=>g(!1),children:[s.jsx("input",{type:"text",value:R,onChange:e=>z(e.target.value),placeholder:"Nombre de la carpeta",className:"input input-bordered w-full"}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>g(!1),children:"Cancelar"}),s.jsx("button",{className:"btn btn-primary",onClick:Fe,children:"Crear"})]})]}),q&&w&&w.type&&s.jsx(Rs,{isOpen:q,fileUrl:w.url,fileType:w.type,onClose:()=>G(!1)}),s.jsx($,{isOpen:j,title:`Renombrar ${v?"Archivo":"Carpeta"}`,onClose:()=>C(!1),children:s.jsxs("form",{onSubmit:ke,children:[s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsxs("span",{className:"label-text",children:["Nombre ",v?"de archivo":"de carpeta"]})}),s.jsx("input",{type:"text",value:E,onChange:e=>B(e.target.value),className:"input input-bordered w-full",placeholder:"Nombre"})]}),v&&s.jsxs("div",{children:[s.jsx("label",{className:"label",children:s.jsx("span",{className:"label-text",children:"Extensión del archivo"})}),s.jsx("input",{type:"text",value:U,onChange:e=>N(e.target.value),className:"input input-bordered w-full",placeholder:"Extensión (ej: txt, pdf)"})]})]}),s.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,children:"Cancelar"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:"Renombrar"})]})]})}),s.jsx("div",{className:"p-4",children:J?s.jsx("div",{className:"flex justify-center items-center",children:s.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):p.length===0?s.jsx("p",{className:"text-center text-gray-500",children:"No hay archivos o carpetas disponibles."}):s.jsx("ul",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4",children:p.map(e=>s.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${n===e.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>ye(e.name),onDoubleClick:()=>je(e),children:[s.jsx("span",{className:"text-4xl",children:e.type==="folder"?s.jsx(Js,{}):he(e.name)}),s.jsx("span",{className:"mt-2 text-center truncate w-full",children:e.name})]},e.id))})})]}),s.jsxs($,{isOpen:ce,title:pe,onClose:()=>H(!1),children:[s.jsx("p",{children:ue}),s.jsx("div",{className:"flex justify-end mt-4",children:s.jsx("button",{className:"btn",onClick:()=>H(!1),children:"Aceptar"})})]})]})};export{rr as default};
