import{r,b as m,j as e}from"./app-CYh5bE9e.js";import{u as R,C as u}from"./index.esm-CcO2mCQL.js";function w({onClose:x,onSuccess:b}){const{control:o,handleSubmit:N,formState:{errors:a,isValid:c},reset:g}=R({mode:"onChange",defaultValues:{name:"",company_id:"",hierarchy_level:""}}),[y,f]=r.useState([]),[v,_]=r.useState([]),[E,C]=r.useState(""),[S,h]=r.useState(""),i=r.useRef(null),d=r.useRef(null),l=r.useRef(null),M=s=>{m.post("/admin/positions",s).then(()=>{var t,n;C("El puesto ha sido registrado exitosamente."),g(),(t=l.current)==null||t.close(),(n=i.current)==null||n.showModal(),b()}).catch(t=>{var n,p,j;(n=l.current)==null||n.close(),((p=t.response)==null?void 0:p.status)===480?h("El nombre del puesto ya está en uso."):h("Hubo un error al registrar el puesto."),(j=d.current)==null||j.showModal()})};return r.useEffect(()=>{m.get("/admin/companies").then(s=>f(s.data)).catch(s=>console.error("Error al cargar las empresas",s)),m.get("/api/hierarchylevels").then(s=>_(s.data)).catch(s=>console.error("Error al cargar los niveles jerárquicos",s))},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-box",children:e.jsxs("form",{children:[e.jsx("h1",{className:"text-2xl text-center font-bold my-4",children:"Registro de Nuevos Puestos"}),e.jsxs("div",{children:[e.jsxs("label",{className:"input__data__entry mt-4",htmlFor:"company_id",children:[e.jsx(u,{name:"company_id",control:o,rules:{required:"La empresa es obligatoria"},render:({field:s})=>e.jsxs("select",{...s,id:"company_id",className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Seleccione una empresa"}),y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),a.company_id&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:a.company_id.message})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"input__data__entry",htmlFor:"hierarchy_level",children:[e.jsx(u,{name:"hierarchy_level",control:o,rules:{required:"El nivel jerárquico es obligatorio"},render:({field:s})=>e.jsxs("select",{...s,id:"hierarchy_level",className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Seleccione un nivel jerárquico"}),v.map(t=>e.jsx("option",{value:t.level,children:t.name},t.level))]})}),a.hierarchy_level&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:a.hierarchy_level.message})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"input__data__entry",htmlFor:"name",children:[e.jsx(u,{name:"name",control:o,rules:{required:"El nombre del puesto es obligatorio",minLength:{value:3,message:"El nombre debe tener al menos 3 caracteres"}},render:({field:s})=>e.jsx("input",{...s,placeholder:"Nombre del puesto",id:"name",className:"input input-bordered w-full"})}),a.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:a.name.message})]})})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end space-x-4",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:x,children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{var s;return(s=l.current)==null?void 0:s.showModal()},disabled:!c,children:"Registrar Puesto"})]})]})}),e.jsx("dialog",{ref:l,className:"modal",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-center",children:"¿Estás seguro de registrar este puesto?"}),e.jsx("p",{className:"py-4 text-center",children:"Una vez registrado, podrás ver el puesto en la lista."}),e.jsxs("div",{className:"modal-action justify-center",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{var s;return(s=l.current)==null?void 0:s.close()},disabled:!c,children:"No, cancelar"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:N(M),disabled:!c,children:"Sí, registrar puesto"})]})]})}),e.jsx("dialog",{ref:i,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-center",children:"Éxito"}),e.jsx("p",{className:"py-4 text-center text-green-600",children:E}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{var s;(s=i.current)==null||s.close(),x()},children:"Aceptar"})})]})}),e.jsx("dialog",{ref:d,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-center",children:"Error al Registrar Puesto"}),e.jsx("p",{className:"py-4 text-center text-red-600",children:S}),e.jsx("div",{className:"modal-action justify-center",children:e.jsx("button",{type:"button",className:"btn btn-error",onClick:()=>{var s;return(s=d.current)==null?void 0:s.close()},children:"Cerrar"})})]})})]})}export{w as default};
