import{r as t,a as o,j as e,Y as G}from"./app-CNqh7FaR.js";import H from"./EditEmployee-CZ-ViLKr.js";import J from"./CreateEmployee-Zh7KHWeR.js";import{u as K}from"./AuthProvider-Dy0b0h8X.js";import Q from"./CompanyBadge-BtGMi6pk.js";import"./index.esm-CyQdxJpw.js";const ne=()=>{const{hasPermission:n}=K(),[M,w]=t.useState([]),[m,A]=t.useState([]),[b,O]=t.useState([]),[L,x]=t.useState(!0),[N,F]=t.useState(null),[g,I]=t.useState(null),[f,u]=t.useState(!1),[p,h]=t.useState(!1),[y,V]=t.useState(null),[X,j]=t.useState(!1),[r,i]=t.useState(null),[T,E]=t.useState(!1),[P,S]=t.useState(!1),[R,_]=t.useState(!1),[U,C]=t.useState(null),[D,v]=t.useState(null),$=s=>{v(s.id);const a=m.find(z=>z.id===s.position_id),l=a?a.company_id:null,c={...s,company_id:l};I(c),u(!0),v(null)};t.useEffect(()=>{d()},[]);const d=()=>{x(!0),o.all([o.get("admin/employees"),o.get("api/positions"),o.get("admin/companies")]).then(o.spread((s,a,l)=>{w(s.data),A(a.data),O(l.data),x(!1)})).catch(s=>{console.error("Error al cargar los datos",s),F("Error al cargar los datos"),x(!1)})},q=s=>{i(s),j(!0)},B=()=>{r&&(E(!0),C(null),o.delete(`admin/employees/${r.id}`).then(()=>{j(!1),S(!0),i(null)}).catch(s=>{console.error("Error al eliminar el usuario",s),C("Ocurrió un error al eliminar el usuario."),_(!0)}).finally(()=>{E(!1)}))},k=()=>{S(!1),d()},W=()=>{_(!1),i(null)},Y=()=>{j(!1),i(null)};return L?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):N?e.jsx("div",{className:"text-center text-error",children:N}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx(G,{title:"Usuarios"}),e.jsx("h2",{className:"text-center",children:"LISTA DE USUARIOS"}),n("can_create_users")&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>h(!0),className:"btn btn-success",children:"Agregar usuario"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Número Telefónico"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Fecha de Registro"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Último Inicio de Sesión"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Puesto"}),(n("can_update_users")||n("can_delete_users"))&&e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:M.map(s=>{const a=m.find(c=>c.id===s.position_id),l=a?b.find(c=>c.id===a.company_id):null;return l&&l.name,e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:[s.first_name," ",s.last_name_1]}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:s.phone_number||"No disponible"}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:new Date(s.registered_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"No registrado"}),e.jsxs("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:[a==null?void 0:a.name,e.jsx("br",{}),l&&e.jsx(Q,{companyName:l.name})]}),(n("can_update_users")||n("can_delete_users"))&&e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[n("can_update_users")&&e.jsx("button",{onClick:()=>$(s),className:"btn btn-primary btn-sm",disabled:D===s.id,children:D===s.id?e.jsx("span",{className:"loading loading-spinner"}):"Editar"}),n("can_delete_users")&&e.jsx("button",{onClick:()=>q(s),className:"btn btn-error btn-sm text-base-100",children:"Eliminar"})]})})]},s.id)})})]})}),r&&e.jsx("dialog",{open:!0,className:"modal modal-open",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Confirmar Eliminación"}),e.jsxs("p",{className:"py-4",children:["¿Estás seguro de que deseas eliminar al empleado ",e.jsxs("strong",{children:[r.first_name," ",r.last_name_1]}),"?"]}),T?e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{className:"loading loading-spinner loading-md"})}):e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",className:"btn btn-error",onClick:B,children:"Eliminar"}),e.jsx("button",{type:"button",className:"btn",onClick:Y,children:"Cancelar"})]})]})}),P&&e.jsx("dialog",{open:!0,className:"modal modal-open",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"¡Éxito!"}),e.jsx("p",{className:"py-4",children:"El empleado ha sido eliminado exitosamente."}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:k,children:"Aceptar"})})]})}),R&&e.jsx("dialog",{open:!0,className:"modal modal-open",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg text-error",children:"Error"}),e.jsx("p",{className:"py-4",children:U||"Ocurrió un error al eliminar el empleado."}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:W,children:"Aceptar"})})]})}),g&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"edit-employee-modal",className:"modal-toggle",checked:f,readOnly:!0}),e.jsx("label",{htmlFor:"edit-employee-modal",className:`modal cursor-pointer ${f?"modal-open":""}`,children:e.jsx("label",{className:"modal-box relative",htmlFor:"",children:e.jsx(H,{employee:g,positions:m,companies:b,onClose:()=>u(!1),onSuccess:()=>{u(!1),d()}})})})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"add-employee-modal",className:"modal-toggle",checked:p,readOnly:!0}),e.jsx("label",{htmlFor:"add-employee-modal",className:`modal cursor-pointer ${p?"modal-open":""}`,children:e.jsx("label",{className:"modal-box relative",htmlFor:"",children:e.jsx(J,{onSuccess:()=>{d(),h(!1)},onClose:()=>h(!1)})})})]}),y&&e.jsx("dialog",{open:!0,className:"modal modal-open",children:e.jsxs("form",{method:"dialog",className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center text-lg",children:"Acción Exitosa"}),e.jsx("p",{className:"text-center py-4 text-green-500",children:y}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:k,children:"Aceptar"})})]})})]})};export{ne as default};
