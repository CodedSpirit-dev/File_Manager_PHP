import{q as L,r as o,j as e,b as q}from"./app-B-KzDW0C.js";import{F as G,B as X,a as W,b as K,c as Q,d as Y,e as Z,f as _,g as ee,h as se,i as te,j as re,k as ae,l as ne,m as le,n as oe,o as ie,p as ce,q as pe,r as de,s as ue,t as me,u as fe,v as xe,w as ye,x as Fe,y as je,z as he,A as ge,C as Be,D as we,E as ve,G as Ce,H as be,I as Ne,J as Se,K as De,L as Ee,M as Ie,N as Me,O as Pe,P as Te,Q as ke,R as Re,S as Ve,T as Ae,U as Ue,V as Oe,W as He,X as $e}from"./Toolbar-BVd9hW0e.js";import v from"./Modal-mgX7AmXq.js";import Je from"./FileViewer-Ca_57tCL.js";import{G as C}from"./iconBase-CRBEJzkW.js";import{getFiles as ze,createFolder as Le,uploadDirectory as qe,uploadFile as Ge,deleteFile as Xe,deleteFolder as We,updateFolder as Ke}from"./api-DYkBI05C.js";import Qe from"./Breadcrumb-CmFUmx4i.js";function Ye(d){return C({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(d)}function Ze(d){return C({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"},child:[]}]})(d)}const ls=()=>{var w;const{auth:d}=L().props,b=((w=d.user)==null?void 0:w.permissions)||[],[a,x]=o.useState(null),[i,F]=o.useState([]),[n,j]=o.useState("public"),[N,m]=o.useState(!1),[y,h]=o.useState(""),[g,B]=o.useState(!1),[f,S]=o.useState(null);o.useEffect(()=>{c()},[n]);const c=async()=>{try{const s=await ze(n);F(I(s.directories,s.files))}catch(s){console.error("Error fetching files:",s),alert("Error fetching files.")}},D=s=>{j(s)},E=s=>{var r;switch((r=s.split(".").pop())==null?void 0:r.toLowerCase()){case"aac":return e.jsx($e,{});case"ai":return e.jsx(He,{});case"bmp":return e.jsx(Oe,{});case"cs":return e.jsx(Ue,{});case"css":return e.jsx(Ae,{});case"csv":return e.jsx(Ve,{});case"doc":return e.jsx(Re,{});case"docx":return e.jsx(ke,{});case"exe":return e.jsx(Te,{});case"gif":return e.jsx(Pe,{});case"heic":return e.jsx(Me,{});case"html":return e.jsx(Ie,{});case"java":return e.jsx(Ee,{});case"jpg":return e.jsx(De,{});case"js":return e.jsx(Se,{});case"json":return e.jsx(Ne,{});case"jsx":return e.jsx(be,{});case"key":return e.jsx(Ce,{});case"m4p":return e.jsx(ve,{});case"md":return e.jsx(we,{});case"mdx":return e.jsx(Be,{});case"mov":return e.jsx(ge,{});case"mp3":return e.jsx(he,{});case"mp4":return e.jsx(je,{});case"otf":return e.jsx(Fe,{});case"pdf":return e.jsx(ye,{});case"php":return e.jsx(xe,{});case"png":return e.jsx(fe,{});case"ppt":return e.jsx(me,{});case"pptx":return e.jsx(ue,{});case"psd":return e.jsx(de,{});case"py":return e.jsx(pe,{});case"raw":return e.jsx(ce,{});case"rb":return e.jsx(ie,{});case"sass":return e.jsx(oe,{});case"scss":return e.jsx(le,{});case"sh":return e.jsx(ne,{});case"sql":return e.jsx(ae,{});case"svg":return e.jsx(re,{});case"tiff":return e.jsx(te,{});case"tsx":return e.jsx(se,{});case"ttf":return e.jsx(ee,{});case"txt":return e.jsx(_,{});case"wav":return e.jsx(Z,{});case"woff":return e.jsx(Y,{});case"xls":return e.jsx(Q,{});case"xlsx":return e.jsx(K,{});case"xml":return e.jsx(W,{});case"yml":return e.jsx(X,{});default:return e.jsx(Ye,{})}},I=(s,t)=>{let r=1;const p=s.map(u=>({id:r++,name:u.split("/").pop()||u,type:"folder",date:new Date})),l=t.map(u=>({id:r++,name:u.split("/").pop()||u,type:"file",date:new Date}));return[...p,...l]},M=s=>b.includes(s),P=s=>{x(t=>t===s?null:s)},T=s=>{var t;if(s.type==="folder")j(`${n}/${s.name}`);else{const r=(t=s.name.split(".").pop())==null?void 0:t.toLowerCase();r==="pdf"||r==="docx"||r==="xlsx"?(S({url:`/filemanager/files/view?filename=${encodeURIComponent(s.name)}&path=${encodeURIComponent(n)}`,type:r}),B(!0)):alert("File type not supported for viewing.")}},k=()=>{m(!0)},R=async()=>{if(y.trim()===""){alert("Folder name cannot be empty.");return}try{const s=await Le(y,n);alert(s.message),c(),h(""),m(!1)}catch(s){alert("Error creating folder."),console.error(s)}},V=async()=>{const s=document.createElement("input");s.type="file",s.webkitdirectory=!0,s.onchange=async()=>{if(s.files&&s.files.length>0)try{const t=await qe(s.files,n);alert(t.message),c()}catch(t){alert("Error uploading folder."),console.error(t)}},s.click()},A=async()=>{const s=document.createElement("input");s.type="file",s.onchange=async()=>{if(s.files&&s.files[0])try{const t=await Ge(s.files[0],n);alert(t.message),c()}catch(t){alert("Error uploading file."),console.error(t)}},s.click()},U=async()=>{var s;if(a){const t=i.find(r=>r.name===a);if(t&&t.type==="file")try{const r=await q.get("/filemanager/files/download",{params:{filename:a,path:n},responseType:"blob"}),p=window.URL.createObjectURL(new Blob([r.data])),l=document.createElement("a");l.href=p,l.setAttribute("download",a),document.body.appendChild(l),l.click(),(s=l.parentNode)==null||s.removeChild(l)}catch(r){alert("Error downloading file."),console.error(r)}else alert("Please select a file to download.")}},O=async()=>{if(a&&window.confirm(`Are you sure you want to delete "${a}"?`))try{const t=i.find(r=>r.name===a);if(t){let r;t.type==="file"?r=await Xe(a,n):t.type==="folder"&&(r=await We(a,n)),alert(r.message),c(),x(null)}}catch(t){alert("Error deleting item."),console.error(t)}},H=async()=>{a&&alert("Copy functionality not implemented yet.")},$=async()=>{a&&alert("Move functionality not implemented yet.")},J=async()=>{if(a){const s=prompt(`Enter the new name for "${a}":`);if(s&&s.trim()!=="")try{const t=i.find(r=>r.name===a);if(t){let r;if(t.type==="folder")r=await Ke(t.name,s,n);else{alert("Renaming files is not implemented yet.");return}alert(r.message),c(),x(null)}}catch(t){alert("Error renaming item."),console.error(t)}}},z=s=>{const t=[...i].sort((r,p)=>s==="date"?new Date(r.date).getTime()-new Date(p.date).getTime():r.name.localeCompare(p.name));F(t)};return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{currentPath:n,onNavigateTo:D}),e.jsxs("div",{className:"file-manager bg-white",children:[e.jsx(G,{onCreateFolder:k,onUploadFolder:V,onUploadFile:A,onDownloadFile:U,onDelete:O,onSort:z,isItemSelected:a!==null,hasPermission:M,onCopy:H,onMove:$,onRename:J}),e.jsxs(v,{isOpen:N,title:"Create New Folder",onClose:()=>m(!1),children:[e.jsx("input",{type:"text",value:y,onChange:s=>h(s.target.value),placeholder:"Folder name",className:"input input-bordered w-full"}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:R,children:"Create"})]})]}),g&&f&&f.type&&e.jsxs(v,{isOpen:g,title:`Visualizando: ${a}`,onClose:()=>B(!1),children:[e.jsx("div",{className:"flex justify-between items-center mb-4"}),e.jsx("div",{className:"h-96 overflow-auto",children:e.jsx(Je,{fileUrl:f.url,fileType:f.type})})]}),e.jsx("div",{className:"p-4",children:i.length===0?e.jsx("p",{children:"No files or folders available."}):e.jsx("ul",{className:"grid grid-cols-4 gap-4",children:i.map(s=>e.jsxs("li",{className:`p-4 border rounded-lg cursor-pointer flex flex-col items-center ${a===s.name?"bg-blue-100":"bg-white"} hover:bg-gray-200 transition-colors duration-200`,onClick:()=>P(s.name),onDoubleClick:()=>T(s),children:[e.jsx("span",{className:"text-4xl",children:s.type==="folder"?e.jsx(Ze,{}):E(s.name)}),e.jsx("span",{className:"mt-2 text-center truncate w-full",children:s.name})]},s.id))})})]})]})};export{ls as default};
