import{r as s,a as o,j as e,Y as R}from"./app-NK-oG3KX.js";import w from"./EditEmployee-7nI7Sljp.js";import T from"./CreateEmployee-SPNkLJUT.js";import{u as P}from"./AuthProvider-C42NGhEA.js";import"./index.esm-COHxXWg1.js";const B=()=>{const{hasPermission:n}=P(),[f,_]=s.useState([]),[r,E]=s.useState([]),[u,S]=s.useState([]),[v,i]=s.useState(!0),[h,C]=s.useState(null),[b,k]=s.useState(null),[j,d]=s.useState(!1),[m,x]=s.useState(!1),[g,D]=s.useState(null);s.useRef(null);const A=s.useRef(null),[U,M]=s.useState(null);s.useState(!1);const[y,N]=s.useState(null),F=t=>{N(t.id);const a=r.find(L=>L.id===t.position_id),l=a?a.company_id:null,c={...t,company_id:l};k(c),d(!0),N(null)};s.useEffect(()=>{p()},[]);const p=()=>{i(!0),o.all([o.get("admin/employees"),o.get("api/positions"),o.get("admin/companies")]).then(o.spread((t,a,l)=>{_(t.data),E(a.data),S(l.data),i(!1)})).catch(t=>{console.error("Error al cargar los datos",t),C("Error al cargar los datos"),i(!1)})},O=t=>{var a;M(t),(a=A.current)==null||a.showModal()},I=()=>{D(null)};return v?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):h?e.jsx("div",{className:"text-center text-error",children:h}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx(R,{title:"Usuarios"}),e.jsx("h2",{className:"text-center",children:"LISTA DE USUARIOS"}),n("can_create_users")&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>x(!0),className:"btn btn-success",children:"Agregar usuario"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-center",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Número Telefónico"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Fecha de Registro"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Último Inicio de Sesión"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Puesto"}),(n("can_update_users")||n("can_delete_users"))&&e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:f.map(t=>{const a=r.find(c=>c.id===t.position_id),l=a?u.find(c=>c.id===a.company_id):null;return e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:[t.first_name," ",t.last_name_1]}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:t.phone_number||"No disponible"}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:new Date(t.registered_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}),e.jsx("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:t.last_login_at?new Date(t.last_login_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"No registrado"}),e.jsxs("td",{className:"border px-4 py-2 text-center text-sm text-base-content",children:[a==null?void 0:a.name,e.jsx("br",{}),l&&e.jsx("span",{className:"mt-1 inline-block bg-secondary text-secondary-content text-xs px-2 py-1 rounded",children:l.name})]}),(n("can_update_users")||n("can_delete_users"))&&e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[n("can_update_users")&&e.jsx("button",{onClick:()=>F(t),className:"btn btn-primary btn-sm",disabled:y===t.id,children:y===t.id?e.jsx("span",{className:"loading loading-spinner"}):"Editar"}),n("can_delete_users")&&e.jsx("button",{onClick:()=>O(t),className:"btn btn-error btn-sm text-base-100",children:"Eliminar"})]})})]},t.id)})})]})}),b&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"edit-employee-modal",className:"modal-toggle",checked:j,readOnly:!0}),e.jsx("label",{htmlFor:"edit-employee-modal",className:`modal cursor-pointer ${j?"modal-open":""}`,children:e.jsx("label",{className:"modal-box relative",htmlFor:"",children:e.jsx(w,{employee:b,positions:r,companies:u,onClose:()=>d(!1),onSuccess:()=>{d(!1),p()}})})})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"add-employee-modal",className:"modal-toggle",checked:m,readOnly:!0}),e.jsx("label",{htmlFor:"add-employee-modal",className:`modal cursor-pointer ${m?"modal-open":""}`,children:e.jsx("label",{className:"modal-box relative",htmlFor:"",children:e.jsx(T,{onSuccess:()=>{p(),x(!1)},onClose:()=>x(!1)})})})]}),g&&e.jsx("dialog",{open:!0,className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-center text-lg",children:"Acción Exitosa"}),e.jsx("p",{className:"text-center py-4 text-green-500",children:g}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:I,children:"Aceptar"})})]})})]})};export{B as default};
