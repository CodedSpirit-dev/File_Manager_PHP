import{r as t,b as l,j as e}from"./app-CtDkB3di.js";import O from"./EditEmployee-DiH6n8tk.js";import A from"./CreateEmployee-Cnd8gNvh.js";import"./index.esm-C-Xvyz8q.js";const q=()=>{const[f,y]=t.useState([]),[c,N]=t.useState([]),[h,E]=t.useState([]),[S,d]=t.useState(!0),[b,_]=t.useState(null),[j,C]=t.useState(null),[v,m]=t.useState(!1),[D,r]=t.useState(!1),[g,x]=t.useState(null),[p,k]=t.useState(null),P=s=>{x(s.id);const a=c.find(o=>o.id===s.position_id),n=a?a.company_id:null,i={...s,company_id:n};Promise.all([l.get("/api/permissions"),l.get(`/api/employees/${s.id}/permissions`)]).then(([o,w])=>{const I=o.data,M=w.data;C(i),k({permissions:I,employeePermissions:M}),m(!0),x(null)}).catch(o=>{console.error("Error al cargar los datos para editar el empleado",o),x(null)})};t.useEffect(()=>{u()},[]);const u=()=>{d(!0),Promise.all([l.get("admin/employees"),l.get("api/positions"),l.get("admin/companies")]).then(([s,a,n])=>{y(s.data),N(a.data),E(n.data),d(!1)}).catch(s=>{console.error("Error al cargar los datos",s),_("Error al cargar los datos"),d(!1)})},L=s=>{alert(`Funcionalidad de eliminación para ${s.first_name} ${s.last_name_1} está pendiente.`)};return S?e.jsx("div",{className:"flex justify-center items-center h-screen bg-base-100",children:e.jsx("span",{className:"loading loading-dots loading-lg text-primary"})}):b?e.jsx("div",{className:"text-center text-error",children:b}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-base-100",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center text-primary",children:"Lista de Empleados"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>r(!0),className:"btn btn-success",children:"Agregar Empleado"})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Fecha de Registro"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Último Inicio de Sesión"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Puesto"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:f.map(s=>{const a=c.find(i=>i.id===s.position_id),n=a?h.find(i=>i.id===a.company_id):null;return e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content truncate",children:[s.first_name," ",s.last_name_1]}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:new Date(s.registered_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"No registrado"}),e.jsxs("td",{className:"border px-4 py-2 text-sm text-base-content",children:[a==null?void 0:a.name,e.jsx("br",{}),n&&e.jsx("span",{className:"mt-1 inline-block bg-secondary text-secondary-content text-xs px-2 py-1 rounded",children:n.name})]}),e.jsx("td",{className:"border px-4 py-2 text-sm text-base-content",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>P(s),className:"btn btn-primary btn-sm",disabled:g===s.id,children:g===s.id?e.jsx("span",{className:"loading loading-spinner"}):"Editar"}),e.jsx("button",{onClick:()=>L(s),className:"btn btn-error btn-sm text-base-100",children:"Eliminar"})]})})]},s.id)})})]}),v&&j&&p&&e.jsx(O,{employee:j,positions:c,companies:h,permissions:p.permissions,employeePermissions:p.employeePermissions,onClose:()=>m(!1),onSuccess:()=>{m(!1),u()}}),D&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("button",{className:"btn btn-sm btn-circle absolute right-2 top-2",onClick:()=>r(!1),children:"✕"}),e.jsx(A,{onSuccess:()=>{r(!1),u()},onClose:()=>r(!1)})]})})]})]})};export{q as default};
