// src/contexts/PermissionsContext.tsx

import React, { createContext, useContext } from 'react';
import { usePage } from '@inertiajs/react';
import { EmployeePageProps } from '@/types';

interface PermissionsContextProps {
    hasPermission: (permission: string) => boolean;
}

const PermissionsContext = createContext<PermissionsContextProps | undefined>(undefined);

export const PermissionsProvider: React.FC = ({ children }) => {
    const { auth } = usePage<EmployeePageProps>().props;
    const permissions = auth.user?.permissions || [];

    const hasPermission = (permission: string): boolean => {
        return permissions.includes(permission);
    };

    return (
        <PermissionsContext.Provider value={{ hasPermission }}>
            {children}
        </PermissionsContext.Provider>
    );
};

export const usePermissions = (): PermissionsContextProps => {
    const context = useContext(PermissionsContext);
    if (!context) {
        throw new Error('usePermissions must be used within a PermissionsProvider');
    }
    return context;
};
